<!DOCTYPE html><html lang="en"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content=""><title>Linux系统安全策略（IP限定） | FENG's notes</title><link rel="stylesheet" type="text/css" href="/css/style.css?v=0.0.0"><link rel="stylesheet" type="text/css" href="//cdn.jsdelivr.net/npm/normalize.css/normalize.min.css"><link rel="stylesheet" type="text/css" href="//cdn.jsdelivr.net/npm/purecss/build/pure-min.min.css"><link rel="stylesheet" type="text/css" href="//cdn.jsdelivr.net/npm/purecss/build/grids-responsive-min.css"><link rel="stylesheet" href="//cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//cdn.jsdelivr.net/npm/jquery/dist/jquery.min.js"></script><link rel="icon" mask="" sizes="any" href="/favicon.ico"><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"><script type="text/javascript" src="//cdn.jsdelivr.net/npm/clipboard/dist/clipboard.min.js"></script><script type="text/javascript" src="//cdn.jsdelivr.net/gh/codeseven/toastr/build/toastr.min.js"></script><link rel="stylesheet" href="//cdn.jsdelivr.net/gh/codeseven/toastr/build/toastr.min.css"><meta name="generator" content="Hexo 5.2.0"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">Linux系统安全策略（IP限定）</h1><a id="logo" href="/.">FENG's notes</a><p class="description"></p></div><div id="nav-menu"><a class="current" href="/."><i class="fa fa-home"> Home</i></a><a href="/archives/"><i class="fa fa-archive"> Archive</i></a><a href="/about/"><i class="fa fa-user"> About</i></a><a href="/atom.xml"><i class="fa fa-rss"> RSS</i></a></div></div><div class="pure-g" id="layout"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">Linux系统安全策略（IP限定）</h1><div class="post-meta">2015-12-11<span> | </span><span class="category"><a href="/categories/Linux/">Linux</a></span></div><div class="post-content"><h4 id="1-禁止系统响应任何从外部-内部来的ping请求"><a href="#1-禁止系统响应任何从外部-内部来的ping请求" class="headerlink" title="1. 禁止系统响应任何从外部/内部来的ping请求"></a>1. 禁止系统响应任何从外部/内部来的ping请求</h4><p>攻击者一般首先通过ping命令检测此主机或者IP是否处于活动状态，如果能够ping通 某个主机或者IP，那么攻击者就认为此系统处于活动状态，继而进行攻击或破坏。如果没有人能ping通机器并收到响应，那么就可以大大增强服务器的安全性，linux下可以执行如下设置，禁止ping请求：</p>
<p>[root@localhost ~]#echo “1”&gt; /proc/sys/net/ipv4/icmp_echo_ignore_all</p>
<p>默认情况下“icmp_echo_ignore_all”的值为“0”，表示响应ping操作。 可以加上面的一行命令到/etc/rc.d/rc.local文件中，以使每次系统重启后自动运行。</p>
<a id="more"></a>
<h4 id="2．禁止Control-Alt-Delete组合键重启系统"><a href="#2．禁止Control-Alt-Delete组合键重启系统" class="headerlink" title="2．禁止Control-Alt-Delete组合键重启系统"></a>2．禁止Control-Alt-Delete组合键重启系统</h4><p>在linux的默认设置下，同时按下Control-Alt-Delete键，系统将自动重启，这是很不安全的，因此要禁止Control-Alt-Delete组合键重启系统，只需修改/etc/inittab文件：</p>
<p>[root@localhost ~]#vi /etc/inittab</p>
<p>找到此行：ca::ctrlaltdel:/sbin/shutdown -t3 -r now 在之前加上“#” 然后执行：</p>
<p>[root@localhost ~]#telinit q</p>
<p> </p>
<h4 id="3．限制Shell记录历史命令大小"><a href="#3．限制Shell记录历史命令大小" class="headerlink" title="3．限制Shell记录历史命令大小"></a>3．限制Shell记录历史命令大小</h4><p>默认情况下，bash shell会在文件$HOME/.bash_history中存放多达1000条命令记录(根据系统不同，默认记录条数不同)。系统中每个用户的主目录下都有一个这样的文件。 这么多的历史命令记录，肯定是不安全的，因此必须限制该文件的大小。 可以编辑/etc/profile文件，修改其中的选项如下： HISTSIZE=30 表示在文件$HOME/.bash_history中记录最近的30条历史命令。如果将“HISTSIZE”设置为0，则表示不记录历史命令，那么也就不能用键盘的上下键查找历史命令了。</p>
<h4 id="4．删除系统默认的不必要用户和组"><a href="#4．删除系统默认的不必要用户和组" class="headerlink" title="4．删除系统默认的不必要用户和组"></a>4．删除系统默认的不必要用户和组</h4><p>Linux提供了各种系统账户，在系统安装完毕，如果不需要某些用户或者组，就要立即删除它，因为账户越多，系统就越不安全，越容易受到攻击。 删除系统不必要的用户用下面命令 [root@localhost ~]# userdel username 删除系统不必要的组用如下命令： [root@localhost ~]# groupdel  groupname Linux系统中可以删除的默认用户和组有： 删除的用户,如adm,lp,sync,shutdown,halt,news,uucp,operator,games,gopher等。 删除的组,如adm,lp,news,uucp,games,dip,pppusers,popusers,slipusers等。</p>
<h4 id="5-关闭selinux"><a href="#5-关闭selinux" class="headerlink" title="5. 关闭selinux"></a>5. 关闭selinux</h4><p>SELinux是 Security-Enhanced Linux的简称，是一种内核强制访问控制安全系统，目前SELinux已经集成到Linux 2.6内核的主线和大多数Linux发行版上，由于SELinux与现有Linux应用程序和Linux内核模块兼容性还存在一些问题，因此建议初学者先关闭selinux，等到对linux有了深入的认识后，再对selinux深入研究不迟！ 查看linux系统selinux是否启用，可以使用getenforce命令： [root@localhost ~]# getenforce Disabled 关闭selinux，在redhat系列发行版中，可以直接修改如下文件： [root@localhost ~]#vi /etc/sysconfig/selinux # This file controls the state of SELinux on the system. # SELINUX= can take one of these three values: #       enforcing - SELinux security policy is enforced. #       permissive - SELinux prints warnings instead of enforcing. #       disabled - SELinux is fully disabled. SELINUX=enforcing # SELINUXTYPE= type of policy in use. Possible values are: #       targeted - Only targeted network daemons are protected. #       strict - Full SELinux protection. SELINUXTYPE=targeted 将SELINUX=enforcing修改为SELINUX=disabled, 重启系统后将会停止SElinux。</p>
<h4 id="6．设定tcp-wrappers防火墙"><a href="#6．设定tcp-wrappers防火墙" class="headerlink" title="6．设定tcp_wrappers防火墙"></a>6．设定tcp_wrappers防火墙</h4><p>Tcp_Wrappers是一个用来分析TCP/IP封包的软件，类似的IP封包软件还有iptables，linux默认都安装了此软件，作为一个安全的系统，Linux本身有两层安全防火墙，通过IP过滤机制的iptables实现第一层防护，iptables防火墙通过直观地监视系统的运行状况，阻挡网络中的一些恶意攻击，保护整个系统正常运行，免遭攻击和破坏。关于iptables的实现，将在下个章节详细讲述。如果通过了第一层防护，那么下一层防护就是tcp_wrappers了，通过Tcp_Wrappers可以实现对系统中提供的某些服务的开放与关闭、允许和禁止，从而更有效地保证系统安全运行。 Tcp_Wrappers的使用很简单，仅仅两个配置文件：/etc/hosts.allow和/etc/hosts.deny （1） 查看系统是否安装了Tcp_Wrappers [root@localhost ~]#rpm -q tcp_wrappers  或者 [root@localhost ~]#rpm -qa grep tcp tcp_wrappers-7.6-37.2 tcpdump-3.8.2-10.RHEL4 如果有上面的类似输出，表示系统已经安装了tcp_wrappers模块。如果没有显示，可能是没有安装，可以从linux系统安装盘找到对应RPM包进行安装。 （2）tcp_wrappers防火墙的局限性 系统中的某个服务是否可以使用tcp_wrappers防火墙，取决于该服务是否应用了libwrapped库文件，如果应用了就可以使用tcp_wrappers防火墙，系统中默认的一些服务如：sshd、portmap、sendmail、xinetd、vsftpd、tcpd等都可以使用tcp_wrappers防火墙。 (3)  tcp_wrappers设定的规则 tcp_wrappers防火墙的实现是通过/etc/hosts.allow和/etc/hosts.deny两个文件来完成的，首先看一下设定的格式： service:host(s) [:action]  service：代表服务名，例如sshd、vsftpd、sendmail等。  host(s)：主机名或者IP地址，可以有多个，例如192.168.60.0、<a target="_blank" rel="noopener" href="http://www.ixdba.net/">www.ixdba.net</a>  action：动作， 符合条件后所采取的动作。 几个关键字：  ALL：所有服务或者所有IP。  ALL EXCEPT：所有的服务或者所有IP除去指定的。 例如：ALL:ALL EXCEPT 192.168.60.132 表示除了192.168.60.132这台机器，任何机器执行所有服务时或被允许或被拒绝。 了解了设定语法后，下面就可以对服务进行访问限定。 例如互联网上一台linux服务器，实现的目标是：仅仅允许222.90.66.4、61.185.224.66以及域名softpark.com通过SSH服务远程登录到系统，设置如下： 首先设定允许登录的计算机，即配置/etc/hosts.allow文件，设置很简单，只要修改/etc/hosts.allow（如果没有此文件，请自行建立）这个文件即可。 只需将下面规则加入/etc/hosts.allow即可。 sshd: 222.90.66.4 61.185.224.66 softpark.com 接着设置不允许登录的机器，也就是配置/etc/hosts.deny文件了。 一般情况下，linux会首先判断/etc/hosts.allow这个文件，如果远程登录的计算机满足文件/etc/hosts.allow设定的话，就不会去使用/etc/hosts.deny文件了，相反，如果不满足hosts.allow文件设定的规则的话，就会去使用hosts.deny文件了，如果满足hosts.deny的规则，此主机就被限制为不可访问linux服务器，如果也不满足hosts.deny的设定，此主机默认是可以访问linux服务器的，因此，当设定好/etc/hosts.allow文件访问规则之后，只需设置/etc/hosts.deny为“所有计算机都不能登录状态”即可。 sshd:ALL 这样，一个简单的tcp_wrappers防火墙就设置完毕了。 本文出自 “<a target="_blank" rel="noopener" href="http://ixdba.blog.51cto.com/">技术成就梦想</a>” 博客，请务必保留此出处<a target="_blank" rel="noopener" href="http://ixdba.blog.51cto.com/2895551/526443">http://ixdba.blog.51cto.com/2895551/526443</a>  </p>
<h1 id="linux-hosts的allow和deny"><a href="#linux-hosts的allow和deny" class="headerlink" title="linux hosts的allow和deny"></a><strong>linux hosts的allow和deny</strong></h1><p>  /etc/hosts.allow和/etc/hosts.deny两个文件是控制远程访问设置的，通过他可以允许或者拒绝某个ip或者ip段的客户访问linux的某项服务。 网络防火墙是阻挡非授权主机访问网络的第一道防护，但是它们不应该仅有一道屏障。 Linux使用了两个文件/etc/host.allow和/etc/hosts.deny，根据网络请求的来源限制对服务的访问。 host.allow文件列出了允许连接到一个特定服务的主机，而hosts.deny文件则负责限制访问。 不过，这两个文件只控制对有hosts_access功能的服务（如xinetd所管理的那些服务、sshd和某些配置的sendmail）的访问。 在大多数情况下，明智的做法是先做限制，然后只允许从指定主机访问关键服务。</p>
<blockquote>
<p>我们建议，默认在hosts.deny文件中加上下面这一行配置，拒绝所有的访问： ALL:ALL</p>
</blockquote>
<p>接下来，您可以在hosts.allow文件中逐个开放访问许可。下面的配置允许从网络192.168/16访问SSH，而从任何地方访问sendmail。</p>
<p>sshd: 192.168.0.0/255.255.0.0<br>sendmail: ALL</p>
<p>两个文件每行配置的格式都是service: host或者service: network。失败的连接企图被记录到syslog中。从没有得到允许访问该服务的主机来的连接会被立即关闭。 大多数Linux发行版本默认都带host.allow和hosts.deny，但是它们通常为空。 修改/etc/hosts.allow文件</p>
<p>#</p>
<h1 id="hosts-allow-This-file-describes-the-names-of-the-hosts-which-are"><a href="#hosts-allow-This-file-describes-the-names-of-the-hosts-which-are" class="headerlink" title="hosts.allow This file describes the names of the hosts which are"></a>hosts.allow This file describes the names of the hosts which are</h1><h1 id="allowed-to-use-the-local-INET-services-as-decided"><a href="#allowed-to-use-the-local-INET-services-as-decided" class="headerlink" title="allowed to use the local INET services, as decided"></a>allowed to use the local INET services, as decided</h1><h1 id="by-the-‘-usr-sbin-tcpd’-server"><a href="#by-the-‘-usr-sbin-tcpd’-server" class="headerlink" title="by the ‘/usr/sbin/tcpd’ server."></a>by the ‘/usr/sbin/tcpd’ server.</h1><p>#</p>
<p>sshd:210.13.218.*:allow</p>
<p>sshd:222.77.15.*:allow</p>
<p>以上写法表示允许210和222两个ip段连接sshd服务（这必然需要hosts.deny这个文件配合使用），当然:allow完全可以省略的。 当然如果管理员集中在一个IP那么这样写是比较省事的 all:218.24.129.110 //他表示接受110这个ip的所有请求！ /etc/hosts.deny文件，此文件是拒绝服务列表，文件内容如下：</p>
<p>#</p>
<h1 id="hosts-deny-This-file-describes-the-names-of-the-hosts-which-are"><a href="#hosts-deny-This-file-describes-the-names-of-the-hosts-which-are" class="headerlink" title="hosts.deny This file describes the names of the hosts which are"></a>hosts.deny This file describes the names of the hosts which are</h1><h1 id="not-allowed-to-use-the-local-INET-services-as-decided"><a href="#not-allowed-to-use-the-local-INET-services-as-decided" class="headerlink" title="*not* allowed to use the local INET services, as decided"></a>*not* allowed to use the local INET services, as decided</h1><h1 id="by-the-‘-usr-sbin-tcpd’-server-1"><a href="#by-the-‘-usr-sbin-tcpd’-server-1" class="headerlink" title="by the ‘/usr/sbin/tcpd’ server."></a>by the ‘/usr/sbin/tcpd’ server.</h1><p>#</p>
<h1 id="The-portmap-line-is-redundant-but-it-is-left-to-remind-you-that"><a href="#The-portmap-line-is-redundant-but-it-is-left-to-remind-you-that" class="headerlink" title="The portmap line is redundant, but it is left to remind you that"></a>The portmap line is redundant, but it is left to remind you that</h1><h1 id="the-new-secure-portmap-uses-hosts-deny-and-hosts-allow-In-particular"><a href="#the-new-secure-portmap-uses-hosts-deny-and-hosts-allow-In-particular" class="headerlink" title="the new secure portmap uses hosts.deny and hosts.allow. In particular"></a>the new secure portmap uses hosts.deny and hosts.allow. In particular</h1><h1 id="you-should-know-that-NFS-uses-portmap"><a href="#you-should-know-that-NFS-uses-portmap" class="headerlink" title="you should know that NFS uses portmap!"></a>you should know that NFS uses portmap!</h1><p>sshd:all:deny</p>
<p>注意看：sshd:all:deny表示拒绝了所有sshd远程连接。:deny可以省略。 所以：当hosts.allow和 host.deny相冲突时，以hosts.allow设置为准。 注意修改完后： service xinetd restart 才能让刚才的更改生效。 /etc/hosts.allow（允许）和/etc/hosts.deny（禁止）这两个文件是tcpd服务器的配置文件 tcpd服务器可以控制外部IP对本机服务的访问 linux 系统会先检查/etc/hosts.deny规则，再检查/etc/hosts.allow规则，如果有冲突 按/etc/hosts.allow规则处理 比如： 1.禁止所有ip访问linux 的ssh功能 可以在/etc/hosts.deny添加一行 sshd:all:deny 2.禁止某一个ip（192.168.11.112）访问ssh功能 可以在/etc/hosts.deny添加一行sshd:192.168.11.112 3.如果在/etc/hosts.deny和/etc/hosts.allow同时 有sshd:192.168.11.112 规则，则192.168.11.112可以访问主机的ssh服务</p>
</div><div class="tags"></div><div class="post-nav"><a class="pre" href="/2015/12/14/%E8%BD%AC%E5%BD%95%E7%BB%84%E6%95%B0%E6%8D%AE%E5%88%86%E6%9E%90%E4%B9%8Bnr%E6%95%B0%E6%8D%AE%E5%BA%93%E6%B3%A8%E9%87%8A/">转录组数据分析之nr数据库注释</a><a class="next" href="/2015/12/07/%E7%A1%AC%E5%AE%9E%E7%A7%8D%E5%AD%90%E7%9A%84%E5%A4%84%E7%90%86%E4%B8%8E%E5%82%AC%E8%8A%BD/">硬实种子的处理与催芽</a></div></div></div></div><div class="pure-u-1-4 hidden_mid_and_down"><div id="sidebar"><div class="widget"><div class="search-form"><input id="local-search-input" placeholder="Search" type="text" name="q" results="0"/><div id="local-search-result"></div></div></div><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> Categories</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Bioinformatics/">Bioinformatics</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Life/">Life</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Linux/">Linux</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Notes/">Notes</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Plant/">Plant</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Python/">Python</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/R/">R</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%9C%AA%E5%88%86%E7%B1%BB/">未分类</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> Tags</i></div><div class="tagcloud"><a href="/tags/Tag/" style="font-size: 15px;">Tag</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> Recent</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2021/01/04/Remove-Background-from-Image/">Remove Background from Image</a></li><li class="post-list-item"><a class="post-list-link" href="/2021/01/01/%E5%9C%A8Linux%E6%9C%8D%E5%8A%A1%E5%99%A8%E4%B8%8A%E4%BD%BF%E7%94%A8Nginx%E9%83%A8%E7%BD%B2Hexo%E7%AB%99%E7%82%B9/">在Linux服务器上使用Nginx部署Hexo站点</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/12/29/Linux%EF%BC%9A%E4%BD%BF%E7%94%A8Modules%E7%AE%A1%E7%90%86%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F/">Linux：使用Environment Modules管理环境变量</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/12/28/%E4%BD%BF%E7%94%A8Snakemake%E6%90%AD%E5%BB%BA%E7%94%9F%E7%89%A9%E4%BF%A1%E6%81%AF%E5%88%86%E6%9E%90%E6%B5%81%E7%A8%8B/">使用Snakemake搭建生物信息分析流程</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/12/28/%E5%9F%BA%E5%9B%A0%E7%BB%84%E6%AF%94%E5%AF%B9%E7%9A%84SAM-BAM%E6%96%87%E4%BB%B6%E4%B8%AD%EF%BC%8C%E6%80%8E%E4%B9%88%E7%90%86%E8%A7%A3MAPQ%E5%80%BC/">基因组比对的SAM/BAM文件中，怎么理解MAPQ值</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/12/25/Linux%EF%BC%9Avim%E8%AE%BE%E7%BD%AE/">Linux：vim设置</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/12/15/Hi-C%EF%BC%9A3d-dna%E6%8C%82%E8%BD%BD%E6%9F%93%E8%89%B2%E4%BD%93/">Hi-C：3d-dna挂载染色体</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/12/15/%E4%B8%80%E4%BA%9BFASTA-FASTQ%E5%BA%8F%E5%88%97%E5%A4%84%E7%90%86%E5%B7%A5%E5%85%B7/">一些FASTA/FASTQ序列处理工具</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/12/12/%E5%A4%A7%E8%B1%86%E4%BA%A7%E4%B8%9A%E7%8E%B0%E7%8A%B6/">大豆产业现状</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/12/07/1st_post/">My Fast HexoPages</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-external-link"> Links</i></div><ul></ul><a href="http://www.example1.com/" title="site-name1" target="_blank">site-name1</a><ul></ul><a href="http://www.example2.com/" title="site-name2" target="_blank">site-name2</a><ul></ul><a href="http://www.example3.com/" title="site-name3" target="_blank">site-name3</a></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">Copyright © 2021 <a href="/." rel="nofollow">FENG's notes.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div></div></div><a class="show" id="rocket" href="#top"></a><script type="text/javascript" src="/js/totop.js?v=0.0.0" async></script><script type="text/javascript" src="//cdn.jsdelivr.net/gh/fancyapps/fancybox/dist/jquery.fancybox.min.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=0.0.0" async></script><link rel="stylesheet" type="text/css" href="//cdn.jsdelivr.net/gh/fancyapps/fancybox/dist/jquery.fancybox.min.css"><link rel="stylesheet" type="text/css" href="/css/search.css?v=0.0.0"><script type="text/javascript" src="/js/search.js?v=0.0.0"></script><script>var search_path = 'search.xml';
if (search_path.length == 0) {
   search_path = 'search.xml';
}
var path = '/' + search_path;
searchFunc(path, 'local-search-input', 'local-search-result');
</script><script type="text/javascript" src="/js/copycode.js" successtext="Copy Successed!"></script><link rel="stylesheet" type="text/css" href="/css/copycode.css"><script type="text/javascript" src="/js/codeblock-resizer.js?v=0.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=0.0.0"></script></div></body></html>