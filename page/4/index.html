<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 6.2.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon32.ico">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon16.ico">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"example.com","root":"/","scheme":"Pisces","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta property="og:type" content="website">
<meta property="og:title" content="FENG&#39;s Notes">
<meta property="og:url" content="http://example.com/page/4/index.html">
<meta property="og:site_name" content="FENG&#39;s Notes">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="FENG Lei">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="http://example.com/page/4/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'en'
  };
</script>

  <title>FENG's Notes</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">FENG's Notes</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">Genomics/Bioinformatics/Plants</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>About</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>Tags</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>Categories</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>Search
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="Searching..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content index posts-expand">
            
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://example.com/2021/10/31/Plant-Rice-Oryza-sativa-subsp-japonica-and-indica/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/fl-photo-202109.jpg">
      <meta itemprop="name" content="FENG Lei">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="FENG's Notes">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/10/31/Plant-Rice-Oryza-sativa-subsp-japonica-and-indica/" class="post-title-link" itemprop="url">Plant | Rice: Oryza sativa subsp. japonica and indica</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2021-10-31 19:25:40" itemprop="dateCreated datePublished" datetime="2021-10-31T19:25:40+08:00">2021-10-31</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2022-03-09 23:44:12" itemprop="dateModified" datetime="2022-03-09T23:44:12+08:00">2022-03-09</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Plant/" itemprop="url" rel="index"><span itemprop="name">Plant</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>本文总结粳稻（japonica）与籼稻（indica）的分类，以及相对应的数据库的事项。</p>
<p>作者：稻我家安全食材<br />
链接：<a target="_blank" rel="noopener" href="https://www.zhihu.com/question/28272395/answer/513511209">https://www.zhihu.com/question/28272395/answer/513511209</a><br />
来源：知乎<br />
著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。</p>
<p>籼稻（Indica rice）：有 20% 左右为直链淀粉。属中黏性。籼稻起源于亚热带，种植于热带和亚热带地区，生长期短，在无霜期长的地方一年可多次成熟。去壳成为籼米后，外观细长、透明度低。有的品种表皮发红，如中国江西出产的红米，煮熟后米饭较干、松。通常用于萝卜糕、米粉、炒饭。</p>
<p>粳稻（Japonica rice）：粳稻的直链淀粉较少，低于15%。种植于温带和寒带地区，生长期长，一般一年只能成熟一次。去壳成为粳米后，外观圆短、透明（部分品种米粒有局部白粉质）。煮食特性介于糯米与籼米之间。用途为一般食用米。籼稻和粳稻是长期适应不同生态条件，尤其是温度条件而形成的两种气候生态型，两者在形态生理特性方面部有明显差异因为籼稻和粳稻产自不同的地方，米粒的形状也不同，口感上更是相差很远。</p>
<p>那么二者的区别又在哪里呢？</p>
<ol>
<li>
<p>首先在品种上籼稻是由野生稻演变来的，而粳稻是由籼稻在人们不断向高纬度、高海拔地区引种的过程中不断演变和人工选育而来的。因此说籼稻是基本型，粳稻是变异型。</p>
</li>
<li>
<p>从形态特征和经济性状上看，一般籼稻的茎杆较粗，分蘖力较强，叶色较淡，谷粒细长，容易落粒，出米率较低。籼米的直链淀粉含量高，煮饭时胀饭性大，黏性小，米饭散落。粳稻一般茎杆较细，传统粳稻品种的分蘖力不如籼稻，叶色较深，谷粒短圆，不容易落粒，出米率较高，碎米少。粳米的直链淀粉含量低，米饭黏性大，胀饭性小。</p>
</li>
<li>
<p>从生理特征和适应性上看，籼稻一般吸肥性强，而耐肥力差，易倒伏，耐寒力较差，温度在12℃以上时才能发芽。粳稻则耐肥力强而吸肥性差，较抗倒伏，耐寒力较强，温度达到10℃即可发芽。在温度适宜的条件下，籼稻叶片的光合速率高于粳稻，繁茂性好，易早生快发。</p>
</li>
<li>
<p>从地区分布上看，籼稻适于在低纬度、低海拔的湿热地区栽培，如我国的南方稻区。粳稻则适于在高纬度、高海拔地区栽培，如我国的东北稻区、华北稻区和西北稻区，也可在云贵高原的高海拔地区和江淮流域双季稻区作中粳和晚粳种植。</p>
</li>
<li>
<p>从稻株外部形态进行区别：籼稻一般株高多在1米以上，茎秆较软，叶片宽，色泽淡绿，剑叶开度小。叶片茸毛多，有短小茸毛散生于颖壳。大多为无芒或短芒，谷粒细长而稍扁平，一般长度为宽度的二倍以上。谷粒易脱落，较耐湿、耐热和耐强光，但不耐寒。粳稻一般株高多为75-95厘米，茎秆较矮，叶子较窄，深绿色，米粒不易脱落，耐寒性强。</p>
</li>
</ol>
<p>因此，籼稻是由野生稻演变成的栽培稻，是基本型。粳稻分布范围广泛，从南方的高寒山区，云贵高原到秦岭，淮河以北的广大的地区均有栽培。粳稻具有耐寒，耐弱光的习性，粒形短圆，米质粘性较强，叶面少毛或无毛，颖毛长密，不易落粒等特性，与野生稻有较大差异。因此，可以说粳稻是人类将籼稻由南向北，由低向高引种后，逐渐适应低温的变异型。</p>
<h3 id="籼稻indica9311的基因组信息"><a class="markdownIt-Anchor" href="#籼稻indica9311的基因组信息"></a> 籼稻（indica，9311）的基因组信息</h3>
<p>数据下载</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">wget ftp://ftp.genomics.org.cn/pub/ricedb/SynVs9311/9311/Sequence/Chromosome/ChrAll.fasta.gz</span><br><span class="line">wget ftp://ftp.genomics.org.cn/pub/ricedb/rice_update_data/GLEAN_genes/Beijing_indica/GLEAN_genes/9311.glean.gff.cds.gz</span><br><span class="line">wget ftp://ftp.genomics.org.cn/pub/ricedb/rice_update_data/GLEAN_genes/Beijing_indica/GLEAN_genes/9311.glean.gff.gff.gz</span><br><span class="line">hisat2-build -p 8  genome.fa genome</span><br><span class="line">gffread 9311.glean.gff.gff -F -T -o 9311.glean.raw.gtf</span><br><span class="line">perl ~/local/app/NGSQCToolkit/Statistics/N50Stat.pl -i ChrAll.fasta -o ChrAll.fasta.stat</span><br></pre></td></tr></table></figure>
<p>基因命名</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">##gff-version 3</span><br><span class="line">##sequence-region Chr01 1 47283185</span><br><span class="line">Chr01   glean   gene    47275570        47278635        .       -       .       ID=BGIOSGA000001;Name=BGIOSGA000001;</span><br><span class="line">Chr01   glean   mRNA    47275570        47278635        0.798504        -       .       ID=BGIOSGA000001-TA;Name=BGIOSGA000001-TA;Parent=BGIOSGA000001;</span><br><span class="line">Chr01   glean   CDS     47278477        47278635        .       -       0       Parent=BGIOSGA000001-TA;</span><br><span class="line">Chr01   glean   CDS     47278262        47278399        .       -       0       Parent=BGIOSGA000001-TA;</span><br><span class="line">Chr01   glean   CDS     47278135        47278186        .       -       0       Parent=BGIOSGA000001-TA;</span><br><span class="line">Chr01   glean   CDS     47277979        47278058        .       -       2       Parent=BGIOSGA000001-TA;</span><br><span class="line">Chr01   glean   CDS     47276528        47276587        .       -       0       Parent=BGIOSGA000001-TA;</span><br><span class="line">Chr01   glean   CDS     47275842        47275922        .       -       0       Parent=BGIOSGA000001-TA;</span><br><span class="line">Chr01   glean   CDS     47275570        47275662        .       -       0       Parent=BGIOSGA000001-TA;</span><br><span class="line">Chr01   glean   gene    47247293        47259724        .       -       .       ID=BGIOSGA000002;Name=BGIOSGA000002;</span><br><span class="line">Chr01   glean   mRNA    47247293        47259724        0.997143        -       .       ID=BGIOSGA000002-TA;Name=BGIOSGA000002-TA;Parent=BGIOSGA000002;</span><br><span class="line">Chr01   glean   CDS     47259551        47259724        .       -       0       Parent=BGIOSGA000002-TA;</span><br><span class="line">Chr01   glean   CDS     47259199        47259261        .       -       0       Parent=BGIOSGA000002-TA;</span><br><span class="line">Chr01   glean   CDS     47258441        47258518        .       -       0       Parent=BGIOSGA000002-TA;</span><br><span class="line">Chr01   glean   CDS     47258327        47258376        .       -       0       Parent=BGIOSGA000002-TA;</span><br><span class="line">Chr01   glean   CDS     47257303        47257405        .       -       1       Parent=BGIOSGA000002-TA;</span><br><span class="line">Chr01   glean   CDS     47256255        47256407        .       -       0       Parent=BGIOSGA000002-TA;</span><br><span class="line">Chr01   glean   CDS     47255968        47256060        .       -       0       Parent=BGIOSGA000002-TA;</span><br></pre></td></tr></table></figure>
<h3 id="粳稻japonica或称日本晴var-nipponbare的基因组信息"><a class="markdownIt-Anchor" href="#粳稻japonica或称日本晴var-nipponbare的基因组信息"></a> 粳稻（japonica，或称“日本晴”，var Nipponbare）的基因组信息</h3>
<p>下载地址 <a target="_blank" rel="noopener" href="https://rapdb.dna.affrc.go.jp/download/irgsp1.html">https://rapdb.dna.affrc.go.jp/download/irgsp1.html</a>，从下面下载的文件来看，该数据集的更新日期为2020年12月。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">drwxrwxr-x 2 fenglei fenglei      4096 Mar 10  2021 index</span><br><span class="line">-rw-rw-r-- 1 fenglei fenglei   2205461 Mar 10  2021 IRGSP-1.0_representative_transcript_exon_2020-12-02.gtf.gz</span><br><span class="line">-rw-rw-r-- 1 fenglei fenglei   2910542 Mar 10  2021 IRGSP-1.0_representative_annotation_2020-12-02.tsv.gz</span><br><span class="line">-rw-rw-r-- 1 fenglei fenglei  15479652 Mar 10  2021 IRGSP-1.0_representative_2020-12-02.tar.gz</span><br><span class="line">-rw-rw-r-- 1 fenglei fenglei   8071768 Mar 10  2021 IRGSP-1.0_protein_2020-12-02.fasta.gz</span><br><span class="line">-rw-rw-r-- 1 fenglei fenglei  12921645 Mar 10  2021 IRGSP-1.0_cds_2020-12-02.fasta.gz</span><br><span class="line">-rw-rw-r-- 1 fenglei fenglei  21521204 Mar 10  2021 IRGSP-1.0_transcript_2020-12-02.fasta.gz</span><br><span class="line">-rw-rw-r-- 1 fenglei fenglei  14082338 Mar 10  2021 IRGSP-1.0_1kb-upstream_2020-12-02.fasta.gz</span><br><span class="line">-rw-rw-r-- 1 fenglei fenglei  13852984 Mar 10  2021 IRGSP-1.0_1kb-downstream_2020-12-02.fasta.gz</span><br><span class="line">-rw-rw-r-- 1 fenglei fenglei  27531029 Mar 10  2021 IRGSP-1.0_2kb-upstream_2020-12-02.fasta.gz</span><br><span class="line">-rw-rw-r-- 1 fenglei fenglei  40892583 Mar 10  2021 IRGSP-1.0_gene_2020-12-02.fasta.gz</span><br><span class="line">-rw-rw-r-- 1 fenglei fenglei     65536 Mar 10  2021 irgsp1_repeat_unit.gff.gz</span><br><span class="line">-rw-rw-r-- 1 fenglei fenglei  27067699 Mar 10  2021 IRGSP-1.0_2kb-downstream_2020-12-02.fasta.gz</span><br><span class="line">-rw-rw-r-- 1 fenglei fenglei  40469323 Mar 10  2021 IRGSP-1.0_3kb-upstream_2020-12-02.fasta.gz</span><br><span class="line">-rw-rw-r-- 1 fenglei fenglei  39804961 Mar 10  2021 IRGSP-1.0_3kb-downstream_2020-12-02.fasta.gz</span><br><span class="line">-rw-rw-r-- 1 fenglei fenglei 208876624 Mar 10  2021 kasalath_genome.tar.gz</span><br><span class="line">-rw-rw-r-- 1 fenglei fenglei    828064 Mar 10  2021 IRGSP-1.0_predicted_2020-12-02.tar.gz</span><br><span class="line">-rw-rw-r-- 1 fenglei fenglei    212118 Mar 10  2021 IRGSP-1.0_predicted_transcript_exon_2020-12-02.gtf.gz</span><br><span class="line">-rw-rw-r-- 1 fenglei fenglei     65407 Mar 10  2021 IRGSP-1.0_predicted_annotation_2020-12-02.tsv.gz</span><br><span class="line">-rw-rw-r-- 1 fenglei fenglei   1624227 Mar 10  2021 IRGSP-1.0_predicted-protein_2020-12-02.fasta</span><br><span class="line">-rw-rw-r-- 1 fenglei fenglei     18236 Mar 10  2021 irgsp1_rRNA_tRNA.gff.gz</span><br><span class="line">-rw-rw-r-- 1 fenglei fenglei    323084 Mar 10  2021 RAP-MSU_2020-12-02.txt.gz</span><br><span class="line">-rw-rw-r-- 1 fenglei fenglei    339560 Mar 10  2021 IRGSP-1.0_transcript-evidence_2012-04-11.txt.gz</span><br><span class="line">-rw-rw-r-- 1 fenglei fenglei   4589349 Mar 10  2021 IRGSP-1.0_predicted-cds_2020-12-02.fasta</span><br><span class="line">-rw-rw-r-- 1 fenglei fenglei    174987 Mar 10  2021 organelle.gff</span><br><span class="line">-rw-rw-r-- 1 fenglei fenglei    650061 Mar 10  2021 Mt_Pt_genome.fasta</span><br><span class="line">-rw-rw-r-- 1 fenglei fenglei   8054917 Mar 10  2021 Rice_vegetative_and_reproductive_stage-specific_sRNAs_and_networks.zip</span><br><span class="line">-rwxr-xr-x 1 fenglei fenglei        51 Mar 10  2021 opt.sh</span><br></pre></td></tr></table></figure>
<p>看看他的基因命名</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">(base) [fenglei@localhost O.sativa_japonica_2021]$ less IRGSP-1.0_representative_transcript_exon_2020-12-02.gtf.gz</span><br><span class="line">chr01   irgsp1_rep      transcript      2983    10815   .       +       .       gene_id &quot;Os01g0100100&quot;; transcript_id &quot;Os01t0100100-01&quot;;</span><br><span class="line">chr01   irgsp1_rep      exon    2983    3268    .       +       .       gene_id &quot;Os01g0100100&quot;; transcript_id &quot;Os01t0100100-01&quot;;</span><br><span class="line">chr01   irgsp1_rep      exon    3354    3616    .       +       .       gene_id &quot;Os01g0100100&quot;; transcript_id &quot;Os01t0100100-01&quot;;</span><br><span class="line">chr01   irgsp1_rep      exon    4357    4455    .       +       .       gene_id &quot;Os01g0100100&quot;; transcript_id &quot;Os01t0100100-01&quot;;</span><br><span class="line">chr01   irgsp1_rep      exon    5457    5560    .       +       .       gene_id &quot;Os01g0100100&quot;; transcript_id &quot;Os01t0100100-01&quot;;</span><br><span class="line">chr01   irgsp1_rep      exon    7136    7944    .       +       .       gene_id &quot;Os01g0100100&quot;; transcript_id &quot;Os01t0100100-01&quot;;</span><br><span class="line">chr01   irgsp1_rep      exon    8028    8150    .       +       .       gene_id &quot;Os01g0100100&quot;; transcript_id &quot;Os01t0100100-01&quot;;</span><br><span class="line">chr01   irgsp1_rep      exon    8232    8320    .       +       .       gene_id &quot;Os01g0100100&quot;; transcript_id &quot;Os01t0100100-01&quot;;</span><br><span class="line">chr01   irgsp1_rep      exon    8408    8608    .       +       .       gene_id &quot;Os01g0100100&quot;; transcript_id &quot;Os01t0100100-01&quot;;</span><br><span class="line">chr01   irgsp1_rep      exon    9210    9615    .       +       .       gene_id &quot;Os01g0100100&quot;; transcript_id &quot;Os01t0100100-01&quot;;</span><br><span class="line">chr01   irgsp1_rep      exon    10102   10187   .       +       .       gene_id &quot;Os01g0100100&quot;; transcript_id &quot;Os01t0100100-01&quot;;</span><br><span class="line">chr01   irgsp1_rep      exon    10274   10430   .       +       .       gene_id &quot;Os01g0100100&quot;; transcript_id &quot;Os01t0100100-01&quot;;</span><br><span class="line">chr01   irgsp1_rep      exon    10504   10815   .       +       .       gene_id &quot;Os01g0100100&quot;; transcript_id &quot;Os01t0100100-01&quot;;</span><br><span class="line">chr01   irgsp1_rep      transcript      11218   12435   .       +       .       gene_id &quot;Os01g0100200&quot;; transcript_id &quot;Os01t0100200-01&quot;;</span><br></pre></td></tr></table></figure>
<h3 id="粳稻另一个版本"><a class="markdownIt-Anchor" href="#粳稻另一个版本"></a> 粳稻另一个版本</h3>
<p>下载地址 <a target="_blank" rel="noopener" href="http://rice.uga.edu/">http://rice.uga.edu/</a></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">RGAP 7 Summary</span><br><span class="line">Gene Annotation</span><br><span class="line"></span><br><span class="line">Total loci	55,986</span><br><span class="line">Non-TE Loci	</span><br><span class="line">Number	39,045</span><br><span class="line">Gene models	49,066</span><br><span class="line">Gene size	2,853 bp</span><br><span class="line">Exons/gene	4.9</span><br><span class="line">Introns/gene	3.9</span><br><span class="line">TE Loci	</span><br><span class="line">Number	16,941</span><br><span class="line">Gene models	17,272</span><br><span class="line">Gene size	3,223 bp</span><br><span class="line">Exons/gene	4.2</span><br><span class="line">Introns/gene	3.2</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">$ le MSU_japonica_all.gff3</span><br><span class="line">##gff-version 3</span><br><span class="line">Chr1    MSU_osa1r7      gene    2903    10817   .       +       .       ID=LOC_Os01g01010;Name=LOC_Os01g01010;Note=TBC%20domain%20containing%20protein%2C%20expressed</span><br><span class="line">Chr1    MSU_osa1r7      mRNA    2903    10817   .       +       .       ID=LOC_Os01g01010.1;Name=LOC_Os01g01010.1;Parent=LOC_Os01g01010</span><br><span class="line">Chr1    MSU_osa1r7      exon    2903    3268    .       +       .       ID=LOC_Os01g01010.1:exon_1;Parent=LOC_Os01g01010.1</span><br><span class="line">Chr1    MSU_osa1r7      exon    3354    3616    .       +       .       ID=LOC_Os01g01010.1:exon_2;Parent=LOC_Os01g01010.1</span><br><span class="line">Chr1    MSU_osa1r7      exon    4357    4455    .       +       .       ID=LOC_Os01g01010.1:exon_3;Parent=LOC_Os01g01010.1</span><br><span class="line">Chr1    MSU_osa1r7      exon    5457    5560    .       +       .       ID=LOC_Os01g01010.1:exon_4;Parent=LOC_Os01g01010.1</span><br><span class="line">Chr1    MSU_osa1r7      exon    7136    7944    .       +       .       ID=LOC_Os01g01010.1:exon_5;Parent=LOC_Os01g01010.1</span><br><span class="line">Chr1    MSU_osa1r7      exon    8028    8150    .       +       .       ID=LOC_Os01g01010.1:exon_6;Parent=LOC_Os01g01010.1</span><br><span class="line">Chr1    MSU_osa1r7      exon    8232    8320    .       +       .       ID=LOC_Os01g01010.1:exon_7;Parent=LOC_Os01g01010.1</span><br><span class="line">Chr1    MSU_osa1r7      exon    8408    8608    .       +       .       ID=LOC_Os01g01010.1:exon_8;Parent=LOC_Os01g01010.1</span><br><span class="line">Chr1    MSU_osa1r7      exon    9210    9617    .       +       .       ID=LOC_Os01g01010.1:exon_9;Parent=LOC_Os01g01010.1</span><br><span class="line">Chr1    MSU_osa1r7      exon    10104   10187   .       +       .       ID=LOC_Os01g01010.1:exon_10;Parent=LOC_Os01g01010.1</span><br><span class="line">Chr1    MSU_osa1r7      exon    10274   10430   .       +       .       ID=LOC_Os01g01010.1:exon_11;Parent=LOC_Os01g01010.1</span><br><span class="line">Chr1    MSU_osa1r7      exon    10504   10817   .       +       .       ID=LOC_Os01g01010.1:exon_12;Parent=LOC_Os01g01010.1</span><br><span class="line">Chr1    MSU_osa1r7      five_prime_UTR  2903    3268    .       +       .       ID=LOC_Os01g01010.1:utr_1;Parent=LOC_Os01g01010.1</span><br><span class="line">Chr1    MSU_osa1r7      five_prime_UTR  3354    3448    .       +       .       ID=LOC_Os01g01010.1:utr_2;Parent=LOC_Os01g01010.1</span><br><span class="line">Chr1    MSU_osa1r7      CDS     3449    3616    .       +       .       ID=LOC_Os01g01010.1:cds_1;Parent=LOC_Os01g01010.1</span><br><span class="line">Chr1    MSU_osa1r7      CDS     4357    4455    .       +       .       ID=LOC_Os01g01010.1:cds_2;Parent=LOC_Os01g01010.1</span><br><span class="line">Chr1    MSU_osa1r7      CDS     5457    5560    .       +       .       ID=LOC_Os01g01010.1:cds_3;Parent=LOC_Os01g01010.1</span><br><span class="line">Chr1    MSU_osa1r7      CDS     7136    7944    .       +       .       ID=LOC_Os01g01010.1:cds_4;Parent=LOC_Os01g01010.1</span><br><span class="line">Chr1    MSU_osa1r7      CDS     8028    8150    .       +       .       ID=LOC_Os01g01010.1:cds_5;Parent=LOC_Os01g01010.1</span><br><span class="line">Chr1    MSU_osa1r7      CDS     8232    8320    .       +       .       ID=LOC_Os01g01010.1:cds_6;Parent=LOC_Os01g01010.1</span><br></pre></td></tr></table></figure>
<p>注意粳稻有两个版本的基因组，使用的染色体编号与基因编号均有不同，曾经因为参考基因组版本问题导致生成的比对 bam 格式文件无法浏览，后续查询才发觉问题。</p>
<h3 id="新的分析项目"><a class="markdownIt-Anchor" href="#新的分析项目"></a> 新的分析项目</h3>
<p>某分析项目的 gff 文件如下所示，这是哪个版本的基因组？</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">Chr1    MSU_osa1r7      gene    2903    10817   .       +       .       ID=LOC_Os01g01010;</span><br><span class="line">Chr1    MSU_osa1r7      mRNA    2903    10817   .       +       .       ID=LOC_Os01g01010.1;Parent=LOC_Os01g01010;</span><br><span class="line">Chr1    MSU_osa1r7      exon    2903    3268    .       +       .       ID=LOC_Os01g01010.1:exon_1;Parent=LOC_Os01g01010.1;</span><br><span class="line">Chr1    MSU_osa1r7      exon    3354    3616    .       +       .       ID=LOC_Os01g01010.1:exon_2;Parent=LOC_Os01g01010.1;</span><br><span class="line">Chr1    MSU_osa1r7      exon    4357    4455    .       +       .       ID=LOC_Os01g01010.1:exon_3;Parent=LOC_Os01g01010.1;</span><br><span class="line">Chr1    MSU_osa1r7      exon    5457    5560    .       +       .       ID=LOC_Os01g01010.1:exon_4;Parent=LOC_Os01g01010.1;</span><br><span class="line">Chr1    MSU_osa1r7      exon    7136    7944    .       +       .       ID=LOC_Os01g01010.1:exon_5;Parent=LOC_Os01g01010.1;</span><br><span class="line">Chr1    MSU_osa1r7      exon    8028    8150    .       +       .       ID=LOC_Os01g01010.1:exon_6;Parent=LOC_Os01g01010.1;</span><br><span class="line">Chr1    MSU_osa1r7      exon    8232    8320    .       +       .       ID=LOC_Os01g01010.1:exon_7;Parent=LOC_Os01g01010.1;</span><br></pre></td></tr></table></figure>
<p>经过比对，推测该数据来自：<a target="_blank" rel="noopener" href="http://rice.uga.edu/pub/data/Eukaryotic_Projects/o_sativa/annotation_dbs/pseudomolecules/version_7.0/all.dir/">http://rice.uga.edu/pub/data/Eukaryotic_Projects/o_sativa/annotation_dbs/pseudomolecules/version_7.0/all.dir/</a></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">Index of /pub/data/Eukaryotic_Projects/o_sativa/annotation_dbs/pseudomolecules/version_7.0/all.dir</span><br><span class="line">[ICO]	Name	Last modified	Size	Description</span><br><span class="line">[PARENTDIR]	Parent Directory	 	-	 </span><br><span class="line">[TXT]	APK_ftp_file.txt	2011-10-31 10:12	3.9M	 </span><br><span class="line">[TXT]	POG_ftp_file.txt	2011-10-31 10:12	2.3M	 </span><br><span class="line">[   ]	all.GOSlim_assignment	2011-11-21 10:15	12M	 </span><br><span class="line">[   ]	all.cdna	2011-10-31 10:12	114M	 </span><br><span class="line">[   ]	all.cds	2011-10-31 10:12	91M	 </span><br><span class="line">[   ]	all.chrs.con	2011-10-31 10:11	363M	 </span><br><span class="line">[   ]	all.con	2011-10-31 10:12	364M	 </span><br><span class="line">[   ]	all.gff3	2012-02-07 09:41	78M	 </span><br><span class="line">[   ]	all.interpro	2011-10-31 10:12	62M	 </span><br><span class="line">[   ]	all.locus_brief_info..&gt;	2012-02-07 09:38	6.8M	 </span><br><span class="line">[   ]	all.masked.con.gz	2011-11-21 15:13	78M	 </span><br><span class="line">[   ]	all.pep	2011-10-31 10:11	33M	 </span><br><span class="line">[   ]	all.pfam	2011-10-31 10:12	4.9M	 </span><br><span class="line">[   ]	all.seq	2011-10-31 10:12	165M	 </span><br><span class="line">[TXT]	final_rice_v7_expres..&gt;	2011-10-31 10:12	10M	 </span><br><span class="line">[   ]	final_rice_v7_expres..&gt;	2011-10-31 10:12	38M	 </span><br><span class="line">[   ]	rice_osa1r7_rm.gff3.gz	2011-11-21 15:21	7.5M	 </span><br><span class="line">[   ]	rice_r7_all_tiling_p..&gt;	2011-10-31 10:12	412K	 </span><br></pre></td></tr></table></figure>
<p>将该目录下的文件全部下载</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget -r -np -nH -R index.html  http://rice.uga.edu/pub/data/Eukaryotic_Projects/o_sativa/annotation_dbs/pseudomolecules/version_7.0/all.dir/</span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://example.com/2021/10/27/Linux-Meet-I-O-error-when-using-harddisk-in-Linux/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/fl-photo-202109.jpg">
      <meta itemprop="name" content="FENG Lei">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="FENG's Notes">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/10/27/Linux-Meet-I-O-error-when-using-harddisk-in-Linux/" class="post-title-link" itemprop="url">Linux | Meet I/O error when using harddisk in Linux</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2021-10-27 09:55:01" itemprop="dateCreated datePublished" datetime="2021-10-27T09:55:01+08:00">2021-10-27</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2021-10-28 00:29:37" itemprop="dateModified" datetime="2021-10-28T00:29:37+08:00">2021-10-28</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Linux/" itemprop="url" rel="index"><span itemprop="name">Linux</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>Linux 系统硬盘似乎出问题，报错信息是 I/O error。网上找资料说可以直接做硬盘修复，记录如下。</p>
<p>切换到 root 账户，执行 badblocks 命令查看出错的扇区数量，-b 指定每次扫描的区块大小，设置为和扇区大小一致，后面的数字 <s>1729898440</s> 为日志提示出错的扇区位置，前面的数字 <s>1729898499</s> 指定扫描扇区的终止位置，扫描后可以看到共有 <s>8</s> 个扇区出错。这里的几个数字要根据实际情况来配置。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost fenglei]# badblocks -b 512 /dev/sdb1 2766144199 2766144103     </span><br><span class="line">[root@localhost fenglei]# badblocks -b 512 /dev/sdb 2766144199 2766144103 </span><br><span class="line">2766144104</span><br><span class="line">2766144105</span><br><span class="line">2766144106</span><br><span class="line">2766144107</span><br><span class="line">2766144108</span><br><span class="line">2766144109</span><br><span class="line">2766144110</span><br><span class="line">2766144111</span><br><span class="line">2766144112</span><br><span class="line">2766144113</span><br><span class="line">2766144114</span><br><span class="line">2766144115</span><br><span class="line">2766144116</span><br><span class="line">2766144117</span><br><span class="line">2766144118</span><br><span class="line">2766144119</span><br><span class="line">2766144128</span><br><span class="line">2766144129</span><br><span class="line">2766144130</span><br><span class="line">2766144131</span><br><span class="line">2766144132</span><br><span class="line">2766144133</span><br><span class="line">2766144134</span><br><span class="line">2766144135</span><br><span class="line">2766144136</span><br><span class="line">2766144137</span><br><span class="line">2766144138</span><br><span class="line">2766144139</span><br><span class="line">2766144140</span><br><span class="line">2766144141</span><br><span class="line">2766144142</span><br><span class="line">2766144143</span><br><span class="line">2766144152</span><br><span class="line">2766144153</span><br><span class="line">2766144154</span><br><span class="line">2766144155</span><br><span class="line">2766144156</span><br><span class="line">2766144157</span><br><span class="line">2766144158</span><br><span class="line">2766144159</span><br></pre></td></tr></table></figure>
<p><strong>1 先备份数据（可选）</strong>：若修复的硬盘或分区的重要数据已备份，此部分可以省略。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dd if=/dev/mapper/VolGroup-lv_home  skip=217874591 of=/tmp/217874591-217874595.dat count=5</span><br></pre></td></tr></table></figure>
<p><strong>2 修复</strong>：硬盘在使用时不能修复，否则可能存在写并发的问题，所以修复前需要 umount 对应分区，例如 <code>umount /mnt/sdb</code>。另外注意若为系统所在分区就没办法在线修复了，因为无法 umount。我在执行 umount 命令室收到提示说无法 umount，发现此时并没有打开窗口读取 /mnt/sdb 目录，查找后台才发现原来 /mnt/sda 目录下正在开展的一个分析项目，代码里面有读取 /mnt/sdb 下面的数据，停止这个进程之后，umount 就可以了。再操作下面的命令的时候就通过了。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost fenglei]# badblocks -b 512 -w /dev/sdb 2766144159 2766144104</span><br><span class="line">/dev/sdb is apparently in use by the system; it&#x27;s not safe to run badblocks!</span><br></pre></td></tr></table></figure>
<p>先备份数据（可选），若修复的硬盘或分区的重要数据已备份，此部分可以省略。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dd if=/dev/mapper/VolGroup-lv_home  skip=217874591 of=/tmp/217874591-217874595.dat count=5</span><br></pre></td></tr></table></figure>
<p>在 umount 可能出现&quot;Device busy&quot;错误时，是因为有程序在使用这个分区，需要将这些进程都关闭。那么怎么知道哪些进程占用分区呢？使用 fuser（命令如下），其中 /home 是分区对应的挂载目录。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">fuser -m /home</span><br><span class="line">fuser -m -v -i -k /home</span><br></pre></td></tr></table></figure>
<p>第一条fuser命令列出使用/home的进程ID，第二条列出PID并kill掉进程（带有提示确认），建议先使用第一条命令列出PID，然后针对查看是哪些类型的进程，不要盲目杀死进程。</p>
<p>umount 分区成功后，修复命令如下，其中-s表示给出进度，-w表示写入修复的，后面是结束（END）和开始（START）块号，注意END在前，START在后。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">badblocks -s -w /dev/mapper/VolGroup-lv_home 217874595 217874591</span><br></pre></td></tr></table></figure>
<p>修复后再重新检查下</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">badblocks -s -v /dev/mapper/VolGroup-lv_home 217874595 217874591</span><br></pre></td></tr></table></figure>
<p><strong>恢复数据（可选）</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dd if=/tmp/217874591-217874595.dat of=/dev/mapper/VolGroup-lv_home </span><br></pre></td></tr></table></figure>
<p><strong>重新分区检查</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">badblocks -s -v -o /root/bb-home.log /dev/mapper/VolGroup-lv_home</span><br></pre></td></tr></table></figure>
<p>若没有坏道说明修复已完成，若有坏道可以尝试重复以上方法。</p>
<p>完成后重新mount分区</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mount /dev/mapper/VolGroup-lv_home /home</span><br></pre></td></tr></table></figure>
<p><strong>硬盘使用的一些建议</strong></p>
<p>硬RAID还是要有的。硬件RAID服务器自带，性能比软件RAID要高。根据对数据的安全性、硬盘大小，存储性能来评估该选择的RAID类型，常用的RAID类型如下：</p>
<p>RAID0：存储性能（读写效率）最高，连续的数据分散到多个磁盘上存储，提高并发访问。<br />
RAID1：数据安全性高，即同样的数据在另一块盘上备份一份，硬盘的容量也就减少一半。<br />
RAID5：兼具RAID0和RAID1的优点。存储性能大于RAID1，小于RAID0；数据安全性大于RAID0，小于RAID1。</p>
<p>读写频繁的操作不要放在/分区<br />
/ 分区是存放系统程序的，一般也比较小，读写频繁的日志不要放在根分区，这样损坏起码不会影响系统的稳定性。</p>
<p><strong>参考资料</strong><br />
1 <a target="_blank" rel="noopener" href="https://www.cnblogs.com/augusite/p/10931175.html">https://www.cnblogs.com/augusite/p/10931175.html</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://example.com/2021/10/20/Bioinfo-CUT-Tag-sequencing-and-ChIP-sequencing/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/fl-photo-202109.jpg">
      <meta itemprop="name" content="FENG Lei">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="FENG's Notes">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/10/20/Bioinfo-CUT-Tag-sequencing-and-ChIP-sequencing/" class="post-title-link" itemprop="url">Bioinfo | CUT&Tag sequencing and ChIP sequencing</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2021-10-20 16:35:06" itemprop="dateCreated datePublished" datetime="2021-10-20T16:35:06+08:00">2021-10-20</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2021-10-22 10:23:20" itemprop="dateModified" datetime="2021-10-22T10:23:20+08:00">2021-10-22</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Bioinformatics/" itemprop="url" rel="index"><span itemprop="name">Bioinformatics</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>CUT&amp;Tag 技术研究蛋白与染色质结合，相对于 ChIP Seq 技术具有显著优势，这个方法的原理是什么？先需要提到的是染色质免疫切割技术。CUT&amp;RUN 是一项对染色质免疫切割技术（ChIC）在全基因组范围的扩展方法，由 Laemmli 实验室开发（Schmid et al., 2004）。ChIC 使用蛋白 A-MNase 融合蛋白切割与靶蛋白相关并被特异性抗体识别的 DNA 区域。但是，ChIC 只能通过 southern blot 对特定位点进行分析。与此有关的一种方法是染色质内源性切割（ChEC），这种方法通过融合目标蛋白和 MNase 来分析目标蛋白在全基因组范围的结合位点（Schmid et al., 2004; Zentner et al ., 2015）。这种方法有一个明显的缺点，那就是需要为各目标蛋白生成特异性融合蛋白。CUT&amp;RUN 在这两种方法的基础上有了重大改进，它通过抗体将重组蛋白 A/G-MNase 固定在了目标蛋白处（Meers et al., 2019; Skene and Henikoff, 2017）。</p>
<p>重要的是，该方法可以回收 MNase 消化的片段，因此可用于基于测序的蛋白占用和组蛋白修饰定位的全基因组分析。与基于 ChIP 的方法相比，CUT&amp;RUN 具有以下优势：使用磁珠固定细胞核，简化了操作步骤；适用于新鲜组织样本和冷冻组织样本；缩短了生成 DNA 测序文库制备材料的时间（1-2 天）。此外，由于对目标蛋白两侧的 DNA 进行了原位靶向切割，因此只有靶点 DNA 片段才会从细胞核中释放并被收集，从而留下脱靶序列。因此，CUT&amp;RUN 产生的背景信号比 ChIP 少得多。自开发以来，CUT&amp;RUN 已被调整用于多种实验设置，包括自动化高通量表观遗传学分析（AutoCUT&amp;RUN）（Janssens et al., 2018）、不溶性染色质分析（如使用 CUT &amp; RUN.Salt (Thakur and Henikoff, 2018) 和 CUT&amp;RUN.ChIP 对着丝粒区域进行分析），用于检查 CUT &amp; RUN 消化 (Brahma and Henikoff, 2019) 释放的复合物中的特定蛋白组分。最显著的是，CUT&amp;RUN 对 input 的要求极低且信噪比高，这意味着其可用于单细胞分析，例如，用于研究单个小鼠胚胎细胞中的转录因子占有率（Hainer and Fazzio, 2019）。</p>
<p>CUT&amp;Tag 由 Henikoff 实验室（Kaya-Okur et al., 2019）于 2019 年发布，衍生自 CUT&amp;RUN 实验方案，可以加快文库制备并简化自动化操作。<font color=blue>CUT&amp;Tag 对天然或轻微固定的染色质进行抗体引导的标签化，并据此识别全基因组中目标蛋白占据的位置。CUT&amp;Tag 方法中用到了预装接头 DNA 并与蛋白 A 融合的超高活性 Tn5 转座酶。这种融合蛋白能与一抗结合，在抗体附近切割 DNA，并插入带有接头序列的短标签（标签化）。回收标签化的 DNA 片段后，使用引物识别添加的标签中的序列进行 PCR 扩增，以生成下一代测序（NGS）文库。特定区域的序列读取频率与靶蛋白占据的位置或组蛋白修饰的位置对应。</font></p>
<p>CUT&amp;RUN 和 CUT&amp;Tag 是两种操作简单、用途广泛且功能强大的 DNA-蛋白质相互作用分析方法，应成为每位分子生物学家的必备工具。这两种方法都有助于在全基因组范围内识别特定基因，以及以组蛋白修饰标记或与目标蛋白结合的顺式调控因子，从而深入了解基于染色质的基因控制机制。由于所需的起始材料极少，所以 CUT&amp;RUN 和 CUT&amp;Tag 在稀有细胞类型研究方面具有独特的优势。最重要的是，这两种方法的实验方案都简单易用，省时省力，可以快速周转，因此研究人员能够进行多项平行分析，从而更加全面地了解基因组调控的复杂性。</p>
<p>转录因子和组蛋白通过与DNA相互作用（DNA-Protein Interaction, DPI）发挥着调控基因复制、表达、重组和修复的重要作用，在实现细胞功能的过程中至关重要。其中转录因子组合决定了细胞的增值、分化以及死亡，是表观基因组学研究的重要组成部分。研究 DNA-蛋白质相互作用的实验方法主要有凝胶阻滞实验、DNase 1 足迹实验、甲基化干扰实验、体内足迹实验和 ChIP-seq 等。基于 NGS 研究手段的 ChIP-seq 技术可以真实反应靶蛋白在全基因组上的结合情况，是非常经典的 DNA 结合位点分析方法，至今仍然在广泛使用。</p>
<p>ChIP-Seq 的基本实验流程过程包括（图1）：甲醛交联将 DNA 结合蛋白和 DNA 紧密固定；然后抽提染色质，超声破碎 DNA 断裂，片段范围在 200-500 bp 之间；抗体孵育结合靶转录因子，Protein A/G 磁珠拉取抗体-蛋白-DNA 复合物；蛋白消化后再通过 PCR、芯片或者二代测序对 DNA 序列进行鉴定。</p>
<p><img src="https://i.imgur.com/l384XKj.jpeg" alt="图1 ChIP Seq 原理示意图" /></p>
<p>看似简单，实则有几个技术难题，如果实验条件摸索不成熟会消耗大量时间。首先，ChIP需要较多的细胞量，免疫共沉淀需要足够的靶标蛋白，而靶标蛋白有限的情况下就需要提供大量的细胞；<br />
其次，信噪比低，很多转录因子和染色体的结合相对松散，需要甲醛强交联，以防止后续洗涤过程破坏这些结合，这样导致很多非特异性信号，需要更高的数据量得到真实peak值；此外，实验的打断条件、重复性差等都需要系统的摸索才能得到较好的结果。这些因素综合起来导致ChIP对新手非常不友好，需要采购特定的设备、很长时间的预实验才能得到满意的结果。</p>
<p>为了克服这些难题，CUT&amp;Run 以及更加成熟 CUT&amp;Tag 被开发出来。2019 年，美国弗雷德哈钦森癌症研究中心的 Henikoff 博士在 Nature Communication 公开了 CUT&amp;Tag 技术的详细结果与实验方案。</p>
<p><font color=blue>CUT&amp;Tag（Cleavage Under Targets and Tagmentation, CUT&amp;Tag）技术，它免去了甲醛交联、超声破碎和免疫共沉淀的过程，这样既节省了初始实验材料又提高了信噪比、提升了实验重复性。</font>基本技术流程包括（图2）：首先，特异性抗体和靶标蛋白孵育结合；加入Tn5转座酶—Protein A复合物，其中Tn5转座酶两端已装载好建库接头引物；特异性抗体和Protein A相结合，转座酶Tn5被“拉”到转录因子附近；转座酶Tn5一次性完成附近DNA打断并完成NGS加接头过程，可直接建库[2]。基于CUT&amp;Tag，单细胞转录因子结合位点的研究也成为可能[2]，这也展示了CUT-Tag的潜能。<br />
转录组测序</p>
<p><img src="https://i.imgur.com/mSTAtC1.jpeg" alt="图2 CUT&amp;Tag seq 原理示意图" /></p>
<p>为证明Cut&amp;Tag技术的有效性，Henikoff 博士在对组蛋白H3K27me3进行研究时对比使用了 ChIP-seq、Cut&amp;RUN、Cut&amp;Tag 三种方法。从不同角度对三组数据进行比较后，发现 Cut&amp;Tag 技术具有显著优势，具体结果如下：</p>
<ol>
<li>CUT&amp;Tag 具有更好的信噪比和更低的背景<br />
研究者将三种方法的数据量都设置为8M Reads，结果显示三者得到的染色体pattern相似。但ChIP-seq的背景噪声非常高，增加数据量到50M Reads时，才能达到类似的峰图，因此ChIP-seq需要更大的测序深度才能达到去背景噪音的结果。相反，Cut＆RUN和Cut＆Tag均具有极低的背景噪声水平，其中Cut＆Tag的背景噪音最低。</li>
</ol>
<p><img src="https://i.imgur.com/dFuPanX.jpeg" alt="图3 ChIP-Seq 、CUT&amp;RUN、CUT&amp;Tag 实验结果对比" /></p>
<ol start="2">
<li>CUT&amp;Tag 在识别染色质特征时最高效</li>
</ol>
<p><img src="https://i.imgur.com/4kiBShb.jpeg" alt="Fig 4" /></p>
<p>图 4 左图为 CUT&amp;Tag、CUT&amp;RUN、ChIP-Seq 三种方法分析 H3K4me1 组蛋白修饰，CUT&amp;Tag 在识别染色质特征时最有效，能够给出 ChIP-Seq 无法读出的信息；右图为 peak-calling 的对比，使用默认参数调用每种方法上的峰值，结果显示 CUT&amp;Tag 比 CUT&amp;RUN、ChIP-seq 或 ATAC-seq 有更高的信号。</p>
<ol start="3">
<li>重复性好，灵敏度高</li>
</ol>
<p>三种方法对H3K4me1数据分析，并对结果进行分层聚类相关矩阵分析，结果显示显示CUT&amp;Tag重复样本的数据有高度的相似性，说明了CUT&amp;Tag的可重复性高。</p>
<p><img src="https://i.imgur.com/J9MfdEm.jpeg" alt="Fig 5" /></p>
<p>图5 a：CUT&amp;Tag、CUT&amp;RUN、ChIP-Seq三种方法分析H3K4me1组蛋白修饰：CUT&amp;Tag在识别染色质特征时最有效，能够给出ChIP-Seq无法读出的信息；b：peak-Calling的对比，使用默认参数调用每种方法上的峰值，结果显示CUT&amp;Tag比CUT&amp;RUN、ChIP-seq或ATAC-seq有更高的信号。</p>
<ol start="4">
<li>CUT&amp;Tag 能对极少量细胞甚至单细胞进行分析</li>
</ol>
<p>CUT&amp;Tag 能够对极少量细胞（60 个细胞）甚至单细胞进行分析。由于 PCR 之前的反应都在细胞内进行，Henikoff 博士通过分配单个细胞到 5184 纳米孔，再加入带随机标签的引物进行扩增的办法，实现单细胞测序。</p>
<p><img src="https://i.imgur.com/pgHzjVI.jpeg" alt="图6 CUT&amp;Tag 单细胞测序流程" /></p>
<p>Cut&amp;Tag注意事项：一个好的抗体是CUT&amp;Tag成功的前提！这个抗体要能识别天然构象蛋白且特异性强，最好选用文献验证过的抗体，实验前并进行IP验证。如果实在没有合适的抗体，可以选择标签蛋白，如FLAG和HA等经过有效验证的单克隆抗体。</p>
<p>参考文献：</p>
<p>genewiz: <a target="_blank" rel="noopener" href="https://www.genewiz.com.cn/Public/Resources/zxzx/0038/">https://www.genewiz.com.cn/Public/Resources/zxzx/0038/</a><br />
abcam: <a target="_blank" rel="noopener" href="https://www.abcam.cn/epigenetics/chromatin-profiling-guide-1">https://www.abcam.cn/epigenetics/chromatin-profiling-guide-1</a></p>
<p>[1] Kaya-Okur HS, Wu SJ, Codomo CA, Pledger ES, Bryson TD, Henikoff JG,Ahmad K, Henikoff S. CUT&amp;Tag for efficient epigenomic profilingof small samples and single cells. Nat Commun. 2019 Apr29;10(1):1930. doi: 10.1038/s41467-019-09982-5. PMID: 31036827;PMCID: PMC6488672.<br />
[2] Wang Q, Xiong H, Ai S, Yu X,Liu Y, Zhang J, He A. CoBATCH for High-Throughput Single-CellEpigenomic Profiling. Mol Cell. 2019 Oct 3;76(1):206-216.e7. doi:10.1016/j.molcel.2019.07.015. Epub 2019 Aug 27. PMID: 31471188.</p>
<p>CUT&amp;RUN 实验方案概述</p>
<p>运行 CUT&amp;RUN 过程中，需使用靶向目标蛋白（例如具有特定修饰的组蛋白或转录因子）的抗体将蛋白 A/G 标记的 MNase 引导至基因组中目标蛋白所在区域。</p>
<p>然后，活化 MNase，切除那些接近目标蛋白的 DNA 序列，这时小片段会从细胞核中释放出来。收集这些 DNA 片段，并通过低 input DNA 文库制备试剂盒生成 NGS 文库。</p>
<p><img src="https://i.imgur.com/Vwb1FCW.png" alt="" /></p>
<p>图 1. CUT&amp;RUN 实验方案示意图。细胞核附着在磁性伴刀豆球蛋白 A 磁珠上，以便进行细胞处理并在每次洗涤后安全除去液体。对细胞核进行通透处理，同时与靶向目标蛋白的抗体一起孵育。蛋白 A/G-MNase 融合蛋白与靶向目标蛋白的抗体结合。添加 Ca2+ 时，MNase 会切割所形成的复合物两侧的 DNA，并释放从细胞核中扩散出的 DNA 片段。提取 DNA 并在基于末端修复和接头连接制备 DNA 文库时使用。NGS 通过特定区域中序列的频率给出目标蛋白的结合信息。</p>
<p>该实验方案可分为五个部分：<br />
1.提取细胞核并与磁珠结合<br />
CUT&amp;RUN 通常使用未固定的新鲜样本作为起始材料，但是对实验方案做出调整后，也可以使用在 10% DMSO 中冷冻保存的样本（Janssens et al ., 2018; Skene et al ., 2018）。</p>
<p>进行该实验方案所需的材料很少，一般建议先使用不超过 500,000 个细胞（哺乳动物）。</p>
<p>用 Henikoff 推荐的细胞核提取缓冲液释放细胞或细胞核，并与伴刀豆球蛋白 A 磁珠结合，这种磁珠具有独特的糖结合特性。也可以使用其他兼容的细胞核提取实验方案（使用含 Triton X-100 的缓冲液时，请查看下述建议）。执行剩余实验方案时，可以使用磁力架轻松洗涤样本。</p>
<p>2.通透技术和抗体结合<br />
对与伴刀豆球蛋白 A 磁珠结合的细胞核作通透处理，同时在含洋地黄皂苷和 EDTA 的缓冲液中与靶向目的蛋白的抗体（一抗）一起孵育。EDTA 可迅速中断细胞代谢，从而抑制内源性 DNAse 的活性，保留染色质并降低总体背景信号。用户可自行调整该步骤的持续时间；通常为 2 小时到过夜不等。建议首先按 1:100 或 0.5 µg - 1.0 µg 稀释抗体，但需优化抗体的用量。建议加入阳性（α-H3K27me3）和阴性对照（同型对照 IgG）样本。</p>
<p>需要注意的是，抗体种属不同，蛋白 A 和蛋白 G 的结合效率也不同（点击查看）。虽然相较单独使用蛋白 A 而言，使用蛋白 A/G 可以增强抗体的兼容性，但在某些情况下可能需要使用二抗。二抗通过增加蛋白 A/G 结合区域的数量将 MNAse 引导至目标区域，从而帮助回收低丰度的目标序列。</p>
<p>3.MNase 结合和靶序列切割<br />
为了将蛋白 A/G-MNase 定位到抗体结合的基因组靶区域，需在含洋地黄皂苷的洗涤缓冲液中稀释融合蛋白并与细胞核一起孵育。然后洗去未结合的酶融合蛋白，于 0℃ 加入 Ca2+ 离子激活 MNase。虽然切割本身对温度不是特别敏感，但是切割后的 DNA 片段的后续扩散对温度很敏感，而且温度升高会导致更高的背景。如果最终物质中的高分子量片段过多或过少，可以调整消化时间。</p>
<p>4.DNA 回收<br />
添加含 EGTA 的终止缓冲液，终止 MNase 活性。该缓冲液可以选择性地包含异源 DNA 添加物，以便在数据处理过程中用于校准 CUT&amp;RUN 分析。通过提高孵育温度，促使细胞核释放 MNase 产生的片段，并用苯酚/氯仿/异戊醇提取这些片段，然后用乙醇进行沉淀。</p>
<p>修改实验方案可以进一步限制 MNase 融合蛋白从其结合位点过早释放、扩散以及非特异性切割。</p>
<p>该版本实验方案联合使用低盐缓冲液和高浓度 Ca2+ 溶液激活 MNase，非常适合主要在活性开放染色质中发现的靶点，但抗体显示高背景信号时，也可以使用。</p>
<p>5.文库制备和测序<br />
清除切割后的 DNA 片段后，根据制造商指南，使用标准末端修复和接头连接方法生成低 input DNA 文库。Henikoff 实验室最初建议使用 TRUseq 文库制备法，但是现在已有大量使用 NEBNext® Ultra™ II DNA 文库试剂盒的报告。与自动化 CUT&amp;RUN 实验方案（Jenssens et al. 2018）类似，您也可以省略苯酚/氯仿/异戊醇提取步骤，直接将释放的 DNA 片段用于基于末端修复和接头连接的实验方案。</p>
<p>文库的大小分布和浓度可通过毛细管电泳（例如 Bioanalyzer 或 TapeStation）确定。可以将多个文库合并，每个文库获得约 800 万配对末端测序读段。由于 CUT&amp;RUN 文库的背景较低，因此 800 万配对末端读段足以分析组蛋白修饰，甚至转录因子。</p>
<p>大部分常规 ChIP-seq 数据分析工具都可以分析 CUT&amp;RUN 数据。Henikoff 实验室也专门为 CUT&amp;RUN 数据设计了一些分析工具，例如 SEACR peak caller（Meers et al ., 2019b）。对于经校准的 CUT&amp;RUN，添加了终止缓冲液的异源 DNA 添加物可用于样本信号的归一化。此外，重组蛋白 A/G-MNase 残留的大肠杆菌 DNA 也可用作添加物。</p>
<p>CUT&amp;Tag 实验方案概述<br />
运行 CUT&amp;Tag 过程中，需使用抗体将蛋白 A 标记的 Tn5 转座酶引导至目标蛋白（例如具有特定修饰的组蛋白或转录因子）所在的基因组区域。Tn5 片段和标签靶向带有特定预定义核苷酸序列（接头）的 DNA。标签化的 DNA 可以轻松回收，并进行 PCR 扩增，从而生成 NGS 文库。整个实验方案仅需一天即可完成，具体取决于抗体孵育时间。</p>
<p><img src="https://i.imgur.com/OC0ezUh.png" alt="" /></p>
<p>​​图 2. CUT&amp;Tag 实验方案示意图。细胞核附着在磁性伴刀豆球蛋白 A 磁珠上，以便进行细胞处理并在每次洗涤后安全除去液体。对细胞核进行通透处理，同时与靶向目标蛋白的一抗一起孵育，然后与识别一抗的二抗一起孵育。蛋白 A-Tn5 融合蛋白与目标蛋白上形成的抗体复合物结合。添加 Mg2+ 离子时，Tn5 会切割所形成的复合物两侧的 DNA，并释放从细胞核中扩散出的已切割 DNA 片段。提取 DNA 并在基于 PCR 扩增制备 DNA 文库时使用。NGS 通过特定区域中序列的频率给出目标蛋白的结合信息。</p>
<p>该实验方案可分为五个部分：</p>
<ol>
<li>提取细胞核并与磁珠结合</li>
</ol>
<p>CUT&amp;Tag 通常使用未固定的新鲜样本作为起始材料，但对实验方案进行修改后，也可以使用冷冻样本，近期，还可使用提取细胞核后经福尔马林轻微固定的样本。固定步骤可以降低执行实验方案期间细胞核聚集在一起的可能性。使用由含 Triton X-100 的缓冲液产生的固定和冷冻保存样本时，可从所有缓冲液中除去洋地黄皂苷，这样可以进一步减少磁珠结块。但是，需要注意，在某些情况下，表位固定会干扰抗体的结合。通常建议先使用不超过 500,000 个细胞（哺乳动物）。使用新鲜或冷冻组织时，细胞核的制备与 CUT&amp;RUN 实验方案中的细胞核制备类似（Janssens et al ., 2018; Skene et al ., 2018）。对于 CUT&amp;RUN，细胞核与伴刀豆球蛋白 A 磁珠结合，可以使用磁力架轻松洗涤样本。但是，该步骤可以省略，并且整个实验方案可以按以下方式执行：每次洗涤后，温和离心，然后小心除去上清液，不干扰沉淀的细胞核。</p>
<ol start="2">
<li>通透技术和抗体结合</li>
</ol>
<p>对结合至伴刀豆球蛋白 A 磁珠的细胞核进行通透处理，同时在含洋地黄皂苷的缓冲液中与靶向目的蛋白的抗体（一抗）一起孵育。该步骤的持续时间可以调整，最短 2 小时，最长 5 天。抗体的推荐稀释度通常在 1:50 至 1:100（或 0.5 µg - 1.0 µg）之间，但需优化抗体的使用量。建议加入阳性（α-H3K27me3）和阴性对照（同型对照 IgG）样本。一抗孵育后，用含洋地黄皂苷的洗涤缓冲液快速洗涤，然后将细胞核与二抗一起孵育，这里使用的二抗需靶向一抗，充当桥接抗体并且可以增加蛋白 A 结合位点的数量。在 CUT&amp;RUN 实验方案中，这一步骤可以省略；但在 CUT&amp;Tag 实验方案中，必须执行这一步骤，以增强信号。需要注意的是，抗体类别不同，蛋白 A 的结合效率也不同，因此需要事先检查二抗与蛋白 A 的兼容性。</p>
<ol start="3">
<li>Tn5 结合和标签化</li>
</ol>
<p>为了将蛋白 A-Tn5 转座酶与目标抗体结合，需在含洋地黄皂苷的高盐缓冲液中稀释带接头的 Tn5 融合蛋白，并与细胞核一起孵育。在该步骤中增加盐浓度有助于减少脱靶标签化，主要是可接触的基因组区域的脱靶标签化，从而产生类似 ATAC 的峰。与 Tn5 融合蛋白一起孵育后，洗涤细胞核，以除去未结合的 Tn5，并在添加 Mg2+ 离子的高盐洋地黄皂苷缓冲液中于 37℃ 下孵育，从而激活标签化。</p>
<ol start="4">
<li>DNA 回收</li>
</ol>
<p>添加 EDTA 终止标签化，并用 SDS 和蛋白酶 K 裂解细胞核。然后可以通过多种方式清除 DNA 片段，原实验方案建议先用苯酚/氯仿/异戊醇提取这些片段，再用乙醇进行沉淀。您也可以使用 AMPure 磁珠来清除 DNA 片段。建议在沉淀步骤中避免使用任何载体，例如糖原，因为载体会降低后续 PCR 反应的效率。</p>
<ol start="5">
<li>通过 PCR 扩增和测序制备文库</li>
</ol>
<p>由于 Tn5 在标签化过程中会在 DNA 片段中引入兼容序列，所以使用通用 i5 引物和带条形码的 i7 引物进行的简单 PCR 反应就可以生成测序文库，让 DNA 文库的制备变得极为快速简便。该步骤与 ATAC-seq 类似，因此可以使用 ATAC 实验方案描述的引物序列（Buenrostro et al ., 2013）。但需要根据用户的机器调整循环程序。为了确保 PCR 有效，需要进行短时间的退火操作；如使用缓慢升温循环仪，则可以省略退火步骤，因为变性和延伸之间的冷却时间较长，足以退火。如使用快速升温机器，则必须增加退火步骤。通常，建议不超过 12 到 14 个扩增循环，否则，文库的复杂性将降低，而 PCR 的重复率升高。</p>
<p>在 PCR 扩增后，可用毛细管凝胶电泳法（例如 Bioanalyzer 或 TapeStation）对 CUT&amp;Tag 文库进行评估。CUT&amp;Tag 实验的失败通常表现在阳性对照样本中不存在核小体片段。</p>
<p>但是，如果只在转录因子 CUT&amp;Tag 文库中观察到非常弱的信号，实验仍然可以继续，这种情况很常见。通过凝胶电泳进行评估后，可以使用 SPRI 磁珠清理并浓缩文库。可以将多个文库合并，每个文库获得约 200 万配对末端测序读段。</p>
<p>大部分常规 ChIP-seq 数据分析工具都可以分析 CUT&amp;Tag 数据。Henikoff 实验室也专门为 CUT&amp;RUN 和 CUT&amp;Tag 数据设计了一些分析工具，例如 SEACR peak caller（Meers et al ., 2019b）。要想校准 CUT&amp;Tag 数据，可以将重组蛋白 A-Tn5 残留的大肠杆菌 DNA 用作普通添加物。</p>
<p>样本制备</p>
<p>由于 CUT&amp;RUN 和 CUT&amp;Tag 都可以使用未固定的新鲜样本，所以，它们的样本制备非常简单。但是需要以适合所用细胞类型的方式制备单细胞悬液，包括使用解离试剂（如 Accutase™）、从细胞培养皿上刮下细胞或机械解离组织等。</p>
<p>为了便于收集，可以在 10% DMSO 中冷冻保存样本，并在 Mr. Frosty 异丙醇冻存盒内冻存。两种方法均不需要固定样本，但是，如果磁珠在洗涤过程中结块，则应在孵育抗体前，于室温下使用 0.1% 福尔马林对样本进行轻固定，2 分钟即可。</p>
<p>抗体选择</p>
<p>至于 ChIP，并非所有抗体都可以用于 CUT&amp;RUN 和 CUT&amp;Tag。由于这两种方法较新，大多数抗体均未经过兼容性测试，因此终端用户需要对抗体进行测试和优化。ChIP 级抗体大都适用于 CUT&amp;RUN 和 CUT&amp;Tag，特别是适用于天然 ChIP 的 ChIP 级抗体。</p>
<p>试用非 ChIP 级抗体时，假设特异性已进行充分表征，可以首先选择能够识别目标蛋白天然形式的抗体；例如，在免疫沉淀或免疫细胞化学中起作用的抗体。同理，在考虑 CUT&amp;RUN 或 CUT&amp;Tag 实验所用的抗体浓度时，可以将免疫荧光法的推荐浓度作为起始浓度。需测试抗体与蛋白 A 和蛋白 G 的兼容性，必要时，可使用合适的二抗。</p>
<p>对照</p>
<p>与其他实验类型一样，添加合适的对照是确保实验符合预期并能在实验失败时轻松确定问题区域的关键。</p>
<p>与 ChIP 不同，该实验方案不需要 input 样本，因为非抗体引导的 MNase 处理或标签化仅可识别可接触的染色质。为了从样本中获取背景并为实验设置基线，应添加 IgG 对照。在抗体对照方面，Henikoff 实验室建议使用 H3K27me3 作为 CUT&amp;RUN 和 CUT&amp;Tag 实验的阳性对照。使用未修饰的总组蛋白对照，例如总组蛋白 H3，可以按比例显示组蛋白修饰。</p>
<p>优化</p>
<p>使用这些技术时，需要在多个阶段对 CUT&amp;RUN 和 CUT&amp;Tag 实验方案进行优化。</p>
<p>透化</p>
<p>初版实验方案要求对洗涤缓冲液中所用的洋地黄皂苷的浓度进行测定，以确保有效地对细胞核作通透处理。如果您对实验方案作了改进，具体来说就是在洗涤缓冲液中添加了 NP40，则有可能不需要进行上述测定。但是，在新材料上使用这两种技术时，应牢记细胞核的通透效率。</p>
<p>抗体浓度</p>
<p>采用滴定法测定每次反应使用的抗体量很重要，起始稀释度可以参考 ChIP 或免疫荧光检测法的推荐稀释度。</p>
<p>抗体孵育时间</p>
<p>室温下，一抗孵育 1 小时即可；但在冷藏室中，孵育时间可延长至 1 至 5 天。对于每项实验使用的抗体，可以对孵育时间进行优化；但应牢记，孵育时间过长可能会增加背景信号，最终导致总体信噪比不佳。</p>
<p>使用二抗</p>
<p>如果在只使用一抗的情况下，回收率较低，则强烈建议在 CUT&amp;Tag 中使用二抗，还可以考虑在 CUT&amp;RUN 中使用二抗。添加二抗的另一个原因是为了避免蛋白 A/G 与一抗的配对不符合预期，添加合适类别的二抗可以改善这一点。</p>
<p>消化和标签化时间</p>
<p>MNase 消化和 Tn5 标签化的时间可以根据目标蛋白进行调整。低丰度蛋白要想回收所有位点可能需要花费更多时间。要记住的是，消化或标签化时间过长可能会导致无针对性的切割，从而产生高背景信号。</p>
<p>常见问题</p>
<ul>
<li>
<p>起始材料应该使用多少个细胞？<br />
模式生物的基因组小于人/小鼠基因组时，是否需要增加细胞数量？建议每个样本不超过 500,000 个细胞。一般来说，起始量为 50,000 个细胞比较好。与 ChIP 不同，CUT &amp;RUN 和 CUT＆Tag 非常敏感，所以不需要上百万个细胞作为起始材料。细胞数量过多会降低收率，甚至降低文库的复杂性。</p>
</li>
<li>
<p>增加细胞用量时，是否应增加伴刀豆球蛋白 A 磁珠的用量？<br />
每次实验使用的细胞数不应超过 500,000 个。由于实验方案已对使用 50,000 至 500,000 个细胞时的磁珠数量进行了优化，因此不需要在实验方案建议的磁珠用量基础上另行增加。</p>
</li>
<li>
<p>如何冷冻保存细胞确保其可用于 CUT＆RUN 或 CUT &amp;Tag？<br />
建议在合适的缓冲液或培养基中添加 10％ DMSO，然后使用 Mr. Frosty 异丙醇冻存盒缓慢冻存。不建议快速冻存。</p>
</li>
<li>
<p>我有固定和冷冻 ChIP 细胞，可以将它们用于 CUT&amp;RUN 或 CUT＆Tag 吗？<br />
可以，但具体要看 ChIP 样本的固定和冷冻保存条件。由于 ChIP 样本的细胞数可能会超过 CUT&amp;RUN 和 CUT&amp;Tag 的推荐用量，并且使用强固定条件（如双重固定和淬灭）会损害 MNase 或 Tn5 的活性，所以标准实验方案可能不太适合。您可以将样本分成多份，这样可以轻松避免 ChIP 样本中细胞数超过 CUT&amp;RUN 或 CUT&amp;Tag 推荐起始量的问题。但是，样本固定和冻存等问题仍然存在。ChIP 实验方案的固定条件比较严格，很难与 CUT&amp;RUN 或 CUT&amp;Tag 兼容，因为严格的固定条件很可能会损害 MNase 或 Tn5 片段化/标签化目标序列的能力，并且已有大量报道暗示了这种不兼容性。另外，固定还有可能导致抗原表位被掩盖。因此，不建议固定样本。冷冻保存用于 CUT&amp;RUN 或 CUT&amp;Tag 的细胞时，需要使用 10% DMSO 和 Mr. Frosty 异丙醇冻存盒缓慢冻存样本。不建议在大多数 ChIP 实验方案中增加快速冻存步骤。</p>
</li>
<li>
<p>为什么洗涤过程中磁珠会结块？<br />
结块可能是因为细胞与磁珠的比例过高或含洋地黄皂苷的缓冲液中的细胞核/细胞发生裂解，从而释放 DNA 并导致结块。这种情况下，首先要检查细胞数量是否超过推荐数量。此外，在与抗体一起孵育前，建议先用福尔马林轻微固定样本（室温下使用 0.1% 福尔马林固定 2 分钟），以减少磁珠在含洋地黄皂苷的洗涤缓冲液中的结块。但需记住的是，固定可能会影响表位的可用性，因此需要对每种抗体进行测试。</p>
</li>
<li>
<p>为什么用于一抗孵育的缓冲液中含 EDTA？<br />
建议在通透和抗体孵育缓冲液中添加 EDTA，因为它会螯合 Mg2+ 离子，从而终止所有依赖 ATP 的细胞过程（包括复制和染色质重塑），同时终止内源性 DNase。</p>
</li>
<li>
<p>哪里可以得到蛋白 A/G-MNase 或蛋白 A-Tn5？<br />
这两种融合蛋白最初都由 Henikoff 实验室提供。现在已经有了制备融合蛋白的实验方案（Kaya-Okur et al ., 2019; Meers et al ., 2019a），而且质粒、蛋白 A-MNase、蛋白 A/G-MNase 和蛋白 A-Tn5 都可以从试剂供应商处购买。</p>
</li>
<li>
<p>在 CUT&amp;Tag 中，是否会得到非抗体引导的标签化，从而产生类似 ATAC 的峰？<br />
按照标准实验方案的建议增加标签化缓冲液中的盐浓度即可解决这一问题。在某些情况下，依据目标蛋白的情况，可能会人为发现一些峰看起来像 Kaya-Okur et al 2019 的报道中所示的 ATAC 峰。</p>
</li>
</ul>
<p>参考文献<br />
Brahma, S ., Henikoff, S. RSC-associated subnucleosomes define MNase-sensitive promoters in yeast . Mol Cell 73, 238–249, e233 (2019).</p>
<p>Buenrostro, J .D ., Giresi, P .G ., Zaba, L .C ., Chang, H .Y ., Greenleaf, W .J . Transposition of native chromatin for fast and sensitive epigenomic profiling of open chromatin, DNA-binding proteins and nucleosome position. Nat Methods 10, 1213–1218 (2013).</p>
<p>Hainer, S .J ., Fazzio, T .G. High-resolution chromatin profiling using CUT&amp;RUN. Curr Protoc Mol Biol 126, e85 (2019).</p>
<p>Janssens, D .H ., et al. Automated in situ chromatin profiling efficiently resolves cell types and gene regulatory programs. Epigenet Chromatin 11, 74 (2018).</p>
<p>Kaya-Okur, H .S ., et al. CUT&amp;Tag for efficient epigenomic profiling of small samples and single cells. Nat Commun 10, 1930 (2019).</p>
<p>Meers, M .P ., Bryson, T .D ., Henikoff, J .G ., Henikoff, S. Improved CUT&amp;RUN chromatin profiling tools. eLife 8: e46314 (2019).</p>
<p>Meers, M .P ., Tenenbaum, D ., Henikoff, S . Peak calling by Sparse Enrichment Analysis for CUT&amp;RUN chromatin profiling . Epigenet Chromatin 12, 42 (2019).</p>
<p>Schmid, M ., Durussel, T ., Laemmli, U .K. ChIC and ChEC; genomic mapping of chromatin proteins. Mol Cell 16, 147–157 (2004).</p>
<p>Skene, P .J ., Henikoff, J .G ., Henikoff, S. Targeted in situ genome-wide profiling with high efficiency for low cell numbers. Nat Protoc 13, 1006–1019 (2018).</p>
<p>Skene, P .J ., Henikoff, S. An efficient targeted nuclease strategy for high-resolution mapping of DNA binding sites. eLife 6: e21856 (2017).</p>
<p>Thakur, J ., Henikoff, S. Unexpected conformational variations of the human centromeric chromatin complex. Genes Dev 32, 20–25 (2018).</p>
<p>Zentner, G .E ., Kasinathan, S ., Xin, B ., Rohs, R ., Henikoff, S. ChEC-seq kinetics discriminates transcription factor binding sites by DNA sequence and shape in vivo. Nat Commun 6, 8733 (2015).</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://example.com/2021/10/11/Bioinfo-Local-BLAST-search-of-NCBI-NR-database/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/fl-photo-202109.jpg">
      <meta itemprop="name" content="FENG Lei">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="FENG's Notes">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/10/11/Bioinfo-Local-BLAST-search-of-NCBI-NR-database/" class="post-title-link" itemprop="url">Bioinfo | Local BLAST search of NCBI NR database</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2021-10-11 11:36:30" itemprop="dateCreated datePublished" datetime="2021-10-11T11:36:30+08:00">2021-10-11</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2021-10-22 10:23:21" itemprop="dateModified" datetime="2021-10-22T10:23:21+08:00">2021-10-22</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Bioinformatics/" itemprop="url" rel="index"><span itemprop="name">Bioinformatics</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>DIAMOND 是一种快速批量序列比对程序，可将 DNA 文件与蛋白质参考序列文件（如 NCBI-nr）进行比较。它以 C++ 实现，旨在在多核服务器上快速运行。该程序明确地设计为，利用具有大内存容量和许多内核的现代计算机体系结构。那么为什么它那么快呢，因为它使用了种子延伸方法。额外的算法成分是使用缩小的字母，间隔种子和双索引。算法简单了解一下就可以了，具体的算法的内容比较难懂就不深入讨论了。其主要的特点包括(为什么该工具那么受欢迎):在比较NCBI-nr数据库的短DNA reads时，DIAMOND比BLASTX 快4个数量级，并且在e-value &lt; 0.001 的比对上保持相当的灵敏度水平。简单一句话就是又快又准。可用于移位分析的长reads比对资源要求低，适合在标准台式机或笔记本电脑上运行(入门门槛低，适合各类的玩家)各种输出格式，包括BLAST对比格式，例如格式6的tabular分隔形式和格式5的XML格式 (很多下游分析，或者脚本都是基于BLAST的输出结果，diamond能够直接输出和Blast相同的格式不能不说是最大的优点之一)（摘自：<a target="_blank" rel="noopener" href="https://www.jianshu.com/p/d2407ec4648a">lakeseafly</a></p>
<h3 id="nr-数据库下载"><a class="markdownIt-Anchor" href="#nr-数据库下载"></a> NR 数据库下载</h3>
<p>浏览器打开 <a target="_blank" rel="noopener" href="https://ftp.ncbi.nlm.nih.gov/blast/db/">https://ftp.ncbi.nlm.nih.gov/blast/db/</a>。进入 fasta 目录，可以见到：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">Index of /blast/db/FASTA</span><br><span class="line">Name                    Last modified      Size  </span><br><span class="line">Parent Directory                             -   </span><br><span class="line">nr.gz                   2021-10-09 19:36  111G  </span><br><span class="line">nr.gz.md5               2021-10-09 20:21   40   </span><br><span class="line">nt.gz                   2021-10-04 07:27  133G  </span><br><span class="line">nt.gz.md5               2021-10-04 08:40   40   </span><br><span class="line">pdbaa.gz                2021-10-09 11:37   32M  </span><br><span class="line">pdbaa.gz.md5            2021-10-09 11:37   43   </span><br><span class="line">swissprot.gz            2021-10-09 11:36  134M  </span><br><span class="line">swissprot.gz.md5        2021-10-09 11:36   47   </span><br></pre></td></tr></table></figure>
<p>通过 FileZilla 软件下载 nr.gz 文件，文件较大，需时较长。（备注：这个方式不推荐，我下载了两次，文件大小都不一样，均无法通过md5完整性检测，文件解压自然也是失败的。）</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">$ wget ftp://ftp.ncbi.nlm.nih.gov/blast/db/FASTA/nr.gz</span><br><span class="line">--2021-10-11 10:21:12--  ftp://ftp.ncbi.nlm.nih.gov/blast/db/FASTA/nr.gz</span><br><span class="line">           =&gt; ‘nr.gz’</span><br><span class="line">Resolving ftp.ncbi.nlm.nih.gov (ftp.ncbi.nlm.nih.gov)... 165.112.9.230, 165.112.9.228, 2607:f220:41f:250::230, ...</span><br><span class="line">Connecting to ftp.ncbi.nlm.nih.gov (ftp.ncbi.nlm.nih.gov)|165.112.9.230|:21... connected.</span><br><span class="line">Logging in as anonymous ... Logged in!</span><br><span class="line">==&gt; SYST ... done.    ==&gt; PWD ... done.</span><br><span class="line">==&gt; TYPE I ... done.  ==&gt; CWD (1) /blast/db/FASTA ... done.</span><br><span class="line">==&gt; SIZE nr.gz ... 119246586487</span><br><span class="line">==&gt; PASV ... done.    ==&gt; RETR nr.gz ... done.</span><br><span class="line">Length: 119246586487 (111G) (unauthoritative)</span><br><span class="line"></span><br><span class="line"> 3% [=====&gt;  （我的下载速度约 1 M/s，花了一个晚上下载数据集，但是数据集通不过完整性检测。）</span><br><span class="line"></span><br><span class="line">$ wget ftp://ftp.ncbi.nlm.nih.gov/blast/db/FASTA/nr.gz.md5</span><br></pre></td></tr></table></figure>
<p>测试用 blast 自带的下载程序 update_blastdb.pl，最终也因网络中断而失败。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ perl /home/fenglei/local/app/blast-2.11.0/bin/update_blastdb.pl nr</span><br><span class="line">Connected to NCBI</span><br><span class="line">Downloading nr (56 volumes) ...</span><br><span class="line">Downloading nr.00.tar.gz...</span><br></pre></td></tr></table></figure>
<p>最后还是用 wget 工具成功下载 nr 数据集。wget 可以设置 <code>-c</code> 参数，即断点续传功能；<code>-t</code> 参数表示中断之后无限次重连。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget -c -t 0 ftp://ftp.ncbi.nlm.nih.gov/blast/db/FASTA/nr.gz</span><br></pre></td></tr></table></figure>
<p>下载完毕，用 <code>md5sum</code> 程序检测数据集完整度，通过的话就可以构建数据库索引，制作 index。<code>nr.fa.gz</code> 文件大小 120 Gb，解压成文本文件 <code>nr.fa</code> 约220 Gb，制作成索引文件 <code>nr.fa.dmnd</code> 约 220 Gb。是否可以直接以压缩格式的序列文件来制作 index 索引文件？测试发现是可以的。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">md5sum -c nr.gz.md5</span><br><span class="line">#### 如果上面的文件是完整的，将看到如下信息</span><br><span class="line">#### nr.gz: OK</span><br><span class="line">diamond makedb --in nr.fa -d nr.fa</span><br><span class="line"># diamond makedb --in Araport11_genes.201606.pep.fasta.gz -d Araport11_genes.pep</span><br><span class="line"># makeblastdb -dbtype prot -input_type fasta -in nr.fa -out nr.fa</span><br><span class="line"># makeblastdb -dbtype nucl -input_type fasta -in nt.fa -out nt.fa</span><br></pre></td></tr></table></figure>
<p>注意，nr 数据库内容截取如下，有的序列名字有多个 ID，以“^A”分割。看来这几个名字就是不同的版本。我用相应的氨基酸序列去 NCBI 官网做 BLASTp，得到的结果就是排在前面的那一个 ID。将 nr 数据库在本地做 blast 比对，实际输出的也是第第一个 ID，“^A”之后的其他基因ID不会出现。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&gt;WP_036746896.1 UxaA family hydrolase [Paenibacillus sp. UNC451MF]</span><br><span class="line">MSQSSVHSRTIWGYRRTDGRVGVRNHVLILPTIVCATQTAQRVTELVQGTVTFIHQHGCAQVGVDYEQTFRTYVGMAANP</span><br><span class="line">NVYGVIVLGLGCETHQARSVASEVRKTGKPVEVISIQDHGGTLFTVAEAARAAAKMVQEASRERRVECDFAELIVGTECG</span><br><span class="line">GSDACSGLSANPAVGVCSDKIVDHGGTSILAETTELIGAEHLLARRAVNDHVAKRVYQVIEAMEKRAFSMNVDIRTGNPS</span><br><span class="line">PGNIKGGLSSLEEKSLGASNKSGTRPLQELIDYAERPSQRGLVWMDTPGHDIEQLTGMVAGGSQIVLFTTGRGTPTGSPI</span><br><span class="line">APVIKIATNTSIFEKMNDNIDLNAGTIIEGTETIESVGDRIFEEIIEVCSGKLTKSEILKQHDFGIWRIGPTF</span><br><span class="line">&gt;WP_198710437.1 energy transducer TonB [Pseudomonas syringae]^AMBI6798472.1 TonB family protein [Pseudomonas syringae]</span><br><span class="line">MIAAALAPPVGAAEPFLVPIYTPTPVFPPELVKTRYAGKVRAQLWIKSDGQVREVRAIESGHPQLAAAVEQALRQWRYKP</span><br><span class="line">WIGTVGAPPMTTITVPVIFGSHGYRRFNTEVTVGLGNIRCGYLNHEVKSARQDYPKEPLSKVDVFWYTGQALFGSHVAHL</span><br><span class="line">RSEPQRQVLLEQLGAAIPMMVSNCRRNPDRLYGDYLPTPIKALMVGLAEQAEGSE</span><br><span class="line">&gt;WP_160354286.1 DUF1491 family protein [Sphingorhabdus profundilacus]^AMVZ98371.1 DUF1491 family protein [Sphingorhabdus profundilacus]</span><br><span class="line">MTEPRLTSQFRISALQRLTEADGGFATLLHKGDPTSGVILLVGHIRGGNPVLFERYPALDGSLTWHRITQSLVGDETEIT</span><br><span class="line">KYWKTRTQRDPDLWVLELDVASIERLDGLLATDA</span><br><span class="line">&gt;CAD7654860.1 unnamed protein product, partial [Oppiella nova]^ACAG2172047.1 unnamed protein product, partial [Oppiella nova]</span><br><span class="line">MNIEDIVALHNLVSIKIYSLQKENSNLVQQVIKFKTFYDKNKTDENETKDTESESMDTLADDKGFDKDNLLKEVERIKKK</span><br><span class="line">YSIKSKKLEQKMVSMSQRNRAHSPLLWTQIKTSKNKTDENETKDTESESMDTLADDKGFDKDNLLKEVERIKKKYSIKSK</span><br><span class="line">KLEQKMVSMSQRNRAHVRHNH</span><br></pre></td></tr></table></figure>
<h3 id="diamond-blast"><a class="markdownIt-Anchor" href="#diamond-blast"></a> Diamond BLAST</h3>
<p>普通的 BLAST 将会非常慢，所以要用到 Diamond 的 blast 功能。通过 <code>outfmt 6</code> 来控制需要输出的信息项目。参数 <code>-k</code> （–max-target-seqs）表示，针对每一个序列，仅仅输出最佳匹配的一个结果，默认是输出 25 个匹配结果。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">diamond blastp --threads 8 -d /index/nr.fa -q unkonwn_proteins_seq.fa -k 1 -e 0.0001 -o unkonwn_proteins_seq_blastp_nr_1</span><br><span class="line"># diamond blastx --threads 8 -d /index/nr.fa --outfmt 6 qseqid sallseqid pident length mismatch gapopen qstart qend sstart send evalue bitscore -q unkonwn_DNA_seq.fas -k 1 -e 0.0001 -o unkonwn_proteins_seq_blastx_nr_2</span><br><span class="line"></span><br><span class="line">##### 下面是显示tab格式的比对信息，通过-outfmt 6 参数设置将比对目标的基因名全部信息进行输出</span><br><span class="line">diamond blastp --threads 8 -d /index/nr.fa --outfmt 6 qseqid sallseqid stitle pident length mismatch gapopen qstart qend sstart send evalue bitscore -q unkonwn_proteins_seq.fas -k 1 -e 0.001 -o unkonwn_proteins_seq_blastx_nr_3</span><br><span class="line"></span><br><span class="line">##### 下面是生成 paorwise 比对信息，可以直观看到比对的区间信息</span><br><span class="line">diamond blastx --threads 16 -d ~/databases/nr/nr.fa --outfmt 0 -q Transcripts.fa -k 1 -e 0.001 -o Transcripts.fa_blastx_nr_outfmt0.tab</span><br></pre></td></tr></table></figure>
<h3 id="结果解读"><a class="markdownIt-Anchor" href="#结果解读"></a> 结果解读</h3>
<p>如下就是 tab 格式的输出。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Query_ID	gene_ID_in_NR	gene_info_in_NR	identity%	length	mismatch	gapopen	qstart	qend	sstart	send	evalue	bitscore</span><br><span class="line">TRINITY_DN69561_c0_g1_i1	SHE22971.1	SHE22971.1 Exodeoxyribonuclease III [Bathymodiolus brooksi thiotrophic gill symbiont]	41.5	82	47	1	250	5	155	235	3.95E-10	65.1</span><br><span class="line">TRINITY_DN69561_c3_g1_i1	XP_033731479.1	XP_033731479.1 uncharacterized protein LOC117321118 [Pecten maximus]	42.4	66	38	0	198	1	610	675	2.09E-06	54.3</span><br><span class="line">TRINITY_DN69557_c0_g1_i5	XP_025020276.1	XP_025020276.1 tigger transposable element-derived protein 1-like [Python bivittatus]	51.7	201	71	4	3	533	71	269	4.86E-54	183</span><br><span class="line">TRINITY_DN69557_c0_g1_i9	XP_008336686.1	XP_008336686.1 tigger transposable element-derived protein 1-like [Cynoglossus semilaevis]	60.5	114	45	0	1	342	17	130	1.86E-34	136</span><br><span class="line">TRINITY_DN69557_c0_g1_i10	XP_005003688.1	XP_005003688.1 tigger transposable element-derived protein 1-like isoform X2 [Cavia porcellus]	83.3	36	6	0	147	254	76	111	6.29E-11	67.8</span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://example.com/2021/10/01/Bioinfo-Positive-Selection-Ka-Ks-calculation/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/fl-photo-202109.jpg">
      <meta itemprop="name" content="FENG Lei">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="FENG's Notes">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/10/01/Bioinfo-Positive-Selection-Ka-Ks-calculation/" class="post-title-link" itemprop="url">Bioinfo | Positive Selection Ka/Ks calculation</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2021-10-01 15:32:13" itemprop="dateCreated datePublished" datetime="2021-10-01T15:32:13+08:00">2021-10-01</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2021-10-27 14:00:20" itemprop="dateModified" datetime="2021-10-27T14:00:20+08:00">2021-10-27</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Bioinformatics/" itemprop="url" rel="index"><span itemprop="name">Bioinformatics</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>总结正向选择分析的一些知识。2017 年做过一次线粒体基因的正向选择，相关内容已经<a target="_blank" rel="noopener" href="https://link.springer.com/article/10.1007%2Fs00606-019-01578-2#Sec18">发表</a>，并且我在Supplementary Files 里附上了我的<a target="_blank" rel="noopener" href="https://static-content.springer.com/esm/art%3A10.1007%2Fs00606-019-01578-2/MediaObjects/606_2019_1578_MOESM1_ESM.pdf">分析代码</a>。2021年再次需要做正向选择分析，再次回顾以前的工作，发现其中也有一个问题，就是没有做统计检验，推算P值，再次学习正向选择分析，并摘抄一些网络资料并整理记录。Codeml 的学习成本比较高，原理与操作都不易理解，学习的过程中发现不少好资源，比如 B 站有<a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1Qx411m7Bn?from=search&amp;seid=9774626637377853773&amp;spm_id_from=333.337.0.0">视频</a>讲解如何使用 codeml 推断特定分支的 ω 值（dN/dS），以及使用卡方检验来计算 P 值。另外有国内的团队以 codeml 为内核，用 java 编写了更友好的操作界面：<a target="_blank" rel="noopener" href="http://blog.sciencenet.cn/home.php?mod=space&amp;uid=460481&amp;do=blog&amp;id=1163040">EasyCodeML</a>。</p>
<p><img src="https://d3i71xaburhd42.cloudfront.net/aac1c83c6feff2575f6296ea4751f29c0fec42a1/12-Figure8-1.png" alt="我计算 8 个物种的线粒体基因的 Ka/Ks，但是没有计算 P 值" /></p>
<h3 id="基因正选择分析原理"><a class="markdownIt-Anchor" href="#基因正选择分析原理"></a> <a target="_blank" rel="noopener" href="http://www.chenlianfu.com/?p=3084">基因正选择分析原理</a></h3>
<p>下文由 <a target="_blank" rel="noopener" href="http://www.chenlianfu.com/?p=3084">chenlianfu.com</a> 发表于2019 年 11 月 18 日</p>
<p><strong>一、 正选择分析的目的</strong></p>
<p>两两基因的密码子序列进行比较，从而计算 dN/dS，即 omega（ω）值。若该值 &lt; 1，则表示纯化选择；omega = 1，则中性进化；omega &gt; 1，则正选择。若分析基因在两个物种中的序列，可以计算 dN/dS 的值，若 omega &gt; 1，即表明该基因在物种进化过程中，即由其祖先物种分化成这两个物种时，基因受到了正选择。对于两个物种/序列的正选择分析，比较简单。而实际情况中，要分析的物种数量很多，包含多个类群。这个时候的正选择分析相对复杂些。</p>
<p>对多个物种的基因序列进行正选择分析，若仍然按照两个物种时的要求，即分析该基因在物种进化中是否受到了正选择？这种结果可能不好说清楚。因为该基因可能在某一类群中序列很相似，其两两比较时，omega &lt;= 1；而在另外一类群中两两比较时，很多时候 omega &gt; 1。最后软件可以从总体上给一个 omega 值，该值不可以拿来简单地评价该基因是否受到了正选择。所以，对多个物种进行正选择分析时，没法直接评价该基因是否受到了正选择。正选择只有在进行两两序列比较的时候，才能计算 omega 值，从而得到结果。</p>
<p>对基因在多个物种上的正选择分析，分析的目的则是：比较某个分枝上祖先节点和后裔节点（可以理解成，对无根树上某分枝两侧的两组物种进行比较，依然属于两两比较），从而计算该分枝的 omega 值。而在实际数据中，基因在不同的进化分枝上具有不同的 omega 值，同时在序列不同的位点也具有不同的 omega 值。目标分枝两侧的物种数量较多时，可以对序列上的每个位点进行 omega 值分析，从而鉴定正选择位点。所以，对基因在多个物种上的正选择分析，需要同时分析目标分枝的 omega 值和序列位点的 omega 值，从而判断基因是否受到正选择压。</p>
<p><strong>二、使用 PAML 对基因进行正选择分析，有三种方法</strong></p>
<p>PAML site model: 主要用于检测基因中的正选择位点。该方法分析时，认为进化树中各分枝的 omega 值是一致的，并比较两种模型：(1) 模型 m1 是 null model，认为所有位点的 omega 值&lt;1 或 =1; (2) 模型 m2 是正选择模型，存在 omega &lt;1、=1 或 &gt;1 的位点。比较两个模型的似然值（lnL）差异，利用卡方检验（自由度为2）算出 p 值。若 p 值 &lt; 0.05，则否定 null model，认为存在正选择位点。此外，推荐采用比较模型 m7 和 m8，它们将 omega 值分成了 10 类，其 p 值结果比上一种比较方法更宽松，能检测到更多的正选择基因。使用 PAML site model 方法能在整体水平上检测基因的正选择位点，而不能表明基因在某个进化分枝上是否受到正选择压。</p>
<p><font color=blue>PAML branch-site model: 主要用于检测基因在某个进化枝上是否存在正选择位点。该分析方法认为目标分化枝具有一个 omega 值，其它所有分枝具有一个相同的 omega 值，然后再检测正选择位点。同样对两种模型进行比较：（1）第一种模型为模型2，将 omega 值分成 &lt;1、=1、&gt;1 的三类，这和 site model 中的一样；（2）第二种模型和前者一致，只是将 omega 固定成 1，作为 null model。比较两种模型的似然差异，利用卡方检验（自由度为2）算 p 值（chi2 命令算出的值除以2）。若 p 值 &lt; 0.05，则能通过 Bayes Empirical Bayes (BEB) 方法计算正选择位点的后验概率</font>，若存在概率值 &gt; 0.95 正选择位点，则表示基因在目标分枝上受到正选择压。<u><font color=red>PAML 软件在 branch-site 模式下，并不给出分枝上的 omega 值。</font></u>这表示 branch-site 模式虽然考虑了目标分枝上具有不同的 omega 值，但仍然以分析位点上的 omega 为主。值得注意的是，在 branch-site 模式下可能检测到正选择位点，但在目标分枝上的 omega 值仍然可能低于 1。可能软件作者基于这点考虑，就没有给出目标分枝上的 omega 值，以免影响一些人对正选择结果的判断。</p>
<p>PAML branch model: 主要用于检测在某个分枝上，其 omega 值是否显著高于背景分枝，即基因在目标分枝上进化速度加快。该方法认为基因序列上所有位点的 omega 值是一致的，对两种模型进行比较：（1）第一种模型为 null model，所有分枝具有相同的 omega 值；（2）第二种模型认为目标分枝具有一个 omega 值，其它所有分枝具有一个相同的 omega 值。比较两种模型的似然差异，利用卡方检验（自由度为1）算 p 值。若 p 值 &lt;= 0.05，且目标分枝上的 omega 值高于背景值，则认为该基因为快速进化基因。一般情况下，该方法计算得到的 p 值会低于第二种方法的结果。</p>
<p><strong>三、其它注意事项</strong></p>
<p>Branch-site model 相比于 site model 的优点是考虑了不同的分枝具有不同的选择压，即具有不同的 omega 值。该方法让目标分枝具有一个不同的 omega 值，并没有让所有分枝的 omega 值独立进行计算（理论上这样是最好的）。这样算法很复杂，程序运行非常非常消耗时间。但其实也没必要这样做，因为正选择分析其实是两条序列比较后，分析 dN/dS，再找正选择位点，其分析结果就应该是某个分枝上基因是否受到正选择，在序列那个位点上受到正选择。</p>
<p>若在目标分枝上，其 omega 值小于 1，但是却能找到正选择位点。即该基因在该分枝上的 dN/dS &lt; 1，但是在某些位点上，dN/dS &gt; 1。那么该基因是否属于正选择基因？我认为：属于。之所以为正选择基因，主要是因为基因的个别位点或多个位点存在正选择。当只有个别位点受到正选择压力时，而其它多个位点存在纯化选择时，可能导致整体上的omega值小于1。此时，该基因也应该是属于正选择基因。</p>
<p><strong>四、参考文献中的正选择分析方法描述</strong></p>
<p>Science 文章<a target="_blank" rel="noopener" href="https://science.sciencemag.org/content/364/6446/eaav6202"><em>《大规模反刍动物基因组测序与其独特性质的进化研究》</em></a> 中的正选择基因分析方法。</p>
<p>注：这篇文章做了几十个物种的从头测序与拼接，基本上由 Illumina 测序，说明该项目应该做了挺多年，基因组拼接的质量放在今天来说不算好，大部分物种的 contig N50 不到 50 Kb，后期的比较基因组学分析做的好。主要目的是研究反刍动物特性，例如用于反刍的瘤胃、可再生的骨质角、不同物种巨大的身高差异等。主要手段是研究基因的选择压力。分析思路值得学习，其<a target="_blank" rel="noopener" href="https://www.science.org/doi/suppl/10.1126/science.aav6202/suppl_file/aav6202-chen-sm.pdf"><em>附件</em></a>包含大量中间数据，可作为学习参考。</p>
<p><strong>Identification of positively selected genes (PSGs).</strong> We used a conserved genome synteny methodology to establish a highconfidence orthologous gene set that included camel, cat, dog, horse, human, minke whale, killer whale, pig, and the 51 ruminant species. Briefly, pairwise WGAs were constructed for relevant genomes using LAST, with the goat genome serving as the reference genome. To minimize the effect of annotation, sequencing and assembly errors, pseudogenes, nonorthologous alignments, and non-conserved gene structures 22 on subsequent evolutionary rate analyses, a series of rigorous filtering criteria were adopted: (1) the genes mapped to the goat genome via a single chain of sequence alignments including at least 80% of its coding sequence (CDS), and met the alignment length/score thresholds required for inclusion in the MULTIZ alignments; (2) frame-shift indels in CDSs were prohibited; (3) CDSs with premature stop codons were excluded and (4) genes with Ks values (synonymous substitutions per synonymous site) between each species and cattle larger than two were excluded. As the number of available species for each gene increased, the Codeml running time dramatically increases because of the power function relation between the number of tree leaves and branches. As a trade-off, we subsampled the ruminant species by using the following criteria: (1) if an ortholog existed in more than four species in the Cervidae or Bovidae lineage, we randomly selected 4 sequences to represent either family in order to reduce computational demand; (2) genes contained in less than 4 outgroup species were excluded; (3) genes recovered in fewer than 3 ruminant families were excluded and (4) final alignments shorter than 150 bp were discarded. After these filtering steps, a total of 12,977 genes were retained, and on average ~6.6 families containing ~19.8 species were retained for each ortholog <font color=blue>(fig. S51)</font>. The tree topology shown in Fig. 1A was used as the prior tree topology, and the “<em>ape</em>” package (164) was used to estimate the unrooted tree topology for each ortholog.</p>
<p>To estimate the lineage-specific evolutionary rate for each branch, the Codeml program in the PAML package (version 4.8) (134) with the free-ratio model (model = 1) was run for each ortholog. <font color=blue>Positive selection signals on genes along specific lineages were detected using the optimized branch-site model following the author’s recommendation. A likelihood ratio test (LRT) was conducted to compare a model that allowed sites to be under positive selection on the foreground branch with the null model in which sites could evolve either neutrally and under purifying selection. The p values were computed based on Chi-square statistics, and genes with p value less than 0.05 were treated as candidates that underwent positive selection.</font> We identified PSGs at the ancestral branch of Ruminantia (table S22), the ancestral branch of Pecora (table S23), each ancestral family branch of Ruminantia (tableS24), and each ancestral subfamily branch of Bovidae (table S24). We also compared the dN/dS values of Ruminantia families with outgroup mammals <font color=blue>(fig. S52)</font>.</p>
<p><img src="https://i.imgur.com/a9XwYdx.png" alt="" /></p>
<p><img src="https://i.imgur.com/he2bRKC.png" alt="" /></p>
<p>Science 文章<a target="_blank" rel="noopener" href="https://science.sciencemag.org/content/364/6446/eaav6202">《大规模反刍动物基因组测序与其独特性质的进化研究》</a> 中快速进化基因分析方法：The branch model in PAML was used, with the null model (model=0) assuming that all branches have been evolving at the same rate and the alternative model (model=2), allowing the foreground branch to evolve under a different rate. An LRT with df =1 was used to discriminate between alternative models for each ortholog in the gene set. Genes with a p value less than 0.05 and a higher ω value for the foreground than the background branches were considered as evolving with a significantly faster rate in the foreground branch.</p>
<p><a target="_blank" rel="noopener" href="https://journals.plos.org/plosntds/article?id=10.1371%2Fjournal.pntd.0007463">Identification of positively selected genes in human pathogenic treponemes: Syphilis-, yaws-, and bejel-causing strains differ in sets of genes showing adaptive evolution</a> 文献中对正选择基因的分析方法：</p>
<p><img src="https://i.imgur.com/35rVAXK.png" alt="" /></p>
<p>A calculation of mutational rate ratio ω between two gene sequences was the basis for the positive selection analysis. The ω was calculated as a ratio of nonsynonymous to synonymous mutational rates. The ratio indicates negative purifying selection (0 &lt; ω &lt; 1), neutral evolution (ω = 1), and positive selection (ω &gt; 1) [54]. A set of selected genes from complete genomes was tested relative to positive selection using the maximum likelihood method using the CODEML of the PAML software package [55]. PAML version 4 [56] and its user interface PAMLX [57] were used in our study. For each analyzed gene, its maximum likelihood phylogenetic tree was used as an input tree. The CODEML offers several different codon evolutionary models, and the statistical likelihood ratio test (LRT) was used to compare the codon evolutionary model to the null model. The Bayes empirical Bayes method (BEB) [58] was then used to evaluate the posterior probability of sites considered to have been positively selected.</p>
<p>The CODEML models could produce different results (i.e., a list of sites under positive selection) since they calculate different parameter estimates. Site models allow ω to vary in each site (codon) within the gene. Statistical testing was required for sites with ω &gt; 1. Two pairs of models were predominantly used since their LRTs have low false-positive rates. M1a (nearly neutral evolution) was compared to M2a (positive selection) [58,59] and M7 (beta) was compared to M8 (beta &amp; ω) [60]. Our preliminary testing found that the two model pairs gave the same or very similar results. Therefore we chose to use the M7-M8 model pair. The M7 model is a null model that allows 10 classes of sites with a ω beta-distribution within the interval 0 ≤ ω ≤ 1. Sites with ω &gt; 1 are not allowed. The alternative M8 model adds an eleventh class of sites with ω &gt; 1. Each site was tested to determine the class to which it belongs. The LRT compares twice the log-likelihood difference 2Δl = 2(l1-l0) between the M7 model (log likelihood value l0) and the M8 model (log likelihood value l1) to the χ2 distribution [61]. If the twice log-likelihood difference is above a critical χ2 value, then the null model is rejected, and the positive selection is statistically significant.</p>
<p>A considerable disadvantage of the site models is that ω was calculated as an average over all codons of the site. Therefore, the site models are not suitable for the data where ω also varies between lineages. In contrast, the branch-site models search for positive selection in sites and pre-specifies lineages where different rates of ω may occur [62]. Sequences of lineages are a priori divided into a group of foreground lineages where positive selection may occur and group of background lineages where only purifying selection or neutral evolution occurs. We used branch-site model A, which allows four classes of sites and different setups of foreground lineages to be tested depending on the gene phylogeny. In branch-site model A, all lineages under purifying selection with a low value of ω0 belong to site class 0. Weak purifying selection and neutral evolution with ω1 near to value 1 are allowed in site class 1. In site class 2a, a proportion of class 0 sites in foreground lineages is under positive selection with ω2 &gt; 1. Similarly, site class 2b is a proportion of class 1 sites under positive selection with ω2 &gt; 1. The null model for LRT has ω2 = 1. Critical values of LRT (2Δl) are 2.71 at 5% and 5.41 at 1% [63]. The posterior probabilities of suggested sites under positive selection were calculated using the BEB method.</p>
<h3 id="基因-positive-selecetion-分析过程"><a class="markdownIt-Anchor" href="#基因-positive-selecetion-分析过程"></a> 基因 positive selecetion 分析过程</h3>
<p>PAML 软件中的 <code>codeml</code> 命令可以使用 Maxmum Likelihood 方法对密码子或氨基酸的多序列比对结果进行分析和进化参数计算 。这两种数据共用一个命令，程序运行时的参数绝大部分是公用的，但仍需要分清两种数据各自的参数意义。PAML软件中进行正选择分析的示例数据位于 <code>examples/lysozyme/</code> 目录下。</p>
<ol>
<li>基因序列准备，对于选定的若干个物种，分别准备它们的基因的 CDS 序列（DNA 格式），要注意每个基因只保留一个转录本即可；另外对序列名进行手动调整，使序列名具有独特性，易识别性，主要是为了便于后续的程序自动循环处理。并将基因 CDS 分别翻译成蛋白序列，注意这一步可能会出现的问题，比如不少物种的基因组文章即使发表在高分杂志上，它的基因集并不一定是完美的，以花生为例，我发现有数个基因CDS直接翻译之后会在序列中间出现终止密码子，这种现象可能是基因组突变，也有可能是基因注释过程中引入的小错误，还有一个我发现有些基因的CDS序列起始并不是ATG这种起始密码子（不排除是 RNA editing 现象），那用普通翻译程序可能就会出现翻译错误。所以针对各个物种，最好分别检查，灵活处理，比如移除这些包含错误的基因，或者直接使用物种自带的蛋白序列集。</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">#########################################################################</span><br><span class="line"># File Name: loop.sh</span><br><span class="line"># Author: fenglei</span><br><span class="line"># Mail: fengleiluck@gmail.com</span><br><span class="line"># Created Time: Fri 08 Oct 2021 04:14:35 PM CST</span><br><span class="line">#########################################################################</span><br><span class="line">#!/usr/bin/bash</span><br><span class="line">set -e</span><br><span class="line">set -u</span><br><span class="line">set -o pipefail</span><br><span class="line"></span><br><span class="line">for i in Ammopiptanthus_nanus.cds.fa Lotus_japonicus.cds.fa Glycine_max.cds.fa Medicago_truncatula.cds.fa Vigna_angularis.cds.fa Arachis_ipaensis.cds.fa Lupinus_angustifolius.cds.fa; do</span><br><span class="line">        #prefix=$&#123;i#*.cds&#125;;</span><br><span class="line">        prefix=$&#123;i%%.cds*&#125;;</span><br><span class="line">        echo [`date +&quot;%Y-%m-%d %H:%M:%S&quot;`] &quot;#&gt; Processing $prefix&quot;</span><br><span class="line">        iTools Fatools CDS2Pep -InCDS $&#123;prefix&#125;.cds.fa -OutPut  $&#123;prefix&#125;.pep_iTools.fa # 可能翻译的序列种存在终止密码子</span><br><span class="line">        gunzip *gz</span><br><span class="line">        perl pep_seq_clean.pl $&#123;prefix&#125;.pep_iTools.fa $&#123;prefix&#125;.pep.fa</span><br><span class="line">done</span><br></pre></td></tr></table></figure>
<p>上面的循环脚本中调用了一个序列清理程序，如下，可以去掉中间含有星号的氨基酸序列，也可以移除蛋白序列尾部的终止密码子形成的星号。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line">$ cat pep_seq_clean.pl</span><br><span class="line">#!/usr/bin/perl</span><br><span class="line"></span><br><span class="line">#/*************************************************************************</span><br><span class="line">#       &gt; File Name: seq_clean.pl</span><br><span class="line">#       &gt; Author: fenglei</span><br><span class="line">#       &gt; Mail: fengleiluck@gmail.com</span><br><span class="line">##      &gt; Created Time: Fri 08 Oct 2021 01:42:50 PM CST</span><br><span class="line"># ************************************************************************/</span><br><span class="line"></span><br><span class="line">#  如果氨基酸序列内部含有终止密码子，就去掉这个序列</span><br><span class="line">#  perl seq_clean.pl input.pep.fa output.pep.fa</span><br><span class="line"></span><br><span class="line">open INPUT, $ARGV[0] or die &quot;Can not open the file!\n $!&quot;;</span><br><span class="line">open OUTPUT, &quot;&gt;$ARGV[1]&quot; or die &quot;Can not open the file!\n $!&quot;;</span><br><span class="line">select OUTPUT;</span><br><span class="line"></span><br><span class="line">$/ = &quot;\&gt;&quot;;</span><br><span class="line">&lt;INPUT&gt;;</span><br><span class="line">while(&lt;INPUT&gt;)&#123;</span><br><span class="line">        chomp $_;</span><br><span class="line">        my $unit = $_;</span><br><span class="line">        my @array = split(/\n/, $unit);</span><br><span class="line">        my $seq_name = shift @array;</span><br><span class="line">        my $seq=&#x27;&#x27;;</span><br><span class="line">        foreach my $line (@array)&#123;</span><br><span class="line">                $seq = $seq . $line;</span><br><span class="line">        &#125;</span><br><span class="line">        #print  &quot;\&gt;$seq_name\n$seq\n&quot;; exit;</span><br><span class="line">        #print &quot;$_n&quot;; exit;</span><br><span class="line">        if($seq =~ /\*[A-Z]/i)&#123;    ### 如果中间出现终止密码子，将剔除这个序列，某物钟一共有大约100条这样的序列</span><br><span class="line">                #print &quot;\&gt;$seq_name\n$seq\n&quot;;</span><br><span class="line">        &#125;</span><br><span class="line">        else&#123;</span><br><span class="line">                #$seq =~ s/\*//;           ### 去掉尾部的星号</span><br><span class="line">                print &quot;\&gt;$seq_name\n&quot;;</span><br><span class="line">                #print &quot;\&gt;$seq_name\n$seq\n&quot;;</span><br><span class="line">                # 如何更美观的输出蛋白序列，每行100个氨基酸</span><br><span class="line">                my $len = length($seq)/100;</span><br><span class="line">                #print &quot;$len\n&quot;;</span><br><span class="line">                for(my $i=0; $i&lt;$len; $i++)&#123;</span><br><span class="line">                        my $sub_line = substr($seq, $i*100, 100);</span><br><span class="line">                        $seq =~ s/\*//;           ### 去掉尾部的可能的星号</span><br><span class="line">                        $sub_line =~ s/\*//;</span><br><span class="line">                        print &quot;$sub_line\n&quot;;</span><br><span class="line">                &#125;</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">close INPUT;</span><br><span class="line">close OUTPUT;</span><br></pre></td></tr></table></figure>
<p>用 orthofindr 程序寻找物种间的同源基因。我切换到的 Python37 环境，因为 orthofinder 是在这个环境下安装的，之前的博文有记录。</p>
<p>运行命令 <code>orthofinder -t 8 -f orthofinder_data_4 -S diamond</code> 即可进行同源基因寻找。生成的目录下会包含同源基因的列表和 Group 分组情况。下面截取的是程序刚运行的目录，所以只有部分数据呈现。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">$ tree orthofinder_data_4</span><br><span class="line">orthofinder_data_4</span><br><span class="line">├── XXX.fasta -&gt; ../pep_database/XXXXXXXX.pep.fa</span><br><span class="line">├── Arachis_ipaensis.pep.fa -&gt; ../pep_database/Arachis_ipaensis.pep.fa</span><br><span class="line">├── Cajanus_cajan.pep.fa -&gt; ../pep_database/Cajanus_cajan.pep.fa</span><br><span class="line">├── Lja.fasta -&gt; ../pep_database/Lotus_japonicus.pep.fa</span><br><span class="line">├── Lupinus_angustifolius.pep.fa -&gt; ../pep_database/Lupinus_angustifolius.pep.fa</span><br><span class="line">├── Mtr.fasta -&gt; ../pep_database/Medicago_truncatula.pep.fa</span><br><span class="line">├── OrthoFinder</span><br><span class="line">│   └── Results_Oct17</span><br><span class="line">│       ├── Log.txt</span><br><span class="line">│       └── WorkingDirectory</span><br><span class="line">│           ├── diamondDBSpecies0.dmnd</span><br><span class="line">│           ├── diamondDBSpecies1.dmnd</span><br><span class="line">│           ├── diamondDBSpecies2.dmnd</span><br><span class="line">│           ├── diamondDBSpecies3.dmnd</span><br><span class="line">│           ├── diamondDBSpecies4.dmnd</span><br><span class="line">│           ├── diamondDBSpecies5.dmnd</span><br><span class="line">│           ├── diamondDBSpecies6.dmnd</span><br><span class="line">│           ├── SequenceIDs.txt</span><br><span class="line">│           ├── Species0.fa</span><br><span class="line">│           ├── Species1.fa</span><br><span class="line">│           ├── Species2.fa</span><br><span class="line">│           ├── Species3.fa</span><br><span class="line">│           ├── Species4.fa</span><br><span class="line">│           ├── Species5.fa</span><br><span class="line">│           ├── Species6.fa</span><br><span class="line">│           ├── Species7.fa</span><br><span class="line">│           └── SpeciesIDs.txt</span><br><span class="line">├── Psa.fasta -&gt; ../pep_database/Pisum_sativum.pep.fa</span><br><span class="line">└── Van.fasta -&gt; ../pep_database/Vigna_angularis.pep.fa</span><br></pre></td></tr></table></figure>
<ol start="2">
<li>序列比对，即 codon alignment，依据密码子来进行比对，比直接依据 DNA 比对更准确，比对结果存储为 paml 格式。PAL2NAL 软件可以设定输出格式，默认为 clustal 格式，需要设置为paml。</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">#!/bin/bash</span><br><span class="line">set -e</span><br><span class="line">set -u</span><br><span class="line">set -o pipefail</span><br><span class="line">for i in `cat commn_genes_list`; do</span><br><span class="line">        echo [`date +&quot;%Y-%m-%d %H:%M:%S&quot;`] &quot;#&gt; sequence convertion and alignment: $&#123;i&#125;.fa&quot;;</span><br><span class="line">        cp ../01_fasta_files/$&#123;i&#125;.fa $&#123;i&#125;.nuc;</span><br><span class="line">        echo [`date +&quot;%Y-%m-%d %H:%M:%S&quot;`] &quot;#&gt; Proceccing $&#123;i&#125;.nuc ...&quot;;</span><br><span class="line">        iTools Fatools CDS2Pep -InCDS $&#123;i&#125;.nuc -OutPut $&#123;i&#125;.pep;</span><br><span class="line">        gunzip *gz;</span><br><span class="line">        clustalw2 -TYPE=PROTEIN -INFILE=$&#123;i&#125;.pep -ALIGN -OUTFILE=$&#123;i&#125;.pep.clustalw;</span><br><span class="line">        ~/local/app/PAL2NAL/pal2nal.pl $&#123;i&#125;.pep.clustalw $&#123;i&#125;.nuc -output paml -nogap &gt; $&#123;i&#125;.codon</span><br><span class="line">        echo;</span><br><span class="line">done</span><br></pre></td></tr></table></figure>
<p>一个基因 codon 比对的结果 paml 格式（the PHYLIP format）如下所示，首行两个数字，一个为物种数目，另一个为碱基数目。随后几行分布是物种名和去除 gap 的碱基序列。对于多个基因，可以直接用 cat 命令连接成一个文件，作为下一步 codeml 的输入。The first line contains the number of species and the sequence length (possibly followed by option characters). For codon sequences (codeml with seqtype = 1), the sequence length in the sequence file refers to the number of nucleotides rather than the number of codons.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">7  390</span><br><span class="line">Hsa_Human        AAGGTCTTTGAAAGGTGTGAGTTGGCCAGAACT...</span><br><span class="line">Hla_gibbon       AAGGTCTTTGAAAGGTGTGAGTTGGCCAGAACT...</span><br><span class="line">Cgu/Can_colobus  AAGATCTTTGAAAGGTGTGAGTTGGCCAGAACT...</span><br><span class="line">Pne_langur       AAGATCTTTGAAAGGTGTGAGTTGGCCAGAACT...</span><br><span class="line">Mmu_rhesus       AAGATCTTTGAAAGGTGTGAGTTGGCCAGAACT...</span><br><span class="line">Ssc_squirrelM    AAGGTCTTCGAAAGGTGTGAGTTGGCCAGAACT...</span><br><span class="line">Cja_marmoset     AAGGTCTTTGAAAGGTGTGAGTTGGCCAGAACT...</span><br></pre></td></tr></table></figure>
<ol start="3">
<li>准备一个无根树</li>
</ol>
<p>我之前用过的无根树如下。newick格式，注意一定以分号结尾，否则 codeml 运行的结果中不会出现 Omema 值和 lnL 值。据我自己的经验，分析正向选择，有6~8个物种为宜，少了可能不准确，多了可能时间会很长。如果用有根树，codeml 会报错。无根树怎判断，首先可以用 Figtree 软件打开下面这个文件“unrooted_tree.txt”文件，默认的“rectangular form layput”显示下，从左侧起有 3 个分支，其实也可以直接肉眼看下面的文本内容，从最外层的括号观察，里面包含了 3 个分支。而root tree的图从最左侧开始看，只有2个分支。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$cat unrooted_tree.txt</span><br><span class="line">(((Vicia_faba, Medicago_truncatula), Lotus_japonicus),(Millettia_pinnata, ((Vigna_angularis, Vigna_radiata), Glycine_max)), Ammopiptanthus_mongolicus #1);</span><br></pre></td></tr></table></figure>
<p><a target="_blank" rel="noopener" href="http://blog.sciencenet.cn/home.php?mod=space&amp;uid=1339458&amp;do=blog&amp;id=1023521"><strong>其他人的经验 1</strong></a>：制作tree文件。tree文件最简单的方法就是直接用Clustal制作，推荐 <a target="_blank" rel="noopener" href="http://www.genome.jp/tools/clustalw/">http://www.genome.jp/tools/clustalw/</a>。将序列提交上去，点Execute Multiple Alignment，然后将结果里的dnd文件下载，改名为自己想要的文件+后缀名“.trees”。我这里保存为n1.trees。但是上Phylogenetics课程的时候问了老师一句关于拿Clustal建树用于PAML分析，得到的回答是:  Never, never use Clustal to build a tree。所以还是老老实实用正经的建树工具来做Newick格式的tree文件吧。</p>
<p><a target="_blank" rel="noopener" href="http://www.chenlianfu.com/?p=3036"><strong>其他人的经验 2</strong></a>：输入一个树文件input.trees。该文件可以是有根树，也可以是无根树，也可以带有枝长信息。codeml命令用于分析各分枝上的omega值，若是有根树的话，对于分析root节点所在的分枝，其结果可能是不对的。因此，作者推荐使用无根树进行正选择分析。无根树是3分叉的树，最少需要3个物种；而3个物种的无根数有3个分枝（2n – 3），对其进行分析，仅能得到某个物种所对应分枝的omega值，这种情况下没太大意义；而使用4个物种的无根树进行分析，可以得到两个物种共同祖先分枝的omega值。故作者推荐使用至少4~5个物种进行分析。一个树文件内容示例。文件内容分两行：第一行表述树中有多少个物种，共计1个树，两个数值之间用任意长度的空分割。此外，Newick格式的树尾部一定要有分号，没有的话程序可能不能正常运行。</p>
<p><a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1Qx411m7Bn?from=search&amp;seid=9774626637377853773&amp;spm_id_from=333.337.0.0"><strong>其他人的经验 3</strong></a>：如果要计算某个分支，可以直接在分支后面加一个“$1”，即美元符号。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">7  1</span><br><span class="line">((Hsa_Human, Hla_gibbon) #1,((Cgu/Can_colobus, Pne_langur) #1, Mmu_rhesus), (Ssc_squirrelM, Cja_marmoset));</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">((Hsa_Human, Hla_gibbon), ((Cgu/Can_colobus, Pne_langur) $1, Mmu_rhesus), (Ssc_squirrelM, Cja_marmoset));</span><br></pre></td></tr></table></figure>
<ol start="4">
<li>准备 codeml 的配置文件</li>
</ol>
<p>下面是从 &lt;<a target="_blank" rel="noopener" href="http://chenlianfu.com">chenlianfu.com</a>&gt; 摘抄的一个配置案例：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">*输入输出参数：</span><br><span class="line">      seqfile = input.txt    *设置输入的多序列比对文件路径。</span><br><span class="line">     treefile = input.trees  *设置输入的树文件路径。</span><br><span class="line">      outfile = mlc          *设置输出文件路径。</span><br><span class="line">        noisy = 9            *设置输出到屏幕上的信息量等级：0，1，2，3，9。</span><br><span class="line">      verbose = 0            *设置输出到结果文件中的信息量等级：0，精简模式结果（推荐）；1，输出详细信息，包含碱基序列；2，输出更多信息。</span><br><span class="line">        getSE = 0            *设置是否计算并获得各参数的标准误：0，不需要；1，需要。</span><br><span class="line"> RateAncestor = 0            *设置是否计算序列中每个位点的替换率：0，不需要；1，需要。当设置成1时，会在结果文件rates中给出各个位点的碱基替换率；同时也会进行祖先序列的重构，在结果文件rst中有体现。</span><br><span class="line"></span><br><span class="line">*数据使用说明参数：</span><br><span class="line">      runmode = 0      *设置程序获取进化树拓扑结构的方法：0，直接从输入文件中获取进化树拓扑结构（推荐）；1，程序以输入文件中的多分叉树作为起始树，并使用星状分解法搜索最佳树；2，程序直接以星状树作为起始树，并使用星状分解法搜索最佳树；3，使用逐步添加法搜索最佳树；4，使用简约法获取起始树，再进行邻近分枝交换寻找最优树；5，以输入文件中的树作为起始树，再进行邻近分枝交换寻找最优树；-2，对密码子序列进行两两比较并使用ML方法计算DnDs，或对蛋白序列进行两两比较计算ML距离，而不进行其它参数（枝长和omega等）的计算。</span><br><span class="line">* fix_blength = 1      *设置程序处理输入树文件中枝长数据的方法：0，忽略输入树文件中的枝长信息；-1，使用一个随机起始进行进行计算；1，以输入的枝长信息作为初始值进行ML迭代分析，此时需要注意输入的枝长信息是碱基替换率，而不是碱基替换数；2，不需要使用ML迭代计算枝长，直接使用输入的枝长信息，需要注意，若枝长信息和序列信息不吻合可能导致程序崩溃；3，让ML计算出的枝长和输入的枝长呈正比。</span><br><span class="line">      seqtype = 1      *设置输入的多序列比对数据的类型：1，密码子数据；2，氨基酸数据；3，输入数据虽然为密码子序列，但先转换为氨基酸序列后再进行分析。</span><br><span class="line">    CodonFreq = 2      *设置密码子频率的计算算法：0，表示除三种终止密码子频率为0，其余密码值频率全部为1/61；1，程序分别计算三个密码子位点的四种碱基频率，再算四种碱基频率在三个位点上的算术平均值，计算61种密码子频率时，使用该均值进行计算，这61种密码子频率之和不等于1，然后对其数据标准化，使其和为1，得到所有密码子的频率；2，程序分别计算三个密码子位点的四种碱基频率，计算61种密码子频率时，使用相应位点的碱基频率进行计算，这61种密码子频率之和不等于1，然后对其数据标准化，使其和为1，得到所有密码子的频率；3，直接使用观测到的各密码子的总的频数/所有密码值的总数，得到所有密码子的频率。一般选择第三种方法，设置CodonFre的值为2。第一种方法让所有密码子频率相等，不符合实际轻卡；第二种方法没有考虑到三种位点各碱基频率的差异，得到的密码子频率不准确；第三种方法能比较准确计算出各密码子的频率；第四种方法由输入数据得到真实的各密码子频率，但有时候有些非终止密码子的频率为0，可能不利于后续的计算。</span><br><span class="line">    cleandata = 1      *设置是否移除不明确字符（N、？、W、R和Y等）或含以后gap的列后再进行数据分析：0，不需要，但在序列两两比较的时候，还是会去除后进行比较；1，需要。</span><br><span class="line">*       ndata = 1      *设置输入的多序列比对的数据个数。</span><br><span class="line">        clock = 0      *设置进化树中各分支上的变异速率是否一致，服从分子钟理论：0，变异速率不一致，不服从分子钟理论（当输入数据中物种相差较远时，各分支变异速率不一致）；1，所有分枝具有相同的变异速率，全局上服从分子钟理论；2，进化树局部符和分子钟理论，程序认为除了指定的分支具有不同的进化速率，其它分枝都具有相同的进化速率，这要求输入的进化树信息中使用#来指定分支；3，对多基因数据进行联合分析。</span><br><span class="line">        Mgene = 0      *设置是否有多个基因的多序列比对信息输入，以及多各基因之间的参数是否一致：0，输入的多序列比对文件中仅包含一个基因时，或多个基因具有相同的Kappa和Pi参数；1，输入文件包含多个基因，这些基因之间是相互独立的（这些基因之间具有不同的Kappa和Pi值，且其进化树的枝长也不相关）；2，输入文件包含多个基因，这些基因具有相同的Kappa值，不同的Pi值；3，输入文件包含多个基因，这些基因具有相同的Pi值，不同的Kappa值；4，输入文件包含多个基因，这些基因具有不同的Kappa值和不同的Pi值。当值是2、3或4时，多个基因的进化树枝长虽然长度不一样，但是呈正比关系。这点和参数值等于1是不一样的。</span><br><span class="line">        icode = 0      *设置遗传密码。其值1-10和NCBI的1-11遗传密码规则对应：0，表示通用的遗传密码。</span><br><span class="line">   Small_Diff = .5e-6  *设置一个很小的值，一般位于1e-8到1e-5之间。推荐检测设置不同的值在比较其结果，需要该参数值对结果没什么影响。</span><br><span class="line"></span><br><span class="line">*位点替换模型参数：</span><br><span class="line">        model = 1            *若输入数据是密码子序列，该参数用于设置branch models，即进化树各分枝的omega值的分布：0，进化树上所有分枝的omega值一致；1，对每个分枝单独进行omega计算；2，设置多类omega值，根据树文件中对分枝的编号信息来确定类别，具有相同编号的分枝具有相同的omega值，没有编号的分枝具有相同的omega值，程序分别计算各编号和没有编号的omega值。</span><br><span class="line">                             *若输入数据是蛋白序列，或数据是密码子序列且seqtype值是3时，该参数用于设置氨基酸替换模型：0，Poisson；1，氨基酸替换率和氨基酸的观测频率成正比；2，从aaRatefile参数指定的文件路径中读取氨基酸替换率信息，这些信息是根据经验获得，并记录到后缀为.dat的配置文件中。这些经验模型(Empirical Models)文件位于PAML软件安装目录中的dat目录下，例如，Dayhoff(dayhoff.dat)、WAG(wag.dat)、LG(lg.dat)、mtMAN(mtman.dat)和mtREV24(mtREV24.dat)等；</span><br><span class="line">   aaRatefile = dat/wag.dat  *当对蛋白数据进行分析，且model = 2时，该参数生效，用于设置氨基酸替换模型。</span><br><span class="line">       aaDist = 0            *设置氨基酸之间的距离。</span><br><span class="line">      NSsites = 0            *输入数据时密码子序列时生效，用于设置site model，即序列各位点的omega值的分布：0，所有位点具有相同的omega值；1，各位点上的omega值小于1或等于1（服从中性进化neutral）；2，各位点上的omega值小于1、等于1或大于1（选择性进化selection）；3，discrete；4，freq；5:gamma；6，2gamma；7，beta；8，beta&amp;w；9，beta&amp;gamma；10，beta&amp;gamma+1；11，beta&amp;normal&gt;1；12，0&amp;2normal&gt;1；13，3normal&gt;0。</span><br><span class="line">                             *可以一次输入多个模型进行计算并比较，其结果输出的rst文件中。</span><br><span class="line">    fix_alpha = 1            *序列中不同的位点具有不同的碱基替换率，服从discrete-gamma分布，该模型通过alpha（shape参数）和ncatG参数控制。该参数设置是否给定一个alpha值：0，使用ML方法对alpha值进行计算；1，使用下一个参数设置一个固定的alpha值。</span><br><span class="line">	                     *对于密码子序列，当NSsites参数值不为0或model不为0时，推荐设置fix_alpha = 1且alpha = 0，即不设置alpha值，认为位点间的变异速率一致，否则程序报错。若设置了alpha值，则程序认为不同密码子位点的变异速率不均匀，且同时所有位点的omega值一致，当然各分枝的omega值也会一致，这时要求NSsites和model参数值都设置为0（这一般不是我们需要的分析，它不能进行正选择分析了）。</span><br><span class="line">        alpha = 0            *设置一个固定的alpha值或初始alpha值（推荐设置为0.5）。该值小于1，表示只有少数热点位置的替换率较高；该值越小，表示位点替换率在各位点上越不均匀；若设置fix_alpha = 1且alpha = 0则表示所有位点的替换率是恒定一致的。</span><br><span class="line">       Malpha = 0            *当输入的多序列比对结果中有多基因时，设置这些基因间的alpha值是否相等：0，分别对每个基因单独计算alpha值；1，所有基因的alpha值保持一致。</span><br><span class="line">        ncatG = 5            *序列中不同位点的变异速率服从GAMMA分布的，ncatG是其一个参数，一般设置为5，4，8或10，且序列条数越多，该值设置越大。</span><br><span class="line">                             *对于密码子序列，当NSites设置为3时，ncatG设置为3；当NSites设置为4时，ncatG设置为5；当NSites值设置&gt;=5时，ncatG值设置为10。</span><br><span class="line">    fix_kappa = 0            *设置是否给定一个Kappa值：0，通过ML迭代来估算Kappa值；1，使用下一个参数设置一个固定的Kappa值。</span><br><span class="line">        kappa = 2            *设置一个固定的Kappa值，或一个初始的Kappa值。</span><br><span class="line">    fix_omega = 0            *设置是否给定一个omega值：0，通过ML迭代来估算Kappa值；1，使用下一个参数设置一个固定的omega值。 </span><br><span class="line">        omega = .4           *设置一个固定的omega值，或一个初始的omega值。</span><br><span class="line">       method = 0            *设置评估枝长的ML迭代算法：0，使用PAML的老算法同时计算所有枝长，在clock = 0下有效；1，PAML新加入的算法，一次对一个枝长进行计算，该算法仅在clock参数值为1，2或3下工作。</span><br></pre></td></tr></table></figure>
<p>下面是我自己用的一个配置</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">#$ cat codeml-M0.ctl</span><br><span class="line">      seqfile = mtGenes.aligned.DNA.paml      * sequence data filename</span><br><span class="line">     treefile = unrooted_tree.txt      * tree structure file name</span><br><span class="line">      outfile = mtGenes.substitution           * main result file name</span><br><span class="line"></span><br><span class="line">      runmode = 0  * 0: user tree;  1: semi-automatic;  2: automatic</span><br><span class="line">                   * 3: StepwiseAddition; (4,5):PerturbationNNI; -2: pairwise</span><br><span class="line"></span><br><span class="line">      seqtype = 1  * 1:codons; 2:AAs; 3:codons--&gt;AAs</span><br><span class="line">    CodonFreq = 2  * 0:1/61 each, 1:F1X4, 2:F3X4, 3:codon table</span><br><span class="line"></span><br><span class="line">        ndata = 30 * number of gene alignments to be analysed</span><br><span class="line">        clock = 0  * 0:no clock, 1:clock; 2:local clock; 3:CombinedAnalysis</span><br><span class="line"></span><br><span class="line">        model = 2  * models for codons: 0:one, 1:b, 2:2 or more dN/dS ratios for branches</span><br><span class="line"></span><br><span class="line">      NSsites = 0  * 0:one w;1:neutral;2:selection; 3:discrete;4:freqs;</span><br><span class="line">                   * 5:gamma;6:2gamma;7:beta;8:beta&amp;w;9:beta&amp;gamma;</span><br><span class="line">                   * 10:beta&amp;gamma+1; 11:beta&amp;normal&gt;1; 12:0&amp;2normal&gt;1;</span><br><span class="line">                   * 13:3normal&gt;0</span><br><span class="line"></span><br><span class="line">        icode = 0  * 0:universal code; 1:mammalian mt; 2-10:see below</span><br><span class="line"></span><br><span class="line">    fix_omega = 0  * 1: omega or omega_1 fixed, 0: estimate </span><br><span class="line">        omega = .4 * initial or fixed omega, for codons or codon-based AAs</span><br><span class="line"></span><br><span class="line">    cleandata = 0  * remove sites with ambiguity data (1:yes, 0:no)?</span><br><span class="line"></span><br><span class="line">* Genetic codes: 0:universal, 1:mammalian mt., 2:yeast mt., 3:mold mt.,</span><br><span class="line">* 4: invertebrate mt., 5: ciliate nuclear, 6: echinoderm mt., </span><br><span class="line">* 7: euplotid mt., 8: alternative yeast nu. 9: ascidian mt., </span><br><span class="line">* 10: blepharisma nu.</span><br><span class="line">* These codes correspond to transl_table 1 to 11 of GENEBANK.</span><br></pre></td></tr></table></figure>
<p>下面是结果的展示。可以看到 w (dN/dS) for branches:  0.37585 0.22840，尾部的0.2284就是我们设置#1分支的ω，而第一个0.37585是其他分支的ω。由于所设定的物种的ω小于1，所以这个基因在该物种不是正向选择。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line">TREE #  1:  (((8, 7), 5), (4, ((1, 2), 3)), 6);   MP score: 160</span><br><span class="line">check convergence..</span><br><span class="line">lnL(ntime: 13  np: 16):  -3122.716855      +0.000000</span><br><span class="line">   9..10   10..11   11..8    11..7    10..5     9..12   12..4    12..13   13..14   14..1    14..2    13..3     9..6  </span><br><span class="line"> 0.008466 0.038271 0.303083 0.013331 0.024760 0.007420 0.033139 0.020543 0.021931 0.003298 0.005453 0.018905 0.029024 0.643248 0.375846 0.228401</span><br><span class="line"></span><br><span class="line">Note: Branch length is defined as number of nucleotide substitutions per codon (not per neucleotide site).</span><br><span class="line"></span><br><span class="line">tree length =   0.52763</span><br><span class="line"></span><br><span class="line">(((8: 0.303083, 7: 0.013331): 0.038271, 5: 0.024760): 0.008466, (4: 0.033139, ((1: 0.003298, 2: 0.005453): 0.021931, 3: 0.018905): 0.020543): 0.007420, 6: 0.029024);</span><br><span class="line"></span><br><span class="line">(((Vicia_faba: 0.303083, Medicago_truncatula: 0.013331): 0.038271, Lotus_japonicus: 0.024760): 0.008466, (Millettia_pinnata: 0.033139, ((Vigna_angularis: 0.003298, Vigna_radiata: 0.005453): 0.021931, Glycine_max: 0.018905): 0.020543): 0.007420, Ammopiptanthus_mongolicus: 0.029024);</span><br><span class="line"></span><br><span class="line">Detailed output identifying parameters</span><br><span class="line"></span><br><span class="line">kappa (ts/tv) =  0.64325</span><br><span class="line"></span><br><span class="line">w (dN/dS) for branches:  0.37585 0.22840</span><br><span class="line"></span><br><span class="line">dN &amp; dS for each branch</span><br><span class="line"></span><br><span class="line"> branch          t       N       S   dN/dS      dN      dS  N*dN  S*dS</span><br><span class="line"></span><br><span class="line">   9..10     0.008  1077.6   338.4  0.3758  0.0020  0.0054   2.2   1.8</span><br><span class="line">  10..11     0.038  1077.6   338.4  0.3758  0.0091  0.0243   9.8   8.2</span><br><span class="line">  11..8      0.303  1077.6   338.4  0.3758  0.0723  0.1924  77.9  65.1</span><br><span class="line">  11..7      0.013  1077.6   338.4  0.3758  0.0032  0.0085   3.4   2.9</span><br><span class="line">  10..5      0.025  1077.6   338.4  0.3758  0.0059  0.0157   6.4   5.3</span><br><span class="line">   9..12     0.007  1077.6   338.4  0.3758  0.0018  0.0047   1.9   1.6</span><br><span class="line">  12..4      0.033  1077.6   338.4  0.3758  0.0079  0.0210   8.5   7.1</span><br><span class="line">  12..13     0.021  1077.6   338.4  0.3758  0.0049  0.0130   5.3   4.4</span><br><span class="line">  13..14     0.022  1077.6   338.4  0.3758  0.0052  0.0139   5.6   4.7</span><br><span class="line">  14..1      0.003  1077.6   338.4  0.3758  0.0008  0.0021   0.8   0.7</span><br><span class="line">  14..2      0.005  1077.6   338.4  0.3758  0.0013  0.0035   1.4   1.2</span><br><span class="line">  13..3      0.019  1077.6   338.4  0.3758  0.0045  0.0120   4.9   4.1</span><br><span class="line">   9..6      0.029  1077.6   338.4  0.2284  0.0054  0.0234   5.8   7.9</span><br><span class="line"></span><br><span class="line">tree length for dN:       0.1243</span><br><span class="line">tree length for dS:       0.3400</span><br><span class="line">dS tree:</span><br><span class="line">(((Vicia_faba: 0.192424, Medicago_truncatula: 0.008464): 0.024298, Lotus_japonicus: 0.015720): 0.005375, (Millettia_pinnata: 0.021039, ((Vigna_angularis: 0.002094, Vigna_radiata: 0.003462): 0.013924, Glycine_max: 0.012003): 0.013043): 0.004711, Ammopiptanthus_mongolicus: 0.023436);</span><br><span class="line">dN tree:</span><br><span class="line">(((Vicia_faba: 0.072322, Medicago_truncatula: 0.003181): 0.009132, Lotus_japonicus: 0.005908): 0.002020, (Millettia_pinnata: 0.007908, ((Vigna_angularis: 0.000787, Vigna_radiata: 0.001301): 0.005233, Glycine_max: 0.004511): 0.004902): 0.001770, Ammopiptanthus_mongolicus: 0.005353);</span><br><span class="line"></span><br><span class="line">w ratios as labels for TreeView:</span><br><span class="line">(((Vicia_faba #0.3758 , Medicago_truncatula #0.3758 ) #0.3758 , Lotus_japonicus #0.3758 ) #0.3758 , (Millettia_pinnata #0.3758 , ((Vigna_angularis #0.3758 , Vigna_radiata #0.3758 ) #0.3758 , Glycine_max #0.3758 ) #0.3758 ) #0.3758 , Ammopiptanthus_mongolicus #0.2284 );</span><br><span class="line"></span><br><span class="line">Time used:  0:05</span><br></pre></td></tr></table></figure>
<p>上述 ctl 文件中 model = 2，运行得到一个结果文件。然后将其中的 model 参数改为 0，再次运行，得到新的结果文件。那么现在有三个文件是我需要的。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">all.genes.list</span><br><span class="line">result.branch_model_0.mcl</span><br><span class="line">result.branch_model_2.mcl</span><br></pre></td></tr></table></figure>
<p>我根据这三个文件，得到了下面的表格。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">$ perl chi2_calculator.pl </span><br><span class="line"># The number of &quot;genes, lnL0 number, lnL1 number&quot; are the same.</span><br><span class="line"># If you see this info, the data is probably OK.</span><br><span class="line">#Number Group   lnL0    lnL1    Omega_branch    Omega_controlP_value</span><br><span class="line">Number:1        atp1    lnL0:-3145.827397       lnL1:-3122.716855       Omega_branch:0.22840    Omega_control:0.37585   P_value:0.000000000</span><br><span class="line">Number:2        atp4    lnL0:-930.895378        lnL1:-930.038146        Omega_branch:0.45618    Omega_control:0.52692   P_value:0.424335018</span><br><span class="line">Number:3        atp6    lnL0:-1453.909109       lnL1:-1446.498209       Omega_branch:0.86281    Omega_control:0.37541   P_value:0.000604626</span><br><span class="line">Number:4        atp8    lnL0:-924.486129        lnL1:-914.009795        Omega_branch:1.75174    Omega_control:0.19043   P_value:0.000028196</span><br><span class="line">Number:5        atp9    lnL0:-333.236113        lnL1:-331.374307        Omega_branch:0.00010    Omega_control:0.39757   P_value:0.155391739</span><br><span class="line">Number:6        ccmB    lnL0:-1023.961013       lnL1:-1022.534291       Omega_branch:999.00000  Omega_control:0.56135   P_value:0.240094664</span><br><span class="line">Number:7        ccmC    lnL0:-1131.746218       lnL1:-1129.394721       Omega_branch:999.00000  Omega_control:0.39406   P_value:0.095226501</span><br><span class="line">Number:8        ccmFC   lnL0:-1950.197350       lnL1:-1948.956865       Omega_branch:0.42724    Omega_control:0.88398   P_value:0.289243901</span><br><span class="line">Number:9        ccmFN   lnL0:-2737.722421       lnL1:-2737.051425       Omega_branch:1.13399    Omega_control:0.65455   P_value:0.511199170</span><br><span class="line">Number:10       cob     lnL0:-1836.351940       lnL1:-1826.480046       Omega_branch:0.16318    Omega_control:0.22020   P_value:0.000051605</span><br><span class="line">Number:11       cox1    lnL0:-2381.442730       lnL1:-2354.196627       Omega_branch:0.09805    Omega_control:0.04898   P_value:0.000000000</span><br><span class="line">Number:12       cox3    lnL0:-1220.568961       lnL1:-1218.320955       Omega_branch:0.00010    Omega_control:0.53125   P_value:0.105609600</span><br><span class="line">Number:13       matR    lnL0:-3293.272506       lnL1:-3288.780620       Omega_branch:1.06998    Omega_control:0.46260   P_value:0.011199502</span><br><span class="line">Number:14       mttB    lnL0:-1110.395753       lnL1:-1109.356198       Omega_branch:1.07609    Omega_control:0.44712   P_value:0.353612004</span><br><span class="line">Number:15       nad1    lnL0:-1410.749338       lnL1:-1404.082741       Omega_branch:0.34165    Omega_control:0.13677   P_value:0.001272722</span><br><span class="line">Number:16       nad2    lnL0:-2199.786871       lnL1:-2187.259279       Omega_branch:0.80075    Omega_control:0.12534   P_value:0.000003625</span><br><span class="line">Number:17       nad3    lnL0:-537.855553        lnL1:-532.299091        Omega_branch:0.00010    Omega_control:0.27379   P_value:0.003862417</span><br><span class="line">Number:18       nad4    lnL0:-2549.647893       lnL1:-2546.428114       Omega_branch:0.25913    Omega_control:0.61043   P_value:0.039963889</span><br><span class="line">Number:19       nad4L   lnL0:-420.857873        lnL1:-413.049727        Omega_branch:0.00010    Omega_control:0.00010   P_value:0.000406411</span><br><span class="line">Number:20       nad5    lnL0:-2986.298356       lnL1:-2975.844248       Omega_branch:0.15621    Omega_control:0.26908   P_value:0.000028830</span><br><span class="line">Number:21       nad6    lnL0:-1099.896407       lnL1:-1092.361003       Omega_branch:0.54957    Omega_control:0.24816   P_value:0.000533846</span><br><span class="line">Number:22       nad7    lnL0:-1766.620230       lnL1:-1765.116602       Omega_branch:0.51002    Omega_control:0.42390   P_value:0.222322111</span><br><span class="line">Number:23       nad9    lnL0:-1032.089035       lnL1:-1031.583127       Omega_branch:999.00000  Omega_control:0.86278   P_value:0.602957841</span><br><span class="line">Number:24       rpl16   lnL0:-895.556806        lnL1:-891.758505        Omega_branch:0.27993    Omega_control:0.35303   P_value:0.022408812</span><br><span class="line">Number:25       rpl5    lnL0:-920.541028        lnL1:-919.686869        Omega_branch:0.86954    Omega_control:0.50538   P_value:0.425641005</span><br><span class="line">Number:26       rps10   lnL0:-603.758104        lnL1:-600.272712        Omega_branch:999.00000  Omega_control:0.30933   P_value:0.030641745</span><br><span class="line">Number:27       rps12   lnL0:-613.237087        lnL1:-609.335187        Omega_branch:999.00000  Omega_control:0.21780   P_value:0.020203488</span><br><span class="line">Number:28       rps14   lnL0:-493.189267        lnL1:-491.210035        Omega_branch:0.26530    Omega_control:0.31987   P_value:0.138175315</span><br><span class="line">Number:29       rps3    lnL0:-2982.678697       lnL1:-2978.575083       Omega_branch:0.54439    Omega_control:0.53311   P_value:0.016512890</span><br><span class="line">Number:30       rps4    lnL0:-1761.670696       lnL1:-1760.205396       Omega_branch:0.44191    Omega_control:0.58927   P_value:0.231008678</span><br></pre></td></tr></table></figure>
<p>附上 <code>chi2_calculator.pl</code> 程序的代码。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br></pre></td><td class="code"><pre><span class="line">#!/usr/bin/perl</span><br><span class="line">#/*************************************************************************</span><br><span class="line">#	&gt; File Name: chi2_calculator.pl</span><br><span class="line">#	&gt; Author: fenglei</span><br><span class="line">#	&gt; Mail: fengleiluck@gmail.com</span><br><span class="line">#	&gt; Created Time: Thu 07 Oct 2021 01:26:04 PM CST</span><br><span class="line"># ************************************************************************/</span><br><span class="line"></span><br><span class="line">open GENE_LIST, &quot;&lt;30_genes.list&quot; or die &quot;Can not open the file!\n&quot;;</span><br><span class="line">open NONMODEL, &quot;&lt;mtGenes.branch_model_0.mcl&quot; or die &quot;Can not open the file!\n&quot;;  # 找到这样的行：lnL(ntime: 13  np: 16):  -3122.716855      +0.000000  </span><br><span class="line">open ALTERNATIVE, &quot;&lt;mtGenes.branch_model_2.mcl&quot; or die &quot;Can not open the file!\n&quot;;</span><br><span class="line"></span><br><span class="line">#####  perl chi2_calculator.pl &gt; out</span><br><span class="line">#####  依据上面三个文件，依次计算P值（通过似然率检验（LRT）（卡方检验）获得p值确定零假设模型和备选模型之间是否存在差异）</span><br><span class="line">#      能否同时输出 omega 值？  Alternative 文件里面有一行“w (dN/dS) for branches:  0.37585 0.22840” 第二个数字是我需要的</span><br><span class="line">my @genes;</span><br><span class="line">while(&lt;GENE_LIST&gt;)&#123;</span><br><span class="line">	chomp $_;</span><br><span class="line">	push @genes, $_;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">my @lnL0;</span><br><span class="line">while(&lt;NONMODEL&gt;)&#123;</span><br><span class="line">	chomp $_;</span><br><span class="line">	my $record = $_;</span><br><span class="line">	if($record =~ m/lnL/)&#123;</span><br><span class="line">		my @array = split(/\s+/, $record);</span><br><span class="line">		#print &quot;lnL0: $array[4]\n&quot;; exit;</span><br><span class="line">		push @lnL0, $array[4];</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">my @lnL1;</span><br><span class="line">my @omega_branch;</span><br><span class="line">my @omega_control;</span><br><span class="line">while(&lt;ALTERNATIVE&gt;)&#123;</span><br><span class="line">	chomp $_;</span><br><span class="line">	my $record = $_;</span><br><span class="line">	if($record =~ m/lnL/)&#123;   # 找到这样的行：lnL(ntime: 13  np: 16):  -3122.716855      +0.000000 </span><br><span class="line">		my @array = split(/\s+/, $record);</span><br><span class="line">		push @lnL1, $array[4];</span><br><span class="line">	&#125;</span><br><span class="line">	if($record =~ m/w\s\(dN\/dS\)\sfor\sbranches\:/)&#123;   # 找到这样的行：w (dN/dS) for branches:  0.37585 0.22840” 第二个数字是我需要的选定brach的omega</span><br><span class="line">		my @array = split(/\s+/, $record);</span><br><span class="line">		push @omega_branch,  $array[-1];</span><br><span class="line">		push @omega_control, $array[-2];</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">if($#genes == $#lnL0 &amp;&amp; $#genes == $#lnL1)&#123;</span><br><span class="line">	print &quot;# The number of \&quot;genes, lnL0 number, lnL1 number\&quot; are the same.\n# If you see this info, the data is probably OK.\n&quot;;</span><br><span class="line">	#exit;</span><br><span class="line">&#125;</span><br><span class="line">else&#123;</span><br><span class="line">	print &quot;# The number of \&quot;genes, lnL0 number, lnL1 number\&quot; are NOT the same.\n# If you see this info, the data is probably NOT OK.\n# You should have a check.\n&quot;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">print &quot;#Number\tGroup\tlnL0\tlnL1\tOmega_branch\tOmega_control\tP_value\n&quot;;</span><br><span class="line"></span><br><span class="line">for(my $count=0; $count&lt;=$#genes; $count++)&#123;</span><br><span class="line">	$num = $count + 1;</span><br><span class="line">	print &quot;Number:$num\t$genes[$count]\tlnL0:$lnL0[$count]\tlnL1:$lnL1[$count]\tOmega_branch:$omega_branch[$count]\tOmega_control:$omega_control[$count]\t&quot;;</span><br><span class="line">	my $likelihood = 2 * abs( $lnL0[$count] - $lnL1[$count] );</span><br><span class="line">	my $df  = 2;  ### ??? df=1 or df=2 ???</span><br><span class="line">	system(&quot;~/local/app/PAML4.8/bin/chi2 $df $likelihood &gt; /tmp/chi2_result.txt&quot;);  # 三行的一个文件：首行空格，次行“df =  2  prob = 0.016512890 = 1.651e-02”，末行空格。需要提取P值</span><br><span class="line">	open CHISQUARE, &quot;/tmp/chi2_result.txt&quot; or die &quot;Can not open the file!\n&quot;;</span><br><span class="line">	my $p_value = 1;</span><br><span class="line">	while(&lt;CHISQUARE&gt;)&#123;</span><br><span class="line">		chomp $_;</span><br><span class="line">		my $record = $_;</span><br><span class="line">		if($record =~ m/prob/)&#123;</span><br><span class="line">			my @array = split(/\s+/, $record);</span><br><span class="line">			$p_value = $array[-3]/2;  ### PAML文档（http://abacus.gene.ucl.ac.uk/software/pamlDOC.pdf ; Page 30），p值应该是chi2程序的结果除以2。chenlianfu也有如此记录）</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	print &quot;P_value:$p_value\n&quot;;</span><br><span class="line">	close CHISQUARE;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">=pod</span><br><span class="line">system(&quot;~/local/app/PAML4.8/bin/chi2 2 55&quot;);</span><br><span class="line">$df = 2;</span><br><span class="line">$likelihood = 23;</span><br><span class="line">system(&quot;~/local/app/PAML4.8/bin/chi2 $df $likelihood &gt;&gt; P_value.txt&quot;);</span><br><span class="line">print &quot;test\n&quot;;</span><br><span class="line"># print &quot;$a\n&quot;;  # 这命令输出的是 0，也就是 system 命令输出在屏幕的内容，不能传递给变量。</span><br><span class="line">=cut</span><br><span class="line"></span><br><span class="line">close GENE_LIST;</span><br><span class="line">close NONMODEL;</span><br><span class="line">close ALTERNATIVE;</span><br></pre></td></tr></table></figure>
<p><u><font color=blue>按照前文 Science 杂志那个反刍动物的研究论文资料，我这里的 branch model 实际上找到的是指定分支上的快速进化基因 Rapidly evolved genes。如果要做正向选择分析，要使用 branch-site mode，即参考下文的PAML四大模型之第三个模型，分别设置ModelA：“model = 2, NSsites = 2, fix_omega = 0, omega = 1.5” 和 Model A Null：“model = 2, NSsites = 2, fix_omega = 1, omega = 1”。</font></u></p>
<p>附<a target="_blank" rel="noopener" href="http://www.chenlianfu.com/?m=201910">chenlianfu</a>关于正向选择分析步骤的总结：</p>
<p>(1) 收集该基因在多个物种中的 CDS 和 protein 序列（可以使用 orthoMCL 分析结果）。<br />
(2) 对该基因的蛋白序列进行多序列比对，再根据 CDS 序列转换成 Codon 序列比对结果。这个步骤需要自己编写一些程序来实现。<br />
(3) 根据 Codon 序列的比对结果构建系统发育树。推荐使用 RAxML 软件使用 ML 算法对所有的单拷贝同源基因进行物种树构建。然后，输入物种树信息、Codon 多序列比对信息，使用 codeml 进行 omega 计算和选择压模型检验。<br />
(4) 快速过滤非正选择基因：设置 runmode = -2 运行 codeml 命令对两两序列比较，使用 ML 方法计算 dNdS，若存在 omega 值大于1，则认为该基因可能属于正选择基因，进行后续分析。<br />
(5) 正选择基因的初步鉴定方法：设置 model = 0、NSsites = 1 2 运行 codeml 命令（site models）分别对正选择模型(M2a)和近中性进化模型(M1a)进行检测，若两种模型的似然值相差较大，通过自由度为 2 的卡方检验，可以确定该基因是否为正选择基因。从程序结果中（例如：lnL(ntime: 11 np: 16): -870.867266 +0.000000）可以找到 M2a 模型的似然值 l1 和 M1a 模型的似然值 l0，再计算 2Δl = 2(l1-l0)，通过命令“chi2 2 2Δl”根据卡方检验算出 p 值。此外，也可以设置 NSsites = 7 8 进行计算，则表示分别对 M8(beta &amp; omega) 和 M7(beta) 模型进行检测，和前者类似，若两种模型的似然值相差较大，通过自由度为 2 的卡方检验，可以确定该基因是否为正选择基因。根据 PAML 作者所说，M2a 和 M1a 的比较，比 M7-M8 的比较更严格。即若想得到更多的正选择基因，可以使用 M7_VS_M8 分析。此外，根据 M2 和 M8 模型的 BEB（Bayes empirical Bayes）分析结果，还可以得到在多序列比对结果中第一条序列上的正选择位点。根据 PAM L作者所说，这种 site models 之间的比较，能用于检测是否在序列上不同的位点具有不同的 omega 值，而不是用于正选择检测（We suggest that The M0-M3 comparison should be used as a test of variable ω among sites rather than a test of positive selection）。<br />
(6) <font color=blue>指定分化枝上的正选择基因鉴定方法：经过上一步初步鉴定后，设置 model = 2、NSsites = 2、fix_omega = 0、omega = 2.0 运行codeml命令（branch-site model A）；再设置 model = 2、NSsites = 2、fix_omega = 1、omega = 1 运行 codeml 命令（modified branch-site model A / null model）。进行这两种模型分析时，要求输入的树文件中对目标分化枝进行标注。对这两种模型进行 LRT 分析，计算 2Δl = 2(l1-l0)，注意是前者的似然值减后者（null model）的似然值；再使用自由度为 1 的卡方检验，通过命令“chi2 1 2Δl”计算出的值再除以 2，即得到 p 值。</font><br />
(7) <font color=blue>目标分化枝上的快速进化基因（Rapidly evolving gene）鉴定方法：设置 model = 0、NSsites = 0 运行 codeml 命令，再设置 model = 2、NSsites = 0 运行 codeml 命令（这时要求输入的树文件中对目标分化枝进行标注）</font>。然后比较两种运行模式下的似然值，通过自由度为 1 的卡方检验，可以鉴定该基因在目标分化枝的 omega 值和背景差异显著。</p>
<h3 id="一些测试与思考"><a class="markdownIt-Anchor" href="#一些测试与思考"></a> 一些测试与思考</h3>
<p>对于一个基因或者固定数目的少数基因，我按照一个参考流程 <a target="_blank" rel="noopener" href="https://figshare.com/articles/journal_contribution/worked_example_pdf/3839583">https://figshare.com/articles/journal_contribution/worked_example_pdf/3839583</a>，即可计算出 omega 值。</p>
<p>该 demo 用的是 6 个物种的单拷贝 orthologous，有 3000 多个基因。而我的实验里，想用 16 个物种运行单拷贝基因鉴定，只有 322 个基因，这样范围太小，怎么改善？</p>
<p>对于无根树文件而言，如果要指定运算某个分支的进化速率，需要在那个分支上加一个“#1”。这里的意思是该物种有一个进化速率 omega，而其他物种有统一的 omega。在另一个资料中，我发现还可以在tree文件中给指定的分支设定“$1”，比如<a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1Qx411m7Bn?from=search&amp;seid=9774626637377853773&amp;spm_id_from=333.337.0.0">作者</a>用到四种海洋哺乳动物，四种陆地动物的 myoglobin 基因做的正向选择分析，把四种海洋动物标记为“$1”，这样运行结果就是指这四个鲸鱼具有统一的 omega。</p>
<p><img src="https://i.imgur.com/feqs2ew.png" alt="" /></p>
<p>比对的基因序列文件中，物种数目少于tree文件中的物种数目，似乎也可以运行得到结果？（有待确认？如果真的是这样，那我如果对若干个orthologous基因的正向选择做计算，只需要一个tree文件就可以，对于个别基因而言，确实个别物种的orthologous不会影响结果。）2021.10.08 做了一个测试，如果tree文件里面有8个物种，但是phylip格式的序列文件里面只有7个物种，codeml程序会报错的。</p>
<p>Model=0; NSsites= 7 8; 这样结果里面确实有两个 1nL 值，可以用来计算 P 值，但是没有特定 branch 的 ω，而我需要的是特定分支的 ω。这个模式确实无法实现我的目的，因为 Model=0 就表示所有分支的 Omega 都是固定的。</p>
<p>对于 codeml 的配置文件而言，里面的 model 可以设置为 0、1 或 2，这三个参数有什么区别？这个参数主要设定不同分支的ω是否一致。<font color=blue>当model=0，NSsites=0，那么表示假设所有分支、所有氨基酸位点的ω都是一致的。当 model=2, NSsites=0，即假设前景支与背景支的ω不同，出来的结果特定分支ω跟其他分支ω不同，此时其他分支的ω一致。对这两个不同的假设来做卡方检验，即可推算出前者为假的可能性（即 P 值），当 P &lt; 0.05， 可信度高。</font></p>
<p><img src="https://i.imgur.com/h89xpWB.png" alt="Model=0，假设所有分支ω一致" /></p>
<p><img src="https://i.imgur.com/64Ec8kB.png" alt="Model=2，假设前景支与背景支的ω不同" /></p>
<p><img src="https://i.imgur.com/R4qryV2.png" alt="对上述两个假设做卡方检验" /></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line">Model 7: beta (10 categories)</span><br><span class="line"></span><br><span class="line">TREE #  1:  (((8, 7), 5), (4, ((1, 2), 3)), 6);   MP score: 160</span><br><span class="line">lnL(ntime: 13  np: 16):  -3062.689720      +0.000000</span><br><span class="line">   9..10   10..11   11..8    11..7    10..5     9..12   12..4    12..13   13..14   14..1    14..2    13..3     9..6  </span><br><span class="line"> 0.007984 0.037210 0.329993 0.012402 0.023400 0.007531 0.031297 0.019721 0.020914 0.003075 0.005174 0.017900 0.027104 0.522045 0.005000 0.019948</span><br><span class="line"></span><br><span class="line">Note: Branch length is defined as number of nucleotide substitutions per codon (not per neucleotide site).</span><br><span class="line">...</span><br><span class="line">Model 8: beta&amp;w&gt;1 (11 categories)</span><br><span class="line"></span><br><span class="line">TREE #  1:  (((8, 7), 5), (4, ((1, 2), 3)), 6);   MP score: 160</span><br><span class="line">lnL(ntime: 13  np: 18):  -3041.864857      +0.000000</span><br><span class="line">   9..10   10..11   11..8    11..7    10..5     9..12   12..4    12..13   13..14   14..1    14..2    13..3     9..6  </span><br><span class="line"> 0.008053 0.038859 0.392264 0.011943 0.023468 0.008401 0.030708 0.020215 0.021091 0.002819 0.005071 0.017885 0.027144 0.504233 0.894161 0.007220 0.044307 4.278923</span><br><span class="line"></span><br><span class="line">Note: Branch length is defined as number of nucleotide substitutions per codon (not per neucleotide site).</span><br><span class="line"></span><br><span class="line">tree length =   0.60792</span><br><span class="line"></span><br><span class="line">(((8: 0.392264, 7: 0.011943): 0.038859, 5: 0.023468): 0.008053, (4: 0.030708, ((1: 0.002819, 2: 0.005071): 0.021091, 3: 0.017885): 0.020215): 0.008401, 6: 0.027144);</span><br><span class="line"></span><br><span class="line">(((Vicia_faba: 0.392264, Medicago_truncatula: 0.011943): 0.038859, Lotus_japonicus: 0.023468): 0.008053, (Millettia_pinnata: 0.030708, ((Vigna_angularis: 0.002819, Vigna_radiata: 0.005071): 0.021091, Glycine_max: 0.017885): 0.020215): 0.008401, Ammopiptanthus_mongolicus: 0.027144);</span><br><span class="line"></span><br><span class="line">Detailed output identifying parameters</span><br><span class="line"></span><br><span class="line">kappa (ts/tv) =  0.50423</span><br><span class="line"></span><br><span class="line">Parameters in M8 (beta&amp;w&gt;1):</span><br><span class="line">  p0 =   0.89416  p =   0.00722 q =   0.04431</span><br><span class="line"> (p1 =   0.10584) w =   4.27892</span><br><span class="line"> ...</span><br></pre></td></tr></table></figure>
<p>下面的方法（来自<a target="_blank" rel="noopener" href="http://www.chenlianfu.com/?p=3036">chenlianfu.com</a>）可以检测指定分支的 ω, 并且计算 P 值。我查阅了 PAML 的文档，确实是这么计算 P 值。</p>
<p><font color=blue>指定分化枝上的正选择基因鉴定方法：经过上一步初步鉴定后，设置 <code>model = 2、NSsites = 2、fix_omega = 0、omega = 2.0</code> 运行 codeml 命令（branch-site model A）；再设置 <code>model = 2、NSsites = 2、fix_omega = 1、omega = 1</code> 运行 codeml 命令（modified branch-site model A / null model）。进行这两种模型分析时，要求输入的树文件中对目标分化枝进行标注。对这两种模型进行LRT分析，计算 2Δl = 2(l1-l0)，注意是前者（branch-site model A）的似然值减后者（null model）的似然值；再使用自由度为1的卡方检验，通过命令“chi2 1 2Δl”计算出的值再除以2，即得到p值。</font></p>
<p>20211011 备注：上面卡方检验直接 <code>chi2 2 2Δl</code> 即可？不需要除以二吧？—— 查阅文档之后看到，要除以二。</p>
<p><img src="https://i.imgur.com/TV6Sr9x.jpeg" alt="" /></p>
<p>上面截图中调用 <code>chi2 2 2.71</code> 命令，得到 “df =  2  prob = 0.257947294 = 2.579e-01”，再除以二就是 P 值。</p>
<p>其实也可以用 R 来做计算，在R界面输入命令 <code>pchisq(2.71, 2, lower.tail = FALSE)</code> 得到结果：“0.2579473”。跟上面调用 chi2 程序的结果是一致的。</p>
<p>卡方检验是一种用途很广的计数资料的假设检验方法，由卡尔·皮尔逊提出。它属于非参数检验的范畴，主要是比较两个及两个以上样本率( 构成比）以及两个分类变量的关联性分析。其根本思想就是在于比较理论频数和实际频数的吻合程度或拟合优度问题。比如<a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/42803826">我们想知道不吃晚饭对体重下降有没有影响</a>，即探讨吃晚饭与体重的关系，将一个人群分为“吃晚饭组”与“不吃晚饭组”</p>
<h3 id="学习笔记怎么通过-chi2-计算-p-值"><a class="markdownIt-Anchor" href="#学习笔记怎么通过-chi2-计算-p-值"></a> 学习笔记：怎么通过 chi2 计算 P 值？</h3>
<p>一开始接触 codeml 的时候，并不清楚怎么计算 P 值，经过阅读一些相关材料，获得 P 值计算方法，大致记录如下。</p>
<p>上面的 codeml 运行结果文件有这么一行：lnL(ntime: 13  np: 16):  -3122.716855      +0.000000</p>
<p>这个“-3122.716855”就有用，我们修改 ctl 文件的参数之后，再次运行 codeml 程序，将生成一个新的 lnL 值。依据前后两次 lnL 值，用下文提到的公式，就可以计算 P 值。</p>
<p><a target="_blank" rel="noopener" href="http://blog.sina.com.cn/s/blog_65ba09d90102x4um.html">http://blog.sina.com.cn/s/blog_65ba09d90102x4um.html</a> 上回讲到了用codeml计算选择位点的时候，同时选择M7和M8模型，这两个模型的差异进近在于 M8(beta &amp; ω) 模型比 M7 （beta）多了一个参数，所以可以依靠比较这两个模型来进行LRT。公式是这个：LRT = 2dl = abs(2 X (l1-l0)) （abs=绝对值）。Step1: 打开之前用codeml生成的 mcl 文件，找到 Model7, 和 Model8。两个lnL值想减，取绝对值，乘以2，这里是：2|-10302.87869-（-10332.64273）| = 59.52 (小数点后影响不大) Step2：打开PAML程序包中的 Chi2 程序, 分别输入自由度和刚才得到的数，自由度直接取 2 就好（这个是杨子恒自己说的，在PAML的文档里有写），后面写上Step1算出来的数字，得到的 p 小于 0.05 则结果比较可靠，这里的 p 非常小。</p>
<p><a target="_blank" rel="noopener" href="https://bcb.unl.edu/yyin/codeml.html">https://bcb.unl.edu/yyin/codeml.html</a> I write some simple ways to test likelihood ratio test on variable codon rates. These two models assume codon rates varied among all branchs. (1). M1a vs. M2a: M1a(model=0, NSsites=1), M2a(model=0, NSsites=2), the df = 2, LRT = 2dl = abs(2 X (l1- l0)). (2). M7 vs. M8: M1a(model=0, NSsites=7), M2a(model=0, NSsites=8), the df = 2, LRT = 2dl = abs(2 X (l1-l0)). The chi-square value can be calucated by PROGRAM CHI2.EXE in PAML.  If the p-value &lt;0.05, then we can conclude that some sites are under positive selection.</p>
<h3 id="paml-分析四大模型"><a class="markdownIt-Anchor" href="#paml-分析四大模型"></a> PAML 分析四大模型</h3>
<p>在paml分析里面，主要涉及四种模型：位点模型（site-model）、支模型（branch model）、支位点模型（branch site model）以及进化支模型。位点模型通常适用于检测某一支系普遍性、广泛性的正选择，这种正选择是由于位点持续改变所引起的，例如，适应多种病原体；支模型主要是检测某一支系是否存在快速进化、选择压力约束以及正选择，但却无法检测到正选择位点；<font color=blue>支位点模型比较准确与稳定，适用于检测某一支系断点性的正选择事件，此结果是由于适应某一时期环境改变所引起的，通常会保留在后代中</font>；进化支模型（clade model），则主要是判别不同物种之间是否存受分化选择压力作用，不局限于正选择，它一次可以标记多个分支进行比较。</p>
<ol>
<li><strong>位点模型</strong></li>
</ol>
<p>M0：假设所有位点具有相同的 dN/dS 值；<br />
M1a：假设存在两类位点—保守位点0 &lt; dN/dS &lt; 1，中性进化位点dN/dS = 1，并且估算这两类位点的比率（p0，p1）和ω值（ω0，ω1）；<br />
M2a：假设存在三类位点——纯化选择位点 dN/dS &lt; 1，中性进化位点dN/dS = 1与正选择位点dN/dS &gt; 1，并估算三类位点的比率（p0，p1，p2）；<br />
M3: 离散模型，假设所有位点的ω值呈离散分布；<br />
M7：假设所有位点0 &lt; ω &lt;1且呈现beta分布；<br />
M8：在M7模型的基础上，增加一类正选择位点（ω &gt;1）;<br />
M8a：与M8类似，只不过是将新增的ω固定为1；</p>
<p>位点模型的 Codeml.ctl 参数设置：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">model = 0                 </span><br><span class="line">NSsites = 0 1 2 3 7 8</span><br><span class="line">即分别比较如下模型（* 为正选择模型，前提是需要LRTs显著）：</span><br><span class="line">M3（分散比率） vs. M0（负选择）</span><br><span class="line">M2a* （正选择）vs. M1a （选择约束放松）</span><br><span class="line">M8*（正选择） vs. M7 （选择约束放松）</span><br><span class="line">M8* （正选择）vs. M8a（选择约束放松）</span><br></pre></td></tr></table></figure>
<ol start="2">
<li><strong>支模型</strong></li>
</ol>
<p>one rario：假设所有的进化谱系都具有相同的ω值；<br />
free ratio：假设所有的支系都具有独立的ω值；<br />
two ratio：假设前景支与背景支的ω不同</p>
<p>分支模型的Codeml.ctl参数设置：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">two ratio: model = 2, NSsites = 0  </span><br><span class="line">one ratio: model = 0, NSsites = 0</span><br><span class="line">free ratio: model = 1, NSsites = 0</span><br><span class="line">               </span><br><span class="line">one ratio（负选择） vs. free ratio（自由比率）</span><br><span class="line">one ratio（负选择） vs. two ratio （正选择）</span><br><span class="line">two ratio natural（中性进化） vs. two ratio （正选择）</span><br></pre></td></tr></table></figure>
<ol start="3">
<li><strong>支位点模型</strong></li>
</ol>
<p>假定位点间的ω值是变化的，同时也假定支系间的ω值是变化的。该模型主要用于检测前景支中正选择作用对部分位点的影响。<br />
modelA null（零假设）：ω值设定为固定值1<br />
modelA（备择假设）：估算其ω值是否大于1<br />
背景支与前景支具有相同的位点ω值：<br />
K0：前景支与背景支中的位点受到纯化选择0 &lt; ω &lt; 1；<br />
K1：前景支与背景支中的位点处于中性进化0 &lt; ω = 1;<br />
背景支与前景支具有不同的位点ω值：<br />
K2a：前景支处于中性进化，而背景支处于纯化选择；<br />
K2b：前景支受到正选择压力（ ω&gt;1 ），而背景支处于中性进化；<br />
支位点模型的的Codeml.ctl参数设置：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">ModelA：</span><br><span class="line">model = 2, NSsites = 2, fix_omega = 0, omega = 1.5</span><br><span class="line">ModelAnull：</span><br><span class="line">model = 2, NSsites = 2, fix_omega = 1, omega = 1</span><br><span class="line">即比较如下模型（* 为正选择模型，前提是需要LRTs显著）：</span><br><span class="line">ModelA*（正选择） vs. ModelAnull （中性进化）</span><br></pre></td></tr></table></figure>
<ol start="4">
<li><strong>进化支模型</strong></li>
</ol>
<p>与枝位点模型类型，能同时检测多个进化枝（Clade），但是该模型并没有将背景支的dN/dS值约束在（0,1）。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">M2a_model: model = 0 NSsites = 22</span><br><span class="line">Clade Model C: model = 3 NSsites = 2</span><br><span class="line">Clade Model D: model = 3 NSsites = 3</span><br><span class="line">Clade Model C vs. M2a_model</span><br></pre></td></tr></table></figure>
<h3 id="怎么区分-unrooted-tree-与-rooted-tree"><a class="markdownIt-Anchor" href="#怎么区分-unrooted-tree-与-rooted-tree"></a> 怎么区分 unrooted tree 与 rooted tree</h3>
<p>有时通过构建进化树的软件获得进化树后，软件不会对进化树是有根树，还是无根树做说明。在不做额外编写脚本的基础上，其实可以直接从newick文件的内容格式上区分有根树和无根树］</p>
<p>假设有下面三种形式的进化树：</p>
<p>[1] (a, b, c);      无根树</p>
<p>[2] (a, b, c):1;   有根树</p>
<p>[3] ((a,b),c);      有根树</p>
<p>除第一种形式的进化树外，其它两种形式的进化树都是有根树。R 语言对有根树、无根树的判断是：</p>
<p>如果最外层大括号内只有两个分枝，即为有根树，如 [3]；</p>
<p>如果最外层大括号内有三个或以上分枝，一般为无根树，如 [1]；</p>
<p>但是，如果大括号外存在枝长参数，如 [2] 中的 :1，这种情况认为三个分枝以一定的枝长连接到根上，为有根树。</p>
<p>我想通过上述三个例子，可以先看最外层是否有枝长参数，再数一下最外层括号下有几个分枝，即可简单地、直接地判断目前绝大多数获得的newick格式的进化树是有根树，还是无根树。</p>
<h3 id="实践"><a class="markdownIt-Anchor" href="#实践"></a> 实践</h3>
<p>如何收集基因？如果我想找出一个物种与相邻的若干物种相比较，有哪些基因出现了正向选择。首先，用 OrthoFinder 软件可以找出 single copy genes。这里要注意，初始的物种数目越多，single copy genes 越少，后续用于分析得到的结果越少，我看文献中有用到 7 个物种，摘录于此：“To detect genes evolving under positive selection in jujube, we used gene clustering of the seven Rosales species to identify 1,420 single-copy orthologous genes and used the optimized branch-site mode<sup>l63</sup> to identify 254 genes that are positively selected in <em>Z. jujuba</em>.” 另外，我觉得可以用 jcvi 流程，他会基于基因组位置和基因序列两个信息来做 orthologous 分析，以感兴趣物种为参考，将其他若干物种的基因集分别与之比较，就可以得这一群物种的 orthologous genes（反刍动物的进化分析其实就是类似这个策略，只不过他们用的是lastal比对软件），然后要思考的一点是，是不是必须所有物种都出现的ortholog gene，才用于后续分析。</p>
<p>2021.10.08</p>
<ol>
<li>选择7个物种，准备好CDS序列，然后翻译成pep序列，将用于orthofinder流程。注意，同时考虑jcvi流程需要的gff文件和pep文件。（别用花生。感觉序列质量不好。）</li>
<li>运行orthofinder流程，预计找到1000多个single copy genes</li>
<li>在AM与其他物种依次运行jcvi，然后整合结果，预计这种方式可以找到几千个orthologous genes</li>
<li>分别运行codeml流程，计算Ka/Ks值。并计算P值。看最终有多少个基因会出现正向选择。</li>
</ol>
<h3 id="参考资料"><a class="markdownIt-Anchor" href="#参考资料"></a> 参考资料</h3>
<p><a target="_blank" rel="noopener" href="http://yuzhenpeng.github.io/2019/12/24/paml/">于振朋: Comparative Genomics and Adaptive Evolution</a><br />
<a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1Qx411m7Bn?from=search&amp;seid=9774626637377853773&amp;spm_id_from=333.337.0.0">B 站 PAML 视频教程：利用 codeml 计算 dN/dS</a><br />
<a target="_blank" rel="noopener" href="http://www.chenlianfu.com/?p=3001">Chenlianfu: 使用 PAML 软件利用核酸序列进行系统发育参数分析</a><br />
<a target="_blank" rel="noopener" href="http://www.chenlianfu.com/?p=3036">Chenlianfu: 使用 PAML 软件利用密码子序列进行正选择分析</a><br />
<a target="_blank" rel="noopener" href="https://figshare.com/articles/journal_contribution/worked_example_pdf/3839583">A worked example of estimating ω and testing for adaptive evolution in six parasite species</a><br />
<a target="_blank" rel="noopener" href="http://wap.sciencenet.cn/blog-460481-1163040.html?mobile=1">高芳銮：选择压力分析之 EasyCodeML 完整篇（By Raindy)</a><br />
<a target="_blank" rel="noopener" href="https://static-content.springer.com/esm/art%3A10.1007%2Fs00606-019-01578-2/MediaObjects/606_2019_1578_MOESM1_ESM.pdf">Supplementary File 1 of “<u><em>Analyses of mitochondrial genomes of the genus Ammopiptanthus provide new insights into the evolution of legume plants</em></u>”</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://example.com/2021/09/20/Proteomics-Top-down-proteomics-analysis-of-histones/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/fl-photo-202109.jpg">
      <meta itemprop="name" content="FENG Lei">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="FENG's Notes">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/09/20/Proteomics-Top-down-proteomics-analysis-of-histones/" class="post-title-link" itemprop="url">Proteomics | Top-down proteomics analysis of histones</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>
              

              <time title="Created: 2021-09-20 13:31:13 / Modified: 16:28:51" itemprop="dateCreated datePublished" datetime="2021-09-20T13:31:13+08:00">2021-09-20</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Proteomics/" itemprop="url" rel="index"><span itemprop="name">Proteomics</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h3 id="1-workflow"><a class="markdownIt-Anchor" href="#1-workflow"></a> 1 workflow</h3>
<ol>
<li>crude histone isolation from cells or tissues;</li>
<li>offline HPLC to separete core histones  (H2, H3.1, H3.2, H4)</li>
<li>LC-MS (raw data)</li>
<li>MS data analysis</li>
</ol>
<p>Note: 图见 RGC proposal。</p>
<p><img src="https://ars.els-cdn.com/content/image/1-s2.0-S1046202319301732-gr1.jpg" alt="图例" /></p>
<h3 id="2-offline-hplc"><a class="markdownIt-Anchor" href="#2-offline-hplc"></a> 2 Offline HPLC</h3>
<p>Note：图见 RGC proposal</p>
<p><img src="https://www.researchgate.net/profile/Yifan-Liu-41/publication/235775342/figure/fig2/AS:931921148276736@1599198724085/HPLC-and-SDS-PAGE-separation-of-core-histones_W640.jpg" alt="图例" /></p>
<h3 id="3-ms1-chromatograph"><a class="markdownIt-Anchor" href="#3-ms1-chromatograph"></a> 3 MS1 chromatograph</h3>
<p>首先要安装 Thermo Fisher 的 Xcalibur 软件。安装方法，<a target="_blank" rel="noopener" href="https://thermo.flexnetoperations.com/control/thmo/login">https://thermo.flexnetoperations.com/control/thmo/login</a> ，使用教育邮箱注册，xx@link.cuhk.edu.hk，注册并登入，即可看到一系列软件的列表，我们选择 Xcalibur <a target="_blank" rel="noopener" href="https://thermo.flexnetoperations.com/control/thmo/product?child_plneID=820487&amp;ver=CURRENT">https://thermo.flexnetoperations.com/control/thmo/product?child_plneID=820487&amp;ver=CURRENT</a>，可执行文件 exe 格式，将文件下载到windows电脑，再安装，安装的软件里面就包含了 freestype。</p>
<p>将 raw data 导入 freestyle 软件，即可浏览 MS1 的图。如何导出高清图片？</p>
<p><img src="" alt="图例" /></p>
<h3 id="raw-data-to-pbf-和-ms2ft-格式文件"><a class="markdownIt-Anchor" href="#raw-data-to-pbf-和-ms2ft-格式文件"></a> raw data to pbf 和 ms2ft 格式文件。</h3>
<p>使用 ProMex 软件，可以将 raw 格式的质谱文件转换成 pbf 和 ms2ft 格式文件。</p>
<p>已经有公开的文献报道 top down proteomics 数据的分析方法 <a target="_blank" rel="noopener" href="https://www.nature.com/articles/nmeth.4388">NATURE METHODS: Informed-Proteomics: open-source software package for top-down proteomics</a>，可以去 <a target="_blank" rel="noopener" href="https://github.com/PNNL-Comp-Mass-Spec/Informed-Proteomics">github</a> 下载 Informed Proteomics，软件处于持续更新中，本笔记撰写的 2021 年仍有更新。</p>
<p>这些格式有什么不同呢？</p>
<p>raw:<br />
pbf: Creates a .pbf file This file contains spectra information and full chromatograms for MS1 and MSn data, allowing fast access to extracted ion chromatograms during the search.<br />
ms2ft:</p>
<p>“插播一句，这些格式转换的软件是 windows 平台的，如果要再 linux 下面跨平台运行，则需要用到 mono 软件，具体可以参考 <a target="_blank" rel="noopener" href="https://www.cnblogs.com/jessepeng/p/12452276.html">https://www.cnblogs.com/jessepeng/p/12452276.html</a>。mono 的安装并不容易，可能有些普通用户会碰到问题，主要是依赖libgdiplus库，只要这个解决了，源码安装三部曲就行了，这里不加以赘述。”</p>
<p>转换代码如下（参考：<a target="_blank" rel="noopener" href="https://github.com/PNNL-Comp-Mass-Spec/Informed-Proteomics">https://github.com/PNNL-Comp-Mass-Spec/Informed-Proteomics</a>）</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">PbfGen.exe -s MyDataset.raw</span><br><span class="line">ProMex.exe -i MyDataset.pbf -minCharge 2 -maxCharge 60 -minMass 3000 -maxMass 50000 -score n -csv n -maxThreads 0</span><br></pre></td></tr></table></figure>
<h3 id="sequence-alignment-and-idntification-of-ptms"><a class="markdownIt-Anchor" href="#sequence-alignment-and-idntification-of-ptms"></a> sequence alignment and idntification of PTMs</h3>
<p>得到pbf 和 ms2ft 文件之后，就可以检索蛋白序列和可能的修饰情况。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">MSPathFinderT.exe -s MyDataset.pbf -feature MyDataset.ms1ft -d C:\FASTA\ProteinList.fasta -o C:\WorkDir -t 10 -f 10 -m 1 -tda 1 -minLength 21 -maxLength 300 -minCharge 2 -maxCharge 30 -minFragCharge 1 -maxFragCharge 15 -minMass 3000 -maxMass 50000 -mod MSPathFinder_Mods.txt</span><br></pre></td></tr></table></figure>
<p>上面的 <code>Mods.txt</code> 文件即是可能的修饰情况，以大豆组蛋白为例，文件内容如下。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"># This file is used to specify modifications for MSPathFinder</span><br><span class="line"></span><br><span class="line"># Max Number of Modifications per peptide</span><br><span class="line">NumMods=9</span><br><span class="line"></span><br><span class="line"># Static mods</span><br><span class="line"># None</span><br><span class="line"></span><br><span class="line"># Dynamic mods</span><br><span class="line"># Functional group, Amino acid, opt?, Position, Modification type</span><br><span class="line">O1,MC,opt,any,Oxidation</span><br><span class="line">HO3P,ST,opt,any,Phospho</span><br><span class="line">C2H2O1,K,opt,any,Acetyl</span><br><span class="line">CH2,KR,opt,any,Methyl</span><br><span class="line">C2H4,KR,opt,any,Dimethyl</span><br><span class="line">C3H6,K,opt,any,Trimethyl</span><br><span class="line">C2H2O,*,opt,Prot-N-term,Acetyl     # Acetylation Protein N-term (C2H2O can be replaced with &quot;H(2) C(2) O&quot;)  </span><br></pre></td></tr></table></figure>
<p>运行结果，将得到一个 tsv （表格）文本文件，列出了可能的蛋白序列以及修饰情况，另有一个图片文件 <code>xxx.ms1ft.png</code>，意思？。</p>
<h3 id="图片"><a class="markdownIt-Anchor" href="#图片"></a> 图片</h3>
<p>上面的分析中，mods 文件中设定了一条蛋白序列上修饰的数目为 9 个，怎么确定这个数字是合理的？我设定为 10 个，跑了一天也没有结果，所以少于这10 会比较合适。另外需要画一个统计图，即从1到9个修饰的密度图，如果类似正态分布，就可以说明我们的设定是合理的。</p>
<p><img src="https://www.researchgate.net/publication/329379093/figure/fig4/AS:699921351049216@1543885662248/Degree-distribution-All-the-networks-show-a-Poisson-distribution-as-corresponds-to_W640.jpg" alt="图例" /></p>
<h3 id="图片-2"><a class="markdownIt-Anchor" href="#图片-2"></a> 图片</h3>
<p>各个位点的修饰情况统计。</p>
<p>（D:\博后课题文件\PHD5 project\200831 top-down proteomics in soybean\R代码-冯磊\ptm_freq_diagram\version 2 custom color）</p>
<p><img src="https://ars.els-cdn.com/content/image/1-s2.0-S1046202319301732-gr5.jpg" alt="图例" /></p>
<h3 id="interplay-score"><a class="markdownIt-Anchor" href="#interplay-score"></a> Interplay Score</h3>
<p>何谓 interplay score：<a target="_blank" rel="noopener" href="https://www.sciencedirect.com/science/article/pii/S1046202319301732">https://www.sciencedirect.com/science/article/pii/S1046202319301732</a><br />
何为 co-existence？<a target="_blank" rel="noopener" href="https://www.ncbi.nlm.nih.gov/pmc/articles/PMC5240223/bin/nihms840427f5.jpg">https://www.ncbi.nlm.nih.gov/pmc/articles/PMC5240223/bin/nihms840427f5.jpg</a></p>
<p>两个修饰是否存在coexisence？</p>
<p><img src="https://www.ncbi.nlm.nih.gov/pmc/articles/PMC5240223/bin/nihms840427f5.jpg" alt="图例" /></p>
<h3 id="样品之间的比较定量的问题"><a class="markdownIt-Anchor" href="#样品之间的比较定量的问题"></a> 样品之间的比较，定量的问题？</h3>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://example.com/2021/09/16/Bioinfo-TCseq-Time-Course-sequencing-data-analysis/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/fl-photo-202109.jpg">
      <meta itemprop="name" content="FENG Lei">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="FENG's Notes">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/09/16/Bioinfo-TCseq-Time-Course-sequencing-data-analysis/" class="post-title-link" itemprop="url">Bioinfo | TCseq Time Course sequencing data analysis</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>
              

              <time title="Created: 2021-09-16 11:01:58 / Modified: 13:53:39" itemprop="dateCreated datePublished" datetime="2021-09-16T11:01:58+08:00">2021-09-16</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Bioinformatics/" itemprop="url" rel="index"><span itemprop="name">Bioinformatics</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>转录组测序如果有多个时间点，可以做表达趋势分析，即基因表达模式聚类分析，可以用 STEM、Mfuzz、TCseq 软件等工具。</p>
<p>Mfuzz 采用了一种新的聚类算法 fuzzy c-means algorithm，在文献中称这种聚类算法为 soft clustering 算法，相比 K-means 等 hard clustering 算法，一定程度上降低了噪声对聚类结果的干扰，而且这种算法有效的定义了基因和 cluster 之间的关系，即基因是否属于某个 cluster, 对应的值为 memebership。</p>
<p>对于分析而言，我们只需要提供基因表达量的数据就可以了，需要注意的是，Mfuzz 默认你提供的数据是归一化之后的表达量，这意味着表达量必须可以直接在样本间进行比较，对于 FPKM, TPM 这两种定量方式而言，是可以直接在样本间进行比较的，但是对于 count 的定量结果，我们必须先进行归一化，可以使用 edgeR 或者 DESeq 先得到归一化之后的数据再进行后续分析。Mfuzz 的使用可参考：<a target="_blank" rel="noopener" href="https://cloud.tencent.com/developer/article/1625288">生信修炼手册：使用 Mfuzz 进行时间序列表达模式聚类分析</a></p>
<p>TCseq 则可以用 count 定量来做输入，他自己会调用 edgeR 来做样品之间的归一化。分析之前准备三个文件：（1）基因表达矩阵文件，可以直接拿原始 read count 数据；（2）样品分组情况的文件；（3）基因坐标文件。</p>
<p>下面列出文件内容：</p>
<p>（1）基因表达矩阵文件，可以直接拿原始 read count 数据。我是用 htseq-count 工具来做的每个基因的 read count 统计，这里按下不表。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">gene-id	L1-1A	L1-2A	L1-3A	L2-1A	L2-2A	L2-3A	L3-1A	L3-2A	L3-3A	L4-1A	L4-2A	L4-3A</span><br><span class="line">Chr01.g00016	72	74	30	16	95	134	100	10	57	95	78	5</span><br><span class="line">Chr01.g00017	1645	2072	2672	791	1105	1726	3060	947	882	1576	2414	466</span><br><span class="line">Chr01.g00018	8	3	59	6	16	16	19	6	0	12	3	1</span><br><span class="line">Chr01.g00019	1	14	26	2	5	7	15	0	0	8	6	0</span><br><span class="line">Chr01.g00020	0	0	0	0	0	0	0	0	0	0	0	0</span><br><span class="line">Chr01.g00021	0	0	0	0	0	0	0	0	0	0	0	0</span><br><span class="line">Chr01.g00022	1744	1912	2568	1549	2708	1966	2198	2308	1995	1789	2255	1697</span><br><span class="line">Chr01.g00023	8	1	3	8	14	3	6	3	6	0	7	1</span><br><span class="line">Chr01.g00024	39	25	69	127	103	8	43	170	167	89	89	67</span><br><span class="line">Chr01.g00025	0	0	0	0	0	0	0	0	0	0	0	0</span><br><span class="line">Chr01.g00026	0	1	0	6	2	1	17	30	8	2	5	94</span><br><span class="line">Chr01.g00027	748	794	808	370	640	805	886	1169	786	677	864	817</span><br><span class="line">... ... (其余省略)</span><br></pre></td></tr></table></figure>
<p>（2）样品分组文件 (样品，时间点，分组三列)</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">sampleid	timepoint	group</span><br><span class="line">L1-1A	0h	1</span><br><span class="line">L1-2A	0h	1</span><br><span class="line">L1-3A	0h	1</span><br><span class="line">L2-1A	2h	2</span><br><span class="line">L2-2A	2h	2</span><br><span class="line">L2-3A	2h	2</span><br><span class="line">L3-2A	24h	3</span><br><span class="line">L3-3A	24h	3</span><br><span class="line">L4-1A	48h	4</span><br><span class="line">L4-2A	48h	4</span><br><span class="line">L4-3A	48h	4</span><br></pre></td></tr></table></figure>
<p>（3）基因坐标文件 (染色体，起始及终止位点，基因id四列)</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">chr	start	end	id</span><br><span class="line">scaffold_1	760	5575	scaffold_1.g00001</span><br><span class="line">scaffold_1	81403	85562	scaffold_1.g00002</span><br><span class="line">scaffold_1	122872	124937	scaffold_1.g00003</span><br><span class="line">scaffold_1	138239	140514	scaffold_1.g00004</span><br><span class="line">scaffold_1	156823	159196	scaffold_1.g00005</span><br><span class="line">scaffold_1	160925	162845	scaffold_1.g00006</span><br><span class="line">scaffold_1	195980	199165	scaffold_1.g00007</span><br><span class="line">scaffold_1	199535	200289	scaffold_1.g00008</span><br></pre></td></tr></table></figure>
<h3 id="读取输入基因表达量与分组数据"><a class="markdownIt-Anchor" href="#读取输入基因表达量与分组数据"></a> 读取输入基因表达量与分组数据</h3>
<p>准备好上述三个文件，就可以在 Rstudio 界面开始加载 TCseq 包，读取上述三个数据文件，开始分析。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">setwd(&quot;C:/R-data&quot;)</span><br><span class="line"></span><br><span class="line">#To install this package, start R (version &quot;4.1&quot;) and enter:</span><br><span class="line">  </span><br><span class="line"> if (!requireNamespace(&quot;BiocManager&quot;, quietly = TRUE))</span><br><span class="line">    install.packages(&quot;BiocManager&quot;)</span><br><span class="line"></span><br><span class="line">BiocManager::install(&quot;TCseq&quot;)</span><br><span class="line">library(TCseq)</span><br><span class="line"></span><br><span class="line">BiocManager::install(&quot;topGO&quot;)   ## 画GO树状图需要用</span><br><span class="line">library(topGO)</span><br><span class="line"></span><br><span class="line">library(dplyr)</span><br><span class="line"></span><br><span class="line"># To view documentation for the version of this package installed in your system, start R and enter:</span><br><span class="line">browseVignettes(&quot;TCseq&quot;)</span><br><span class="line"></span><br><span class="line">rm(list = ls())  # 清除 Rstudio 里面旧的变量</span><br><span class="line">ls()</span><br><span class="line"># 位置信息文件</span><br><span class="line">genomicIntervals &lt;- read.delim(&#x27;AMO.intervial.txt&#x27;, stringsAsFactors = FALSE)</span><br><span class="line">genomicIntervals$chr &lt;- as.factor(genomicIntervals$chr)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">## 表达量矩阵文件</span><br><span class="line">#count &lt;- read.delim(&#x27;all_read_count.txt&#x27;,header = T,row.names = 1) ### read count table</span><br><span class="line"></span><br><span class="line">count &lt;- read.delim(&#x27;all_read_count.txt&#x27;,header = T,row.names = 1) ### read count table</span><br><span class="line">count &lt;- count[,-7]   ### L3-1A 样品数据有问题，剔除  # Optional</span><br><span class="line"></span><br><span class="line"># as.integer 转换为整数型</span><br><span class="line">countsTable &lt;- count %&gt;%  mutate(across(where(is.numeric), as.integer))   # 依赖 dplyr 包</span><br><span class="line"># or</span><br><span class="line">#count1 &lt;- apply(count, 2, as.integer)</span><br><span class="line">rownames(countsTable) &lt;- rownames(count)</span><br><span class="line">##矩阵形式</span><br><span class="line">countsTable &lt;- as.matrix(countsTable)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 分组文件</span><br><span class="line">experiment &lt;- read.delim(&#x27;leaf_group.txt&#x27;,header = T,stringsAsFactors = FALSE)</span><br><span class="line">experiment$sampleid &lt;- as.factor(experiment$sampleid)</span><br></pre></td></tr></table></figure>
<h3 id="创建tca对象"><a class="markdownIt-Anchor" href="#创建tca对象"></a> 创建TCA对象</h3>
<p>TCseq 使用 S4 类 TCA 存储所有输入数据以进行后续分析。根据以上三个文件创造即可。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tca &lt;- TCA(design = experiment, genomicFeature = genomicIntervals, counts = countsTable)</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">tca  # 此次摘抄自 凯凯何_Boy 链接：https://www.jianshu.com/p/26332e4da742</span><br><span class="line">  ##############</span><br><span class="line">  An object of class &quot;TCA&quot;</span><br><span class="line">@design</span><br><span class="line">  sampleid timepoint group</span><br><span class="line">1       s1        0h     1</span><br><span class="line">2       s2        0h     1</span><br><span class="line">3       s3        0h     1</span><br><span class="line">4       s4       24h     2</span><br><span class="line">5       s5       24h     2</span><br><span class="line">6       s6       24h     2</span><br><span class="line">7       s7       48h     3</span><br><span class="line">8       s8       48h     3</span><br><span class="line">9       s9       48h     3</span><br><span class="line"></span><br><span class="line">@counts</span><br><span class="line">                    s1  s2  s3  s4  s5  s6  s7  s8  s9</span><br><span class="line">ENSBTAG00000000005  60  58  70  64  60  74  53  55  50</span><br><span class="line">ENSBTAG00000000008   0   0   0   1   0   1   2   0   0</span><br><span class="line">ENSBTAG00000000009   0   1   3   0   1   0  11   9   9</span><br><span class="line">ENSBTAG00000000010 341 300 341 170 216 214 150 236 199</span><br><span class="line">ENSBTAG00000000011   4   2   3   5   3   1   6   2   3</span><br><span class="line">29749 more rows ...</span><br><span class="line"></span><br><span class="line">@genomicFeature</span><br><span class="line">   chr     start       end                 id</span><br><span class="line">1 chr1 100098899 100161382 ENSBTAG00000035710</span><br><span class="line">2 chr1 100754351 100754458 ENSBTAG00000043293</span><br><span class="line">3 chr1 101522743 101601659 ENSBTAG00000011139</span><br><span class="line">4 chr1 101619573 101646742 ENSBTAG00000053582</span><br><span class="line">5 chr1 101776678 101776956          MSTRG.445</span><br><span class="line">29749 more rows ...</span><br><span class="line"></span><br><span class="line">@clusterRes</span><br><span class="line">An object of class &quot;clust&quot;</span><br><span class="line">另一种创建的方式,是通过SummarizedExperiment对象：</span><br><span class="line"></span><br><span class="line">suppressWarnings(library(SummarizedExperiment))</span><br><span class="line">se &lt;- SummarizedExperiment(assays=list(counts = countsTable), colData = experiment)</span><br><span class="line">tca &lt;- TCAFromSummarizedExperiment(se = se, genomicFeature = genomicIntervals)</span><br></pre></td></tr></table></figure>
<p>现在已经基于这三个文件得到了TCA对象</p>
<h3 id="差异分析"><a class="markdownIt-Anchor" href="#差异分析"></a> 差异分析</h3>
<p>该包内置了我们常用的差异分析 R 包 edgeR，通过使用广义线性模型 (GLM) 方法去鉴定差异基因。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">tca &lt;- DBanalysis(tca）</span><br><span class="line">## 我们也可以增添一些参数进行过滤</span><br><span class="line">tca &lt;- DBanalysis(tca, filter.type = &quot;raw&quot;, filter.value = 10, samplePassfilter = 2)</span><br><span class="line">#比如上述步骤保留具有两个或多个已读取样本的基因表达量超过10的基因组区域</span><br><span class="line"></span><br><span class="line">tca &lt;- DBanalysis(tca, filter.type = &quot;raw&quot;, filter.value = 10, samplePassfilter = 2)  # 与上面的选一个即可，这个命令是加了筛选参数的。</span><br><span class="line">#比如上述步骤保留具有两个或多个已读取样本的基因表达量超过10的基因组区域</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h3 id="提取差异分析结果"><a class="markdownIt-Anchor" href="#提取差异分析结果"></a> 提取差异分析结果</h3>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">#####################</span><br><span class="line">####提取差异分析结果</span><br><span class="line">#####################</span><br><span class="line"># 通过DBresult函数可以直接提取我们差异分析的结果，并通过$去查看各个组的内容。</span><br><span class="line">DBres &lt;- DBresult(tca, group1 = &quot;0h&quot;, group2 = c(&quot;2h&quot;,&quot;24h&quot;,&quot;48h&quot;))</span><br><span class="line">str(DBres, strict.width =  &quot;cut&quot;)</span><br><span class="line">head(DBres$`24hvs0h`)</span><br><span class="line"># 若只想提取满足显著差异的结果(一般abs(log2-fold &gt; 2)且adjust p-value&lt;0.05)，只需要加上top.sig = TRUE函数即可。</span><br><span class="line">## 显著差异</span><br><span class="line">DBres.sig &lt;- DBresult(tca, group1 = &quot;0h&quot;, group2 = c(&quot;2h&quot;,&quot;24h&quot;,&quot;48h&quot;), top.sig = TRUE)</span><br><span class="line">str(DBres.sig, strict.width =  &quot;cut&quot;)</span><br><span class="line">#############</span><br></pre></td></tr></table></figure>
<p>下面是摘抄他人的案例：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">通过DBresult函数可以直接提取我们差异分析的结果，在通过$去查看各个组的内容。</span><br><span class="line"></span><br><span class="line">DBres &lt;- DBresult(tca, group1 = &quot;0h&quot;, group2 = c(&quot;24h&quot;,&quot;48h&quot;))</span><br><span class="line">str(DBres, strict.width =  &quot;cut&quot;)</span><br><span class="line">head(DBres$`24hvs0h`)</span><br><span class="line">############</span><br><span class="line">GRanges object with 6 ranges and 4 metadata columns:</span><br><span class="line">                     seqnames              ranges strand |     logFC      PValue         paj</span><br><span class="line">                        &lt;Rle&gt;           &lt;IRanges&gt;  &lt;Rle&gt; | &lt;numeric&gt;   &lt;numeric&gt;   &lt;numeric&gt;</span><br><span class="line">  ENSBTAG00000000005     chr1 100098899-100161382      * |  0.274010 1.35162e-01 2.81082e-01</span><br><span class="line">  ENSBTAG00000000009     chr1 101522743-101601659      * | -1.501457 2.26674e-01 4.03419e-01</span><br><span class="line">  ENSBTAG00000000010     chr1 101776678-101776956      * | -0.513593 3.36326e-06 3.80124e-05</span><br><span class="line">  ENSBTAG00000000011     chr1   10231295-10543983      * |  0.198446 7.93039e-01 8.90540e-01</span><br><span class="line">  ENSBTAG00000000012     chr1 102768932-102769966      * | -0.300941 5.04886e-03 2.18330e-02</span><br><span class="line">  ENSBTAG00000000013     chr1 105069395-105069910      * |  0.140489 1.63446e-01 3.21469e-01</span><br><span class="line">                                     id</span><br><span class="line">                            &lt;character&gt;</span><br><span class="line">  ENSBTAG00000000005 ENSBTAG00000035710</span><br><span class="line">  ENSBTAG00000000009 ENSBTAG00000011139</span><br><span class="line">  ENSBTAG00000000010          MSTRG.445</span><br><span class="line">  ENSBTAG00000000011 ENSBTAG00000017753</span><br><span class="line">  ENSBTAG00000000012 ENSBTAG00000048551</span><br><span class="line">  ENSBTAG00000000013          MSTRG.449</span><br><span class="line">  -------</span><br><span class="line">  seqinfo: 206 sequences from an unspecified genome; no seqlengths</span><br><span class="line"></span><br><span class="line"># 作者：凯凯何_Boy https://www.jianshu.com/p/26332e4da742</span><br></pre></td></tr></table></figure>
<h3 id="时间趋势分析"><a class="markdownIt-Anchor" href="#时间趋势分析"></a> 时间趋势分析</h3>
<p>接下来就到了趋势分析的换件了，为了检测数据的时序模式，TCseq包使用了非监督聚类的方法,首先通过聚类创建一个时程表，行为基因组区域信息，列为时间点，表中的数值可以选择标准化后的表达量值或者是基于初始时间点所有样品点的LogFC值，代码中通过value参数来调整，另外若设置filter = TRUE时候，将自动过滤在任何两个时间段都没有显著差异的基因组区域，结果通过tcTable函数进行查看</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">##通过标准化后的表达量来做聚类</span><br><span class="line"># tca &lt;- timecourseTable(tca, value = &quot;expression&quot;, norm.method = &quot;rpkm&quot;, filter = TRUE)  # Aug 9 用的这个</span><br><span class="line">tca &lt;- timecourseTable(tca, value = &quot;expression&quot;, lib.norm = TRUE, norm.method = &quot;rpkm&quot;, filter = TRUE, pvalue.threshold =  0.1, abs.fold = 1.5)</span><br><span class="line">#tca &lt;- timecourseTable(tca, value = &quot;expression&quot;, norm.method = &quot;rpkm&quot;, filter = FALSE)</span><br><span class="line"></span><br><span class="line">## 通过LogFC值来做聚类</span><br><span class="line">#tca &lt;- timecourseTable(tca, value = &quot;FC&quot;, norm.method = &quot;rpkm&quot;, filter = TRUE)</span><br><span class="line"></span><br><span class="line">## 查看生成结果</span><br><span class="line">t &lt;- tcTable(tca)</span><br><span class="line">head(t)</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">## 通过LogFC值</span><br><span class="line">tca &lt;- timecourseTable(tca, value = &quot;FC&quot;, norm.method = &quot;rpkm&quot;, filter = TRUE)</span><br><span class="line"></span><br><span class="line">##通过标准化后的表达量</span><br><span class="line">tca &lt;- timecourseTable(tca, value = &quot;expression&quot;, norm.method = &quot;rpkm&quot;, filter = TRUE)</span><br><span class="line"></span><br><span class="line">## 查看生成结果</span><br><span class="line">t &lt;- tcTable(tca)</span><br><span class="line">head(t)</span><br><span class="line">                             0h          24h          48h</span><br><span class="line">ENSBTAG00000000425 0.0000000000  0.030165698 0.0075187827</span><br><span class="line">ENSBTAG00000000706 2.6013480888 11.521986790 1.7768887654</span><br><span class="line">ENSBTAG00000000936 0.0007283438  0.003506178 0.0003475789</span><br><span class="line">ENSBTAG00000001325 0.0002585125  0.001290036 0.0001705818</span><br><span class="line">ENSBTAG00000001687 0.3065966903  2.485377556 2.6233245852</span><br><span class="line">ENSBTAG00000001745 0.2496824763  2.120932031 4.7101417152</span><br></pre></td></tr></table></figure>
<h3 id="聚类分析"><a class="markdownIt-Anchor" href="#聚类分析"></a> 聚类分析</h3>
<p>两种聚类算法可供选择: hard clustering（包含hierachical,pam,kmeans） 及 soft clustering (fuzzy cmeans)，算法的选择大家自己参考文献选择，这里就拿文档中cmeans算法进行分析聚类。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">tca &lt;- timeclust(tca, algo = &quot;cm&quot;, k = 6, standardize = TRUE)</span><br><span class="line"></span><br><span class="line">###################################################</span><br><span class="line">p &lt;- timeclustplot(tca, value = &quot;z-score(RPKM)&quot;, cols = 3)</span><br></pre></td></tr></table></figure>
<p><img src="https://i.imgur.com/PVjl6Hy.jpeg" alt="" /></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"># 若是想查看某个聚类有哪些基因参与，使用tca@clusterRes查看聚类结果即可</span><br><span class="line"></span><br><span class="line">a &lt;- as.data.frame(tca@clusterRes@cluster)</span><br><span class="line">names(a) &lt;- &#x27;Cluster&#x27;</span><br><span class="line">## 查看各个聚类中的基因数目</span><br><span class="line">table(a)</span><br><span class="line">dim(a)</span><br><span class="line">table(a)</span><br><span class="line"></span><br><span class="line">#&gt; table(a)</span><br><span class="line">#### 过滤标准： tca &lt;- DBanalysis(tca, filter.type = &quot;raw&quot;, filter.value = 10, samplePassfilter = 2)</span><br><span class="line"># 1    2    3    4    5    6 </span><br><span class="line"># 1751  380 1122  599  905  554   # Aug 11 基于read count。过滤了一部分数据：</span><br><span class="line"></span><br><span class="line">#--- 过往记录：</span><br><span class="line"># 1    2    3    4    5    6 </span><br><span class="line"># 418 1397  993  602 1033 1042    ### Aug 10 </span><br><span class="line"># table(a)</span><br><span class="line"># filter.value = 1, samplePassfilter = 2) # Aug 9 用的这个 筛选条件之后，基因数目少了很多</span><br><span class="line">#1   2   3   4   5   6 </span><br><span class="line">#736 222 569 810 812 452 </span><br><span class="line"># 干旱处理 叶片的基因分组情况。没有设置筛选的情况下，基因数目多很多，但是手动查询发现有的基因并不明显</span><br><span class="line">#1    2    3    4    5    6 </span><br><span class="line">#3431 2156 3690 5167 2368 3566 </span><br><span class="line">##1   2   3   4   5   6 </span><br><span class="line">##511 147 165 292 180 255 </span><br><span class="line">##筛选 。可以分别导出每个cluster的基因列表 </span><br><span class="line"></span><br><span class="line">Cluster1 &lt;- subset(a,Cluster == 1)</span><br><span class="line">Cluster2 &lt;- subset(a,Cluster == 2)</span><br><span class="line">Cluster3 &lt;- subset(a,Cluster == 3)</span><br><span class="line">Cluster4 &lt;- subset(a,Cluster == 4)</span><br><span class="line">Cluster5 &lt;- subset(a,Cluster == 5)</span><br><span class="line">Cluster6 &lt;- subset(a,Cluster == 6)</span><br><span class="line">#Cluster7 &lt;- subset(a,Cluster == 7)</span><br><span class="line"></span><br><span class="line">write.csv(as.data.frame( tca@clusterRes@cluster ), file=&quot;6_clusters.csv&quot;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#上面分6次执行提取cluster命令比较繁琐，另一个方法是批量导出每个聚类所包含的基因，上面这种重复写6次的命令太繁复，尝试用for循环来解决</span><br><span class="line">dir.create(path=&quot;tcseq_cluster&quot;,recursive = TRUE)  # 在工作目录下新建一个文件夹</span><br><span class="line">for(i in 1:6)&#123;</span><br><span class="line">  assign(paste(&quot;Cluster&quot;,i,sep=&quot;&quot;),subset(a,Cluster == i)) # Cluster2 &lt;- subset(a,Cluster == 2)</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h3 id="对个别-cluster-进行功能富集分析"><a class="markdownIt-Anchor" href="#对个别-cluster-进行功能富集分析"></a> 对个别 Cluster 进行功能富集分析</h3>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">library(clusterProfiler)</span><br><span class="line">library(org.XXXX.eg.db)</span><br><span class="line">library(stringr)</span><br><span class="line">library(topGO)</span><br><span class="line">org &lt;- org.XXXX.eg.db</span><br><span class="line"></span><br><span class="line">geneList=rownames(Cluster1)  # Cluster 1</span><br><span class="line">bp1 &lt;-enrichGO(gene = geneList, OrgDb = org, keyType = &quot;GID&quot;, ont = &quot;BP&quot;)</span><br><span class="line">pdf(&quot;TCseq_Cluster1_GO_BP.pdf&quot;)</span><br><span class="line">barplot(bp1, drop=TRUE, showCategory=30)</span><br><span class="line">dev.off()</span><br><span class="line">write.csv(as.data.frame( bp1@result ), file=&quot;TCseq_Cluster1_GO_BP.csv&quot;)</span><br><span class="line"></span><br><span class="line">geneList=rownames(Cluster2)  # Cluster 2</span><br><span class="line">bp2 &lt;-enrichGO(gene = geneList, OrgDb = org, keyType = &quot;GID&quot;, ont = &quot;BP&quot;)</span><br><span class="line">pdf(&quot;TCseq_Cluster2_GO_BP.pdf&quot;)</span><br><span class="line">barplot(bp2, drop=TRUE, showCategory=30)</span><br><span class="line">dev.off()</span><br><span class="line">write.csv(as.data.frame( bp2@result ), file=&quot;TCseq_Cluster2_GO_BP.csv&quot;)</span><br><span class="line">#----- 上面采用默认参数，得到的GO条目太少，于是放松筛选标准，画的图更好看</span><br><span class="line">bp2 &lt;-enrichGO(gene = geneList, OrgDb = org, keyType = &quot;GID&quot;, ont = &quot;BP&quot;, pvalueCutoff = 0.5, qvalueCutoff = 0.9)</span><br><span class="line">pdf(&quot;TCseq_Cluster2_GO_BP_low_standard.pdf&quot;)</span><br><span class="line">barplot(bp2, drop=TRUE, showCategory=30)</span><br><span class="line">dev.off()</span><br><span class="line">#------</span><br></pre></td></tr></table></figure>
<p><img src="https://i.imgur.com/CUmLAMP.jpeg" alt="" /></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://example.com/2021/07/17/Bioinfo-LTR-identification-and-analysis/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/fl-photo-202109.jpg">
      <meta itemprop="name" content="FENG Lei">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="FENG's Notes">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/07/17/Bioinfo-LTR-identification-and-analysis/" class="post-title-link" itemprop="url">Bioinfo | LTR identification and analysis</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2021-07-17 02:22:18" itemprop="dateCreated datePublished" datetime="2021-07-17T02:22:18+08:00">2021-07-17</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2021-07-27 11:08:06" itemprop="dateModified" datetime="2021-07-27T11:08:06+08:00">2021-07-27</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Bioinformatics/" itemprop="url" rel="index"><span itemprop="name">Bioinformatics</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>在植物基因组中，I 类转座因子，LTR-RT（LTR retrotransposons）是基因组扩张的主要原因。完整的LTR长度在 85 – 5000 bp 之间，下图表示的是一个完整的 LTR-RT，灰色框表示 TSD（target site duplications）, 红色三角形表示 LTR motif（长度在 2 bp 左右），蓝色框表示 LTR。LTR 中间序列长度在 1,000 – 15,000 之间波动。</p>
<p>完整的LTR-RT主要归为两大类: Gypsy 和 Copia。如果 LTR 中间的序列不包含开放阅读框（ORF）, 那么所属的 LTR-RT 就无法独立的转座。</p>
<p><img src="https://i.imgur.com/pDbuH66.jpeg" alt="" /></p>
<h3 id="安装"><a class="markdownIt-Anchor" href="#安装"></a> 安装</h3>
<p>LTR_retriever 不是一个独立的工具，他的主要作用就是整合 LTRharvest, LTR_FINDER, MGEScan 3.0.0, LTR_STRUC, 和 LtrDetector 的结果，过滤其中的假阳性 LTR-RT，得到高质量的LTR-RT库。</p>
<p>先下载 LTR_retriever：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git clone https://github.com/oushujun/LTR_retriever.git</span><br></pre></td></tr></table></figure>
<p>之后修改 LTR_retriever 下的 paths, 提供 BLAST+, RepeatMasker， HMMER， CDHIT 这些工具的路径。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">BLAST+=/your_path_to/BLAST+2.2.30/bin/</span><br><span class="line">RepeatMasker=/your_path_to/RepeatMasker4.0.0/</span><br><span class="line">HMMER=/your_path_to/HMMER3.1b2/bin/</span><br><span class="line">CDHIT=/your_path_to/CDHIT4.6.1/</span><br><span class="line">BLAST=/your_path_to/BLAST2.2.26/bin/ #not required if CDHIT provided</span><br></pre></td></tr></table></figure>
<p>下面是我实际操作中填写的案例。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"> 1 ##This file will provide LTR_retriever paths to dependent programs.</span><br><span class="line"> 2 ##You can leave the respective paths empty if programs are accessible through ENV (i.e. exported to .bashrc)</span><br><span class="line"> 3 ##If you specify a path, please make sure that the required program(s) is directly contained in that path but not in any child directories.</span><br><span class="line"> 4 ##e.g. BLAST+=/opt/software/BLAST+/2.2.30--GCC-4.4.5/bin/</span><br><span class="line"> 5 ##LTR_retriever is build based on GenomeTools/1.5.4, BLAST+/2.2.28, BLAST/2.2.26, CDHIT/4.6.1c, HMMER/3.1b2, RepeatMasker/4.0.0 and Tandem Repeats Finder 4.07b</span><br><span class="line"> 6 </span><br><span class="line"> 7 BLAST+=/home/fenglei/local/app/blast-2.11.0/bin     #a path that contains makeblastdb, blastn, blastx</span><br><span class="line"> 8 RepeatMasker=/home/fenglei/local/app/RepeatMasker   #a path that contains RepeatMasker</span><br><span class="line"> 9 HMMER=/home/fenglei/local/bin       #a path that contains hmmsearch</span><br><span class="line">10 CDHIT=/home/fenglei/local/app/cdhit     #a path that contains cd-hit-est (preferred). CDHIT and BLAST are replaceable</span><br><span class="line">11 BLAST=      #a path that contains blastclust (optional)</span><br></pre></td></tr></table></figure>
<p>更加方便的安装方法用 Bioconda 安装好 cd-hit repeatmasker， 然后下载 LTR_retriever:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">conda create -n LTR_retriever</span><br><span class="line">source activate LTR_retriever</span><br><span class="line">conda install -c conda-forge perl perl-text-soundex</span><br><span class="line">conda install -c bioconda cd-hit</span><br><span class="line">conda install -c bioconda/label/cf201901 repeatmasker</span><br><span class="line"></span><br><span class="line">git clone https://github.com/oushujun/LTR_retriever.git</span><br><span class="line">./LTR_retriever/LTR_retriever -h</span><br></pre></td></tr></table></figure>
<p>此外还需要额外安装 LTRharvest, LTR_FINDER 和 MGEScan_LTR。</p>
<p>LTRharverst: <a target="_blank" rel="noopener" href="http://genometools.org/">http://genometools.org/</a><br />
LTR_FINDER: <a target="_blank" rel="noopener" href="https://github.com/xzhub/LTR_Finder">https://github.com/xzhub/LTR_Finder</a><br />
LTR_FINDER_parallel: <a target="_blank" rel="noopener" href="https://github.com/oushujun/LTR_FINDER_parallel">https://github.com/oushujun/LTR_FINDER_parallel</a><br />
修改版MGEScan_LTR: <a target="_blank" rel="noopener" href="http://dawgpaws.sourceforge.net">http://dawgpaws.sourceforge.net</a></p>
<p>由于MGEScan_LTR装起来比我想象中麻烦，所以本文就仅使用LTRharverst和LTR_FINDER</p>
<h3 id="使用篇"><a class="markdownIt-Anchor" href="#使用篇"></a> 使用篇</h3>
<p>尽管 LTR_retriever 支持多个 LTR 工具的输入，但其实上 LTRharverst 和 LTR_FINDER 的结果就已经很不错了。</p>
<p>以拟南芥的基因组序列为例，分别使用 LTRharverst 和 LTR_FINDER 来寻找拟南芥中潜在 LTR 序列，之后用 LTR_retreiver 来合并结果。<br />
注意，也可以用 LTR-finder-parallel，应该会更快。</p>
<p>注意：LTRharvest 输出的结果中会将染色体名称成数字编号，可能会对后续分析造成问题。Unfortunately, LTRharvest has an annoying habit of not using the scaffold/chromosome names you give it (it outputs scaffolds as “seqX” where X is the 0-base number of your scaffold), so I remove all scaffolds in my fasta file, remove newline (“\n”) characters, and add a single scaffold name so that getting the fasta sequence for regions in the output gff3 is painless. 有人的解决方案是将自己的基因组手动拼成一条序列，因为只需要找LTR序列而已。 This is useful if you just want the distribution of insertion times of your LTRs, but if you need location information you’ll either have to rerun LTRharvest with the regular fasta, or use the length of each scaffold to figure out the real scaffold from your concatenated fasta.</p>
<p>20210719 备注：经过测试，LTRharvest输出的scn文件虽然有上面提到的问题，但是对后续导入LTR-retriever的整合分析不会造成影响。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"># LTRharvest</span><br><span class="line">gt suffixerator \</span><br><span class="line">  -db TAIR10.fa \</span><br><span class="line">  -indexname TAIR10 \</span><br><span class="line">  -tis -suf -lcp -des -ssp -sds -dna</span><br><span class="line">gt ltrharvest \</span><br><span class="line">  -index TAIR10 \</span><br><span class="line">  -similar 90 -vic 10 -seed 20 -seqids yes \</span><br><span class="line">  -minlenltr 100 -maxlenltr 7000 -mintsd 4 -maxtsd 6 \</span><br><span class="line">  -motif TGCA -motifmis 1  &gt; TAIR10.harvest.scn &amp;</span><br><span class="line"></span><br><span class="line"># LTR_FINDER</span><br><span class="line"># ltr_finder -D 15000 -d 1000 -L 7000 -l 100 -p 20 -C -M 0.9 TAIR10.fa &gt; TAIR10.finder.scn &amp;</span><br><span class="line">~/local/app/LTR_FINDER_parallel/LTR_FINDER_parallel -seq genome.fasta -threads 10 -harvest_out -size 1000000 -time 300</span><br></pre></td></tr></table></figure>
<p>LTR_retriever支持单个候选的LTR：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">LTR_retriever -genome TAIR10.fa -inharvest TAIR10.harvest.scn</span><br></pre></td></tr></table></figure>
<p>也支持多个候选LTR输入：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">LTR_retriever -genome TAIR10.fa -inharvest TAIR10.harvest.scn -infinder TAIR10.finder.scn -threads 20</span><br></pre></td></tr></table></figure>
<p>输出文件如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br></pre></td><td class="code"><pre><span class="line">(base) [fenglei@localhost 20210719_LTR_retriever_test]$ LTR_retriever -genome genome.fasta -inharvest genome.fasta.rawLTR.scn -threads 10</span><br><span class="line"></span><br><span class="line">##########################</span><br><span class="line">### LTR_retriever v2.9.0 ###</span><br><span class="line">##########################</span><br><span class="line"></span><br><span class="line">Contributors: Shujun Ou, Ning Jiang</span><br><span class="line"></span><br><span class="line">For LTR_retriever, please cite:</span><br><span class="line"></span><br><span class="line">        Ou S and Jiang N (2018). LTR_retriever: A Highly Accurate and Sensitive Program for Identification of Long Terminal Repeat Retrotransposons. Plant Physiol. 176(2): 1410-1422.</span><br><span class="line"></span><br><span class="line">For LAI, please cite:</span><br><span class="line"></span><br><span class="line">        Ou S, Chen J, Jiang N (2018). Assessing genome assembly quality using the LTR Assembly Index (LAI). Nucleic Acids Res. 2018;46(21):e126.</span><br><span class="line"></span><br><span class="line">Parameters: -genome genome.fasta -inharvest genome.fasta.rawLTR.scn -threads 10</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Mon Jul 19 09:09:05 CST 2021    Dependency checking: All passed!</span><br><span class="line">Mon Jul 19 09:09:24 CST 2021    LTR_retriever is starting from the Init step.</span><br><span class="line">Mon Jul 19 09:09:26 CST 2021    Start to convert inputs...</span><br><span class="line">                                Total candidates: 1110</span><br><span class="line">                                Total uniq candidates: 1045</span><br><span class="line"></span><br><span class="line">Mon Jul 19 09:09:28 CST 2021    Module 1: Start to clean up candidates...</span><br><span class="line">                                Sequences with 10 missing bp or 0.8 missing data rate will be discarded.</span><br><span class="line">                                Sequences containing tandem repeats will be discarded.</span><br><span class="line"></span><br><span class="line">Mon Jul 19 09:09:48 CST 2021    950 clean candidates remained</span><br><span class="line"></span><br><span class="line">Mon Jul 19 09:09:48 CST 2021    Modules 2-5: Start to analyze the structure of candidates...</span><br><span class="line">                                The terminal motif, TSD, boundary, orientation, age, and superfamily will be identified in this step.</span><br><span class="line"></span><br><span class="line">Mon Jul 19 09:16:20 CST 2021    Intact LTR-RT found: 230</span><br><span class="line"></span><br><span class="line">Mon Jul 19 09:16:24 CST 2021    Module 6: Start to analyze truncated LTR-RTs...</span><br><span class="line">                                Truncated LTR-RTs without the intact version will be retained in the LTR-RT library.</span><br><span class="line">                                Use -notrunc if you don&#x27;t want to keep them.</span><br><span class="line"></span><br><span class="line">Mon Jul 19 09:16:24 CST 2021    66 truncated LTR-RTs found</span><br><span class="line">Mon Jul 19 09:16:41 CST 2021    29 truncated LTR sequences have added to the library</span><br><span class="line"></span><br><span class="line">Mon Jul 19 09:16:41 CST 2021    Module 5: Start to remove DNA TE and LINE transposases, and remove plant protein sequences...</span><br><span class="line">                                Total library sequences: 355</span><br><span class="line">Mon Jul 19 09:18:52 CST 2021    Retained clean sequence: 348</span><br><span class="line"></span><br><span class="line">Mon Jul 19 09:18:52 CST 2021    Sequence clustering for genome.fasta.ltrTE ...</span><br><span class="line">Mon Jul 19 09:18:52 CST 2021    Unique lib sequence: 347</span><br><span class="line"></span><br><span class="line">Mon Jul 19 09:18:55 CST 2021    Module 6: Start to remove nested insertions in internal regions...</span><br><span class="line">Mon Jul 19 09:27:23 CST 2021    Raw internal region size (bit): 961029</span><br><span class="line">                                Clean internal region size (bit): 912840</span><br><span class="line"></span><br><span class="line">Mon Jul 19 09:27:24 CST 2021    Sequence number of the redundant LTR-RT library: 659</span><br><span class="line">                                The redundant LTR-RT library size (bit): 1422033</span><br><span class="line"></span><br><span class="line">Mon Jul 19 09:27:24 CST 2021    Module 8: Start to make non-redundant library...</span><br><span class="line"></span><br><span class="line">Mon Jul 19 09:27:27 CST 2021    Final LTR-RT library entries: 342</span><br><span class="line">                                Final LTR-RT library size (bit): 1025212</span><br><span class="line"></span><br><span class="line">Mon Jul 19 09:27:27 CST 2021    Total intact LTR-RTs found: 206</span><br><span class="line">                                Total intact non-TGCA LTR-RTs found: 43</span><br><span class="line"></span><br><span class="line">Mon Jul 19 09:27:28 CST 2021    Start to annotate whole-genome LTR-RTs...</span><br><span class="line">                                Use -noanno if you don&#x27;t want whole-genome LTR-RT annotation.</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">######################################</span><br><span class="line">### LTR Assembly Index (LAI) beta3.2 ###</span><br><span class="line">######################################</span><br><span class="line"></span><br><span class="line">Developer: Shujun Ou</span><br><span class="line"></span><br><span class="line">Please cite:</span><br><span class="line"></span><br><span class="line">Ou S., Chen J. and Jiang N. (2018). Assessing genome assembly quality using the LTR Assembly Index (LAI). Nucleic Acids Res. gky730: https://doi.org/10.1093/nar/gky730</span><br><span class="line"></span><br><span class="line">Parameters: -genome genome.fasta -intact genome.fasta.pass.list -all genome.fasta.out -t 10 -q -blast /home/fenglei/local/app/blast-2.11.0/bin/</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Mon Jul 19 09:32:57 CST 2021    Dependency checking: Passed!</span><br><span class="line">Mon Jul 19 09:32:57 CST 2021    Calculation of LAI will be based on the whole genome.</span><br><span class="line">                                Please use the -mono parameter if your genome is a recent ployploid, for high identity between homeologues will overcorrect raw LAI scores.</span><br><span class="line">Mon Jul 19 09:32:57 CST 2021    Estimate the identity of LTR sequences in the genome: quick mode</span><br><span class="line">Mon Jul 19 09:33:08 CST 2021    The identity of LTR sequences: 93.5158904793606%</span><br><span class="line">Mon Jul 19 09:33:08 CST 2021    Calculate LAI:</span><br><span class="line"></span><br><span class="line">                                                Done!</span><br><span class="line"></span><br><span class="line">Mon Jul 19 09:33:11 CST 2021    Result file: genome.fasta.out.LAI</span><br><span class="line"></span><br><span class="line">                                You may use either raw_LAI or LAI for intraspecific comparison</span><br><span class="line">                                but please use ONLY LAI for interspecific comparison</span><br><span class="line"></span><br><span class="line">Mon Jul 19 09:33:11 CST 2021    All analyses were finished!</span><br><span class="line"></span><br><span class="line">##############################</span><br><span class="line">####### Result files #########</span><br><span class="line">##############################</span><br><span class="line"></span><br><span class="line">Table output for intact LTR-RTs (detailed info)</span><br><span class="line">        genome.fasta.pass.list (All LTR-RTs)</span><br><span class="line">        genome.fasta.nmtf.pass.list (Non-TGCA LTR-RTs)</span><br><span class="line">        genome.fasta.pass.list.gff3 (GFF3 format for intact LTR-RTs)</span><br><span class="line"></span><br><span class="line">LTR-RT library</span><br><span class="line">        genome.fasta.LTRlib.redundant.fa (All LTR-RTs with redundancy)</span><br><span class="line">        genome.fasta.LTRlib.fa (All non-redundant LTR-RTs)</span><br><span class="line">        genome.fasta.nmtf.LTRlib.fa (Non-TGCA LTR-RTs)</span><br><span class="line"></span><br><span class="line">Whole-genome LTR-RT annotation by the non-redundant library</span><br><span class="line">        genome.fasta.LTR.gff3 (GFF3 format)</span><br><span class="line">        genome.fasta.out.fam.size.list (LTR family summary)</span><br><span class="line">        genome.fasta.out.superfam.size.list (LTR superfamily summary)</span><br><span class="line"></span><br><span class="line">LTR Assembly Index (LAI)</span><br><span class="line">        genome.fasta.out.LAI</span><br></pre></td></tr></table></figure>
<h3 id="ltr-rts-insertion-time"><a class="markdownIt-Anchor" href="#ltr-rts-insertion-time"></a> LTR-RTs insertion time</h3>
<p>根据LTR-RT的结构特点，即插入基因组新位置之后，反转录转座子的两端的LTR会独立进化，各自积累突变，计算出他们之间的遗传距离与进化时间，就可推断基因组里面大量LTR-RT出现的规律。“LTR-RTs are a case where we can exploit biology to provide insight into larger processes. LTR-RTs are a class of retrotransposon with long terminal repeats, which are identical upon insertion at the beginning and end of the TE’s sequence. Over time, mutations accumulate in these terminal repeats, roughly following a molecular clock. This allows us to more or less count the differences between the two LTRs of a LTR-RT, and calculate the time (in generations ago) it was inserted. If we do this for all LTR-RTs in a genome, we get a distribution of insertion times, and shifts in this distribution can tell us about the history of TE activity and/or selective pressures against TEs in our favourite species or between species.”</p>
<p>计算LTR插入时间可以参考：<a target="_blank" rel="noopener" href="https://github.com/SIWLab/Lab_Info/wiki/Ageing-LTR-insertions">https://github.com/SIWLab/Lab_Info/wiki/Ageing-LTR-insertions</a></p>
<p>按照上面的流程，运行LTRretriever之后得到一系列文件，其中genome.fasta.pass.list.gff3是最终的LTR列表，包含三种类型：Copia、Gypsy和unknown。一般文献会分别统计Copia、Gypsy和non-autonomous这三个类型的LTR。那么non-autonomous是否就是unknown呢？我将这个gff3文件导入IGV浏览器，发现unknown LTR的特点就是具有双端LTR结构，但是中间区域很短，意味着其很可能不具备gag和pol序列，无法独立执行这个转座子单元的反转录的过程。</p>
<p><img src="https://i.imgur.com/AAVN4k5.jpeg" alt="" /></p>
<p>下截图所示，是gff3的文件内容，每个LTR-RT一般有6行，第3和第5行就是两端的LTR区域，将这两行提取出来，存入一个文件。我写了一个Perl脚本，逐个LTR-RT分别存入新的文件，每个文件两行，比如LTR_1.gff3、LTR_2.gff3、LTR_3.gff3 …… 然后基于这些gff3文件，用bedtools分别提取fasta序列，再用muscle软件做序列比对（注意muscle软件只能按照两条序列自然的方向作比较，他不会考虑两条序列是否反向之后匹配更好，当然，LTR-RT的两端的LTR序列本来就是方向一致的，所以不用担心。），muscle输出对齐的fasta格式文件，然后运用程序计算双端LTR之间的距离K，再依据 T=K/(2r) 公式就能推测到插入时间。将“插入时间”数据统一存入一个文本，导入R，用ggplot2的geom_histogram功能就可以得到下面的图。</p>
<p>上面公式中r的意思是“synonymous nucleotide substitution rate”，“r is the average substitution rate, taken as the Ks value estimated above”，<a target="_blank" rel="noopener" href="https://www.ncbi.nlm.nih.gov/pmc/articles/PMC1456784/">https://www.ncbi.nlm.nih.gov/pmc/articles/PMC1456784/</a>，7e-9 substitutions/site/year, with standard deviation of 2.6e−9, was used as the rate of synonymous substitutions ®. 根据这篇文章，豆科的平均替换率是7e-9 substitutions/site/year，我在我研究的物种中也用这个数值。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">#########################################################################</span><br><span class="line"># File Name: ltr.sh</span><br><span class="line"># Author: fenglei</span><br><span class="line"># Mail: fengleiluck@gmail.com</span><br><span class="line"># Created Time: Wed 21 Jul 2021 01:57:33 PM CST</span><br><span class="line">#########################################################################</span><br><span class="line">#!/usr/bin/bash</span><br><span class="line">set -e</span><br><span class="line">set -u</span><br><span class="line">set -o pipefail</span><br><span class="line"></span><br><span class="line">for IN in `find ./loop/ -name &quot;LTR*.gff3&quot;`; do</span><br><span class="line">        echo [`date +&quot;%Y-%m-%d %H:%M:%S&quot;`] &quot;   * processing $IN&quot;</span><br><span class="line">        path=$&#123;IN%/*&#125;    #  ./loop/LTR_85.gff3 -&gt; ./loop</span><br><span class="line">        file=$&#123;IN##*/&#125;   #  ./loop/LTR_85.gff3 -&gt; LTR_85.gff3</span><br><span class="line">        name=$&#123;file%.*&#125;  #  LTR_85.gff3 -&gt; LTR_85</span><br><span class="line">        # cat genome.fasta.finder.combine.scn genome.fasta.harvest.scn_new &gt;genome.fasta.rawLTR.scn </span><br><span class="line">        # awk &#x27;NR == 9 || NR == 11&#x27; genome.fasta.pass.list.gff3 &gt; LTR_1.gff3</span><br><span class="line">        # bedtools getfasta -fi genome.fasta -bed LTR_1.gff3 &gt; $&#123;name&#125;.fasta </span><br><span class="line">        bedtools getfasta -fi genome.fasta -bed $IN &gt; ./loop/$&#123;name&#125;.fasta</span><br><span class="line">        ~/local/app/muscle3.8.31/muscle3.8.31_i86linux64 -in ./loop/$&#123;name&#125;.fasta -out ./loop/$&#123;name&#125;.afa</span><br><span class="line">        # cat LTR_1.pair_diff</span><br><span class="line">        python ../../20210720_LTR_evolution/LTR_pairwise_differences.py --input ./loop/$&#123;name&#125;.afa --output ./loop/$&#123;name&#125;.pair_diff</span><br><span class="line">done</span><br></pre></td></tr></table></figure>
<p><img src="https://i.imgur.com/Xkpiivl.jpeg" alt="" /></p>
<p>附画图R语言代码：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">library(ggplot2)</span><br><span class="line">setwd(&quot;C://R-data&quot;)</span><br><span class="line">ltr &lt;- read.table(&quot;Arabidopsis_LTR.txt&quot;, head=F)</span><br><span class="line">head(ltr)</span><br><span class="line">colnames(ltr) &lt;- c(&quot;locus&quot;, &quot;K&quot;, &quot;T&quot;)</span><br><span class="line">head(ltr$locus)</span><br><span class="line">ltr$newT &lt;- ltr$T/1000000</span><br><span class="line">head(ltr)</span><br><span class="line">ggplot() +</span><br><span class="line">  geom_histogram(data=ltr, aes(x=newT), fill=&quot;#0570c0&quot;, colour=&quot;black&quot;) +</span><br><span class="line">  theme_bw() +</span><br><span class="line">  theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(), axis.line = element_line(colour = &quot;black&quot;)) +</span><br><span class="line">  theme(axis.text.x = element_text(size = 15, color = &quot;black&quot;, vjust = 0.5 , hjust = 0.5, angle = 0)) +</span><br><span class="line">  theme(axis.text.y = element_text(color = &quot;black&quot;, size = 15)) +</span><br><span class="line">  ylab(&quot;Copy Number&quot;) +</span><br><span class="line">  xlab(&quot;Insertion time (Myr)&quot;) +</span><br><span class="line">  #ggtitle(&quot;4DTv density of paralogs gene pairs in legumes&quot;) +</span><br><span class="line">  theme(axis.title.y = element_text(size = 18, color = &quot;black&quot;)) +</span><br><span class="line">  theme(axis.title.x = element_text(size = 18, color = &quot;black&quot;))</span><br></pre></td></tr></table></figure>
<h3 id="ltr-rts-系统发生树"><a class="markdownIt-Anchor" href="#ltr-rts-系统发生树"></a> LTR-RTs 系统发生树</h3>
<ol>
<li>genome.fasta.pass.list.gff3 文件，用bedtools提取对应的LTR-RT的完整DNA序列。</li>
<li>一个LTR-RT中有多个蛋白质domain，如何提取这些domain？用TEsorter可以轻松实现，TEsorter用conda即可安装，我在python3.7环境下安装的。得到不同功能域（GAG、INT、RT、RH……）的氨基酸序列。<br />
（一开始不知道TEsorter存在，自己用blastx和hmmer尝试，效果都不理想）</li>
<li>通过cdhit软件进行序列聚类，将高度近似或相同的序列归类，大大减少下一步比对的序列数目。我从2800聚集成400多条序列。</li>
<li>序列比对。可以用mafft或muscle。我用这windows版本的MEGA软件，MEGA X 内置muscle，，运行数秒即可得到下图。</li>
</ol>
<p><img src="https://i.imgur.com/WMphP1J.jpeg" alt="" /></p>
<ol start="5">
<li>直接在MEGA软件里面选择系统进化分析，选择ML（Maximum Likelihood），其余参数默认，运行很快就得到下图。</li>
</ol>
<p><img src="https://i.imgur.com/ksgYYlM.jpeg" alt="" /></p>
<ol start="6">
<li>
<p>上面的树，导出为Newick格式（.nwk），然后可以用其他软件来美化这个进化树。注意导出的时候可以设定是否导出树枝长度，若不选，那么出来的树就是类似二叉树的形象，树枝都是一样的长度。</p>
</li>
<li>
<p>用Figtree软件打开这个树，可以美化。参考资料 <a target="_blank" rel="noopener" href="https://www.omicsclass.com/article/62">https://www.omicsclass.com/article/62</a>. 比如某个分支需要加颜色背景，就需要点击目录上方的“clade”按钮，接下来点击树枝，就能选中那个分支，再点击目录上方的“Hilight”按钮，就可以设置颜色背景，效果图像如下！</p>
</li>
</ol>
<p><img src="https://i.imgur.com/FNCS9nl.jpeg" alt="" /></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://example.com/2021/06/29/Bioinfo-Gene-Ontology-Enrichment-Analysis/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/fl-photo-202109.jpg">
      <meta itemprop="name" content="FENG Lei">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="FENG's Notes">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/06/29/Bioinfo-Gene-Ontology-Enrichment-Analysis/" class="post-title-link" itemprop="url">Bioinfo | Gene Ontology - Enrichment Analysis</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>
              

              <time title="Created: 2021-06-29 11:14:12 / Modified: 23:44:19" itemprop="dateCreated datePublished" datetime="2021-06-29T11:14:12+08:00">2021-06-29</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Bioinformatics/" itemprop="url" rel="index"><span itemprop="name">Bioinformatics</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>下面是我做的大豆GO数据库（version Gmax_508_Wm82_a4.v1）构建与富集分析。数据文件在：<a target="_blank" rel="noopener" href="https://github.com/bioinfx/Glycine_max_Gene_Ontology">https://github.com/bioinfx/Glycine_max_Gene_Ontology</a>。</p>
<p>经过前期数据比对和整理（比如依据 swissprot、blast2GO，或 GOMAP），得到下面“基因——GO号——Ontology 类别——证据”这四列格式的文件 GMA_GO_TERM.txt，就可以在R程序里面用于 GO 数据库的构建。</p>
<h3 id="数据库源文件准备"><a class="markdownIt-Anchor" href="#数据库源文件准备"></a> 数据库源文件准备</h3>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">$ zcat GMA_GO_TERM.txt.gz | head</span><br><span class="line">GID     GO      ONTOLOGY        EVIDENCE</span><br><span class="line">Glyma.01G000100 GO:0006412      P       IEA</span><br><span class="line">Glyma.01G000100 GO:0009063      P       IEA</span><br><span class="line">Glyma.01G000100 GO:0009234      P       IEA</span><br><span class="line">Glyma.01G000100 GO:0016021      C       IEA</span><br><span class="line">Glyma.01G000100 GO:0031969      C       IEA</span><br><span class="line">Glyma.01G000100 GO:0016835      F       IEA</span><br><span class="line">Glyma.01G000100 GO:0030976      F       IEA</span><br><span class="line">Glyma.01G000100 GO:0070204      F       IEA</span><br><span class="line">Glyma.01G000137 GO:0016043      P       IEA</span><br></pre></td></tr></table></figure>
<h3 id="数据库导入-r"><a class="markdownIt-Anchor" href="#数据库导入-r"></a> 数据库导入 R</h3>
<p>构建过程如下，调用 makeOrgPackage 函数构建 GO 数据库。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line">## Makes an organism package for Glycine max data.frames:</span><br><span class="line"></span><br><span class="line">library(RSQLite)</span><br><span class="line">library(AnnotationForge)</span><br><span class="line"></span><br><span class="line">## Now prepare some data.frames</span><br><span class="line">fGO &lt;- read.table(&quot;../3_final-result/GMA_GO_TERM.txt&quot;, sep=&quot;\t&quot;, head=TRUE)</span><br><span class="line"></span><br><span class="line">## remove duplication in the table</span><br><span class="line">go_df &lt;- fGO[!duplicated(fGO),]</span><br><span class="line"></span><br><span class="line">## only tree coloums are needed: GID, GO, EVIDENCE</span><br><span class="line">go_df &lt;- go_df[,c(1,2,4)]</span><br><span class="line"></span><br><span class="line">## Making Organism packages </span><br><span class="line">makeOrgPackage(go=go_df,</span><br><span class="line">    version = &quot;0.0.1&quot;,</span><br><span class="line">    maintainer = &quot;FENG Lei &lt;fengleiluck@gmail.com&gt;&quot;,</span><br><span class="line">    author = &quot;FENG Lei &lt;fengleiluck@gmail.com&gt;&quot;,</span><br><span class="line">    outputDir = &quot;./&quot;,</span><br><span class="line">    tax_id = &quot;3847&quot;,</span><br><span class="line">    genus = &quot;Glycine&quot;,</span><br><span class="line">    species = &quot;max&quot;,</span><br><span class="line">    goTable = &quot;go&quot;</span><br><span class="line">    )</span><br><span class="line"></span><br><span class="line">## then you can call install.packages based on the return value</span><br><span class="line">install.packages(&quot;./org.Gmax.eg.db&quot;, repos = NULL, type=&quot;source&quot;)</span><br><span class="line">library(org.Gmax.eg.db)</span><br><span class="line">org &lt;- org.Gmax.eg.db</span><br><span class="line"></span><br><span class="line">## A demo for using the database</span><br><span class="line"># BiocManager::install(&quot;Rgraphviz&quot;)</span><br><span class="line"># BiocManager::install(&quot;topGO&quot;)</span><br><span class="line">library()</span><br><span class="line">geneTable = read.table(&quot;./Gmax_ABA_exp.xls&quot;, head=T)</span><br><span class="line">geneList=geneTable[,5]</span><br><span class="line">geneList=geneList[!duplicated(geneList)]</span><br><span class="line"># Biology process</span><br><span class="line">ego_up &lt;-enrichGO(gene = geneList, OrgDb = org, keyType = &quot;GID&quot;, ont = &quot;BP&quot;)</span><br><span class="line">pdf(&quot;up_GO_BP_barplot.pdf&quot;, height=10, width=15)</span><br><span class="line">barplot(ego_up, drop=TRUE, showCategory=12)</span><br><span class="line">dev.off()</span><br><span class="line">pdf(&quot;up_GO_BP_dotPlot.pdf&quot;, height=10, width=15)</span><br><span class="line">dotplot(ego_up)</span><br><span class="line">dev.off()</span><br><span class="line">pdf(&quot;up_GO_BP_tree.pdf&quot;)</span><br><span class="line">plotGOgraph(ego_up)</span><br><span class="line">dev.off()</span><br><span class="line">write.csv(as.data.frame( ego_up@result ), file=&quot;up_GO_BP.csv&quot;)</span><br></pre></td></tr></table></figure>
<h1 id="数据库开启与富集分析"><a class="markdownIt-Anchor" href="#数据库开启与富集分析"></a> 数据库开启与富集分析</h1>
<p>下面代码示范如何引用上构建的数据库，并且开展 GO 分析：BP、MF 和 CC 三个类别。<br />
图片可输出为柱状图 barplot 和点状图 dotplot，</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line">library(org.Gmax.eg.db)</span><br><span class="line">org &lt;- org.Gmax.eg.db</span><br><span class="line"></span><br><span class="line">## A demo for using the database</span><br><span class="line"># BiocManager::install(&quot;Rgraphviz&quot;)</span><br><span class="line"># BiocManager::install(&quot;topGO&quot;)</span><br><span class="line">library(topGO)</span><br><span class="line">library(clusterProfiler)</span><br><span class="line">geneTable = read.table(&quot;./gene_table.txt&quot;, head=T, sep=&quot;\t&quot;)</span><br><span class="line">#geneTable = geneTable[!apply(geneTable == &quot;&quot;, 1, all),]</span><br><span class="line">geneList=geneTable[,5]</span><br><span class="line"></span><br><span class="line">geneList=geneList[!duplicated(geneList)]</span><br><span class="line"># Biology process</span><br><span class="line">b=geneList</span><br><span class="line"></span><br><span class="line"># biological progress</span><br><span class="line">ego_up &lt;-enrichGO(</span><br><span class="line">                  gene = b, </span><br><span class="line">                  OrgDb = org, </span><br><span class="line">                  keyType = &quot;GID&quot;, </span><br><span class="line">                  ont = &quot;BP&quot;</span><br><span class="line">                  )</span><br><span class="line">pdf(&quot;test_GO_BP_barplot.pdf&quot;, height=10, width=15)</span><br><span class="line">barplot(ego_up, drop=TRUE, showCategory=12)</span><br><span class="line">dev.off()</span><br><span class="line">pdf(&quot;test_GO_BP_dotPlot.pdf&quot;, height=10, width=15)</span><br><span class="line">dotplot(ego_up)</span><br><span class="line">dev.off()</span><br><span class="line">#pdf(&quot;up_GO_BP_tree.pdf&quot;)</span><br><span class="line">#plotGOgraph(ego_up)</span><br><span class="line">#dev.off()</span><br><span class="line">write.csv(as.data.frame( ego_up@result ), file=&quot;test_GO_BP.csv&quot;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># molecular function</span><br><span class="line">ego_down &lt;-enrichGO(</span><br><span class="line">                    gene = b,</span><br><span class="line">                    OrgDb = org,</span><br><span class="line">                    keyType = &quot;GID&quot;,</span><br><span class="line">                    ont = &quot;MF&quot;</span><br><span class="line">                    )</span><br><span class="line">pdf(&quot;test_GO_MF_barplot.pdf&quot;, height=10, width=15)</span><br><span class="line">barplot(ego_down, drop=TRUE, showCategory=12)</span><br><span class="line">dev.off()</span><br><span class="line">pdf(&quot;test_GO_MF_dotPlot.pdf&quot;, height=10, width=15)</span><br><span class="line">dotplot(ego_down)</span><br><span class="line">dev.off()</span><br><span class="line">#pdf(&quot;test_GO_MF_tree.pdf&quot;)</span><br><span class="line">#plotGOgraph(ego_down)</span><br><span class="line">#dev.off()</span><br><span class="line">write.csv(as.data.frame( ego_down@result), file=&quot;test_GO_MF.csv&quot;)</span><br><span class="line"></span><br><span class="line"># cellular component</span><br><span class="line">ego_down &lt;-enrichGO(</span><br><span class="line">                    gene = b,</span><br><span class="line">                    OrgDb = org,</span><br><span class="line">                    keyType = &quot;GID&quot;,</span><br><span class="line">                    ont = &quot;CC&quot;</span><br><span class="line">                    )</span><br><span class="line">pdf(&quot;test_GO_CC_barplot.pdf&quot;, height=10, width=15)</span><br><span class="line">barplot(ego_down, drop=TRUE, showCategory=12)</span><br><span class="line">dev.off()</span><br><span class="line">pdf(&quot;test_GO_CC_dotPlot.pdf&quot;, height=10, width=15)</span><br><span class="line">dotplot(ego_down)</span><br><span class="line">dev.off()</span><br><span class="line">#pdf(&quot;test_GO_CC_tree.pdf&quot;)</span><br><span class="line">#plotGOgraph(ego_down)</span><br><span class="line">#dev.off()</span><br><span class="line">write.csv(as.data.frame( ego_down@result), file=&quot;test_GO_CC.csv&quot;)</span><br></pre></td></tr></table></figure>
<p>有时候 GO 项目的名称过长，基于默认作图代码出来的图片会出现文字将图形区域挤压得无法显示。</p>
<p><img src="https://i.imgur.com/FlARCCO.jpeg" alt="" /></p>
<p>有两种优化方案，一是将长的文字换行；二是只截取一部分文字显示。</p>
<h3 id="一过长的文字换行显示"><a class="markdownIt-Anchor" href="#一过长的文字换行显示"></a> 一：过长的文字换行显示，</h3>
<p>参考资料：<a target="_blank" rel="noopener" href="https://www.cnblogs.com/songbiao/articles/12717670.html">songbiao: GO term name太长的处理</a><br />
在使用clusterProfiler进行绘制GO dotplot时，会遇到 GO term 的 name 过长，压缩了图形区域的情况。<br />
因为 clusterProfiler 作图是基于 ggplot2 的，所以这个处理办法也适用于其他 ggplot2 作图遇到此种情况。<br />
解决文本过长的办法就是，用stringr包的str_wrap来完成文本自动换行。<br />
效果如下图所示，其实还是不太完美，需要后期手工调整才美观。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">library(ggplot2)  # 需要开启 ggplot2 才可以使用 scale_y_discrete 函数</span><br><span class="line">library(stringr)</span><br><span class="line">dotplot(mf, showCategory=30) + scale_y_discrete(labels=function(mf) str_wrap(mf, width=40))</span><br></pre></td></tr></table></figure>
<p><img src="https://i.imgur.com/JRkomgm.jpeg" alt="" /></p>
<h3 id="二只截取一部分文字显示"><a class="markdownIt-Anchor" href="#二只截取一部分文字显示"></a> 二：只截取一部分文字显示</h3>
<p>参考资料：<a target="_blank" rel="noopener" href="https://r.bio-spring.info/2018/11/26/enrichplot-fancy-label/">在enrichplot中使用更好的Label</a><br />
该方法是定义一个截取短 label 的函数, 将其传递给 scale_y_discrete() 即可. 在输出 ggplot 对象时做修改。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">#&#x27; Truncate string vector of ggplot axis label</span><br><span class="line">#&#x27;</span><br><span class="line">#&#x27; @param label    a ordered string vector</span><br><span class="line">#&#x27; @param maxLen   max length of character (nchar) to show in label</span><br><span class="line">#&#x27; @param maxWord  max count of words allowed to show in label</span><br><span class="line">#&#x27; @param pattern  Word separater</span><br><span class="line">#&#x27; @param dot      If true, three dots will added to truncated label</span><br><span class="line">#&#x27;</span><br><span class="line">#&#x27; @return a vector of truncated strings</span><br><span class="line">#&#x27; @export</span><br><span class="line">#&#x27;</span><br><span class="line">#&#x27; @examples</span><br><span class="line"># 默认最多显示 50 个字符, 5 个单词.</span><br><span class="line">short_label &lt;- function(label, maxLen = 50, maxWord = 5, pattern = &quot; &quot;, dot = TRUE)&#123;</span><br><span class="line">  l &lt;- strsplit(label, pattern)</span><br><span class="line">  short_label &lt;- vector(&quot;character&quot;,length(l))</span><br><span class="line">  </span><br><span class="line">  for (i in seq_along(l))&#123;</span><br><span class="line">    truncated &lt;- FALSE</span><br><span class="line">    s &lt;- l[[i]]</span><br><span class="line">    if (length(s) &gt; maxWord)&#123;</span><br><span class="line">      ll &lt;- paste(s[1:maxWord], collapse = &quot; &quot;)</span><br><span class="line">      truncated &lt;- TRUE</span><br><span class="line">    &#125;</span><br><span class="line">    else&#123;</span><br><span class="line">      ll &lt;- paste(s, collapse = &quot; &quot;)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    if (nchar(ll) &gt; maxLen)&#123;</span><br><span class="line">      ll &lt;- substr(ll, 1, maxLen)</span><br><span class="line">      truncated &lt;- TRUE</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    if (dot &amp; truncated) ll &lt;- paste(ll, &quot;...&quot;,sep = &quot; &quot;)</span><br><span class="line">    </span><br><span class="line">    short_label[[i]] &lt;- ll</span><br><span class="line">  &#125;</span><br><span class="line">  attr(short_label, &quot;pos&quot;) &lt;- attr(label,&quot;pos&quot;)</span><br><span class="line">  return(short_label)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>画图代码：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">library(ggplot2)</span><br><span class="line">dotplot(mf) + scale_y_discrete(label=short_label)</span><br></pre></td></tr></table></figure>
<p><img src="https://i.imgur.com/pALA2H9.jpeg" alt="" /></p>
<p>注意上面的图，其实很多项目都是高度近似的，怎么优化？对于模式物种而言，CytoScape的插件ClueGO有一个选项可以实现，就是设置Ontology的级别。因为Ontology的结构就是树状，从根部到.</p>
<p>构建GO数据库的过程中，如果成功会输出下面的信息。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line">&gt; head(go_df)</span><br><span class="line">           GID         GO EVIDENCE</span><br><span class="line">1 Chr01.g00016 GO:0003676      IEA</span><br><span class="line">2 Chr01.g00016 GO:0003964      IEA</span><br><span class="line">3 Chr01.g00016 GO:0004190      IEA</span><br><span class="line">4 Chr01.g00016 GO:0004519      IEA</span><br><span class="line">5 Chr01.g00016 GO:0006310      IEA</span><br><span class="line">6 Chr01.g00016 GO:0015074      IEA</span><br><span class="line">&gt; makeOrgPackage(go=go_df,</span><br><span class="line">+                version = &quot;0.0.1&quot;,</span><br><span class="line">+                maintainer = &quot;FENG Lei &lt;fengleiluck@gmail.com&gt;&quot;,</span><br><span class="line">+                author = &quot;FENG Lei &lt;fengleiluck@gmail.com&gt;&quot;,</span><br><span class="line">+                outputDir = &quot;.&quot;,</span><br><span class="line">+                tax_id = &quot;126911&quot;,</span><br><span class="line">+                genus = &quot;Ammopiptanthus&quot;,</span><br><span class="line">+                species = &quot;mongolicus&quot;,</span><br><span class="line">+                goTable = &quot;go&quot;</span><br><span class="line">+ )</span><br><span class="line">Populating genes table:</span><br><span class="line">genes table filled</span><br><span class="line">Populating go table:</span><br><span class="line">go table filled</span><br><span class="line">table metadata filled</span><br><span class="line">&#x27;select()&#x27; returned many:1 mapping between keys and columns</span><br><span class="line">Dropping GO IDs that are too new for the current GO.db</span><br><span class="line">Populating go table:</span><br><span class="line">go table filled</span><br><span class="line">Populating go_bp table:</span><br><span class="line">go_bp table filled</span><br><span class="line">Populating go_cc table:</span><br><span class="line">go_cc table filled</span><br><span class="line">Populating go_mf table:</span><br><span class="line">go_mf table filled</span><br><span class="line">&#x27;select()&#x27; returned many:1 mapping between keys and columns</span><br><span class="line">Populating go_bp_all table:</span><br><span class="line">go_bp_all table filled</span><br><span class="line">Populating go_cc_all table:</span><br><span class="line">go_cc_all table filled</span><br><span class="line">Populating go_mf_all table:</span><br><span class="line">go_mf_all table filled</span><br><span class="line">Populating go_all table:</span><br><span class="line">go_all table filled</span><br><span class="line">Creating package in ./org.Amongolicus.eg.db </span><br><span class="line">Now deleting temporary database file</span><br><span class="line">[1] &quot;./org.Amongolicus.eg.db&quot;</span><br><span class="line">There were 50 or more warnings (use warnings() to see the first 50)</span><br></pre></td></tr></table></figure>
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://example.com/2021/06/17/Linux-Gene-Ontology-GOMAP/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/fl-photo-202109.jpg">
      <meta itemprop="name" content="FENG Lei">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="FENG's Notes">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/06/17/Linux-Gene-Ontology-GOMAP/" class="post-title-link" itemprop="url">Bioinfo | Gene Ontology - GOMAP</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2021-06-17 10:59:17" itemprop="dateCreated datePublished" datetime="2021-06-17T10:59:17+08:00">2021-06-17</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2021-06-29 11:40:34" itemprop="dateModified" datetime="2021-06-29T11:40:34+08:00">2021-06-29</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Bioinformatics/" itemprop="url" rel="index"><span itemprop="name">Bioinformatics</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>Gene Ontology Meta Annotator for Plants</p>
<p>GOMAP 主要是给植物基因集做 Gene Ontology 注释信息匹配，它综合了多个数据库，所以得到的信息会全面一些。早年将基因对应到GO用的工具是Blast2GO，这个软件linux版本安装比较麻烦，基于mysql数据库，而且后面它商业化之后要收费。后来的策略是用diamond的快速blastp将基因集与SwissProt数据库进行比较，得到每个基因最相近的Uniprot ID，再依靠id-mapping文件将基因与GO对应起来，本文最后有简单介绍基于SwissProt做GO注释的流程。</p>
<p>What is GOMAP-Singularity? GOMAP-Singularity is the containerized version of the Gene Ontology Meta Annotator for Plants (GOMAP) pipeline. GOMAP is a high-throughput pipeline to annotate GO terms to plant protein sequences. The pipeline uses three different approaches to annotate GO terms to plant protein sequences, and compile the annotations together to generate an aggregated dataset. GOMAP uses Python code to run the component tools to generate the GO annotations, and R code to clean and aggregate the GO annotations from the component tools.</p>
<p>How do I use GOMAP-Singularity?</p>
<p>Please check &lt;<a target="_blank" rel="noopener" href="http://bioinformapping.com/gomap">bioinformapping.com/gomap</a>&gt; for detailed documentation on how to use the container.</p>
<h3 id="install-system-dependencies"><a class="markdownIt-Anchor" href="#install-system-dependencies"></a> Install system dependencies</h3>
<p>You must first install development tools and libraries to your host.<br />
On Debian-based systems:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ sudo apt-get update &amp;&amp; \</span><br><span class="line">  sudo apt-get install -y build-essential \</span><br><span class="line">  libseccomp-dev pkg-config squashfs-tools cryptsetup</span><br></pre></td></tr></table></figure>
<p>On CentOS/RHEL:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ sudo yum groupinstall -y &#x27;Development Tools&#x27; &amp;&amp; \</span><br><span class="line">  sudo yum install -y epel-release &amp;&amp; \</span><br><span class="line">  sudo yum install -y golang libseccomp-devel \  </span><br><span class="line">  squashfs-tools cryptsetup</span><br><span class="line">  yum remove golang # 后面手动安装</span><br></pre></td></tr></table></figure>
<h3 id="install-golang"><a class="markdownIt-Anchor" href="#install-golang"></a> Install Golang</h3>
<p>Golang 有多种安装方法，我是在其官网(<a target="_blank" rel="noopener" href="https://golang.org/doc/install#download">https://golang.org/doc/install#download</a>)下载<a target="_blank" rel="noopener" href="https://golang.org/dl/go1.16.5.linux-amd64.tar.gz">源文件</a>到本地，然后安装到用户目录。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">wget https://golang.org/dl/go1.16.5.linux-amd64.tar.gz</span><br><span class="line">tar -zxvf go1.16.5.linux-amd64.tar.gz</span><br><span class="line"></span><br><span class="line"># 将 “export PATH=&quot;/home/fenglei/local/app/go/bin&quot;:$PATH” 写入bashrc</span><br><span class="line">source ~/.bashrc</span><br><span class="line">which go</span><br><span class="line"># ~/local/app/go/bin/go</span><br><span class="line"></span><br><span class="line"># Verify that you&#x27;ve installed Go by opening a command prompt and typing the following command:</span><br><span class="line">go version</span><br><span class="line"># go version go1.16.5 linux/amd64</span><br></pre></td></tr></table></figure>
<h3 id="compiling-singularityce"><a class="markdownIt-Anchor" href="#compiling-singularityce"></a> Compiling SingularityCE</h3>
<p>参考安装方法如下</p>
<p>You can build SingularityCE using the following commands:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ cd $&#123;GOPATH&#125;/src/github.com/sylabs/singularity &amp;&amp; \</span><br><span class="line">  ./mconfig &amp;&amp; \</span><br><span class="line">  cd ./builddir &amp;&amp; \</span><br><span class="line">  make &amp;&amp; \</span><br><span class="line">  sudo make install</span><br></pre></td></tr></table></figure>
<p>And that’s it! Now you can check your SingularityCE version by running:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ singularity version</span><br></pre></td></tr></table></figure>
<p>To build in a different folder and to set the install prefix to a different path:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ ./mconfig -b ./buildtree -p /usr/local</span><br></pre></td></tr></table></figure>
<p>我的安装如下。</p>
<p>系统自带的gcc（版本4.8.5）编译报错，提示找不到config.c文件。我切换成用户的gcc（版本10.2.0），就可以安装。<br />
启动用户gcc的办法，修改bashrc文件，将下面三行的注释符号去掉，然后source ~/.bashrc即可。以后有必要再回来将这几行注释掉，就恢复系统自带的老版本gcc。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">export PATH=/home/fenglei/local/gcc-10.2.0/bin/:$PATH</span><br><span class="line">export LD_LIBRARY_PATH=/home/fenglei/local/gcc-10.2.0/lib/:/home/fenglei/local/gcc-10.2.0/lib64/:$LD_LIBRARY_PATH</span><br><span class="line">export LD_LIBRARY_PATH=/home/fenglei/local/lib/:/home/fenglei/local/lib64/:$LD_LIBRARY_PATH</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">$ git clone https://github.com/sylabs/singularity.git</span><br><span class="line">$ cd singularity  # 该目录下有一个 mconfig 文件</span><br><span class="line"># ./mconfig -b ./buildtree -p /home/fenglei/local</span><br><span class="line"># ./mconfig -b ./buildtree -p /home/fenglei/local --without-suid</span><br><span class="line">$ ./mconfig    # 默认的安装位置是 /usr/local</span><br><span class="line">$ cd /home/fenglei/local/app/singularity/buildtree</span><br><span class="line">$ make</span><br><span class="line"># make install</span><br><span class="line">$ sudo make install</span><br><span class="line"></span><br><span class="line">$ which singularity</span><br><span class="line">/usr/local/bin/singularity</span><br></pre></td></tr></table></figure>
<p>测试：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ singularity version                                                                                        </span><br><span class="line">3.8.0-rc.1+107-g8b21e5a16</span><br></pre></td></tr></table></figure>
<h3 id="gomap-singularity"><a class="markdownIt-Anchor" href="#gomap-singularity"></a> GOMAP-singularity</h3>
<ol>
<li>Singularity 安装</li>
</ol>
<p>上面已经完成。也可参考：<a target="_blank" rel="noopener" href="https://bioinformapping.com/gomap/master/RUNNING.html">https://bioinformapping.com/gomap/master/RUNNING.html</a></p>
<ol start="2">
<li>从 git 下载 GOMAP-singularity</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git clone https://github.com/Dill-PICL/GOMAP-singularity.git</span><br><span class="line">cd GOMAP-singularity</span><br></pre></td></tr></table></figure>
<ol start="3">
<li>配置并下载相关参考数据集</li>
</ol>
<p>Run the setup step to make necessary directories and download data files from CyVerse. The pipeline download is large and would require ~40GB of free hard drive space during the setup step.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">$ ./setup.sh </span><br><span class="line"># 由于GO没安好，导致这一步报错，后面重新安装了GO，并重装singularity</span><br><span class="line"># ERROR  : No setuid installation found, for unprivileged installation use: ./mconfig --without-suid</span><br><span class="line"></span><br><span class="line">$ ./setup.sh </span><br><span class="line">0/1 -  0.00% of files done   0.000/39254.793 MB -  0.00% of file sizes done</span><br><span class="line">Processing GOMAP.sif - 39254.793 MB   2021-06-17.15:58:52</span><br><span class="line">GOMAP.sif - 40.000/39254.793 MB -  0.10% done   2021-06-17.16:00:53</span><br><span class="line">GOMAP.sif - 680.000/39254.793 MB -  1.73% done   2021-06-17.16:02:47</span><br><span class="line">GOMAP.sif - 1360.000/39254.793 MB -  3.46% done   2021-06-17.16:04:49</span><br><span class="line">GOMAP.sif - 2000.000/39254.793 MB -  5.09% done   2021-06-17.16:06:40</span><br><span class="line">GOMAP.sif - 2400.000/39254.793 MB -  6.11% done   2021-06-17.16:08:32</span><br><span class="line">cliReconnManager: Reconnecting clientState = 0</span><br><span class="line">...</span><br><span class="line">cliReconnManager: Reconnecting clientState = 0</span><br><span class="line">The client/server socket connection has been renewed</span><br><span class="line">GOMAP.sif - 30880.000/39254.793 MB - 78.67% done   2021-06-17.17:59:30</span><br><span class="line">GOMAP.sif - 31520.000/39254.793 MB - 80.30% done   2021-06-17.18:01:43</span><br><span class="line">GOMAP.sif - 32040.000/39254.793 MB - 81.62% done   2021-06-17.18:03:45</span><br><span class="line">GOMAP.sif - 32640.000/39254.793 MB - 83.15% done   2021-06-17.18:05:31</span><br><span class="line">GOMAP.sif - 33200.000/39254.793 MB - 84.58% done   2021-06-17.18:07:27</span><br><span class="line">GOMAP.sif - 33373.426/39254.793 MB - 85.02% done   2021-06-17.18:08:24</span><br><span class="line">cliReconnManager: Reconnecting clientState = 0</span><br><span class="line">The client/server socket connection has been renewed</span><br><span class="line">cliReconnManager: Reconnecting clientState = 0</span><br><span class="line">The client/server socket connection has been renewed</span><br><span class="line">cliReconnManager: Reconnecting clientState = 0</span><br><span class="line">The client/server socket connection has been renewed</span><br><span class="line">cliReconnManager: Reconnecting clientState = 0</span><br><span class="line">The client/server socket connection has been renewed</span><br><span class="line">GOMAP.sif - 39254.793/39254.793 MB - 100.00% done   2021-06-17.18:45:46</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<ol start="4">
<li>测试 GOMAP 注释流程</li>
</ol>
<p>[optional]: Test whether the container and the data files are working as intended.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">$ ./test.sh</span><br><span class="line"></span><br><span class="line">Running Sequence-similarity based Annotation Step</span><br><span class="line">/usr/local/lib/python2.7/dist-packages/Bio/SearchIO/__init__.py:211: BiopythonExperimentalWarning: Bio.SearchIO is an experimental submodule which may undergo significant changes prior to its future official release.</span><br><span class="line">  BiopythonExperimentalWarning)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Building a new DB, current time: 06/17/2021 20:59:09</span><br><span class="line">New DB name:   /workdir/test/GOMAP-0.3_GOMAP-input/input/0.3_GOMAP-input.fa</span><br><span class="line">New DB title:  /workdir/test/GOMAP-0.3_GOMAP-input/input/0.3_GOMAP-input.fa</span><br><span class="line">Sequence type: Protein</span><br><span class="line">...</span><br><span class="line">Checking gaf file for simple errors and fixing them</span><br><span class="line">There were 34 warnings (use warnings() to see them)</span><br><span class="line">[1] &quot;Checking if data/data/go/go.obo.data exists&quot;</span><br><span class="line">[1] &quot;data/data/go/go.obo.data exists so loading R object&quot;</span><br><span class="line">   user  system elapsed </span><br><span class="line">  2.547   0.078   2.624 </span><br><span class="line">[1] &quot;Reading All Datasets&quot;</span><br><span class="line">Checking gaf file for simple errors and fixing them</span><br><span class="line">[1] 1714</span><br><span class="line">[1] &quot;Removing Redundancy&quot;</span><br><span class="line">[1] 18</span><br><span class="line">Compiling Non-Redundant Comprehensive Data</span><br><span class="line">There were 50 or more warnings (use warnings() to see the first 50)</span><br></pre></td></tr></table></figure>
<ol start="5">
<li>实战篇：学习自定义配置文件 Edit the config file</li>
</ol>
<p>a. Declare export GOMAP_LOC environment variable. Edit <code>~/.bashrc</code> as below:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">export GOPATH=&quot;/home/fenglei/local/app/go&quot;</span><br><span class="line">export GOMAP_LOC=&quot;/home/fenglei/local/app/GOMAP-singularity/install/location&quot;</span><br></pre></td></tr></table></figure>
<p>b. Download the <a target="_blank" rel="noopener" href="https://bioinformapping.com/gomap/master/_static/min-config.yml">config.yml</a> file and make necessary changes. Change the highlighted lines to fit your input data.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">#Input section </span><br><span class="line">input:</span><br><span class="line">  #input fasta file name</span><br><span class="line">  fasta: GOMAP-input.fa</span><br><span class="line">  # output file basename</span><br><span class="line">  basename: GOMAP_output</span><br><span class="line">  #input NCBI taxonomy id</span><br><span class="line">  taxon: &quot;123456&quot;</span><br><span class="line">  # Name of the species</span><br><span class="line">  species: &quot;Glycine max&quot;</span><br><span class="line">  # Email is mandatory</span><br><span class="line">  email: myname#gmail.com</span><br><span class="line">  #Number of CPUs used for tools</span><br><span class="line">  cpus: 4</span><br><span class="line">  #Whether openmpi should be used</span><br><span class="line">  mpi: False</span><br><span class="line">  #what the name of the temporary directory is</span><br><span class="line">  tmpdir: &quot;/tmpdir&quot;</span><br></pre></td></tr></table></figure>
<ol start="6">
<li>Run pipeline</li>
</ol>
<p>可直接修改 <a target="_blank" rel="noopener" href="http://test.sh">test.sh</a> 并运行该脚本。也可参考软件手册分步骤运行。<br />
下面摘抄的是在单机（SINGLE）运行的模式，软件手册里也有在集群（MPI）运行的示范代码。<br />
<a target="_blank" rel="noopener" href="http://test.sh">test.sh</a> 与 test目录在同一个路径。GOMAP-input.fa 与 config.yml 都在test目录下。输入的蛋白序列，其尾部如果有表示stop codon的星号，要移除星号。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"># seqsim</span><br><span class="line">./run-GOMAP-SINGLE.sh --step=seqsim --config=test/config.yml</span><br><span class="line"># domain</span><br><span class="line">./run-GOMAP-SINGLE.sh --step=domain --config=test/config.yml</span><br><span class="line"># fanngo</span><br><span class="line">./run-GOMAP-SINGLE.sh --step=fanngo --config=test/config.yml</span><br><span class="line"># mixmeth-blast</span><br><span class="line">./run-GOMAP-SINGLE.sh --step=mixmeth-blast --config=test/config.yml</span><br><span class="line"># mixmeth-preproc</span><br><span class="line">./run-GOMAP-SINGLE.sh --step=mixmeth-preproc --config=test/config.yml</span><br><span class="line"># mixmeth</span><br><span class="line">./run-GOMAP-SINGLE.sh --step=mixmeth --config=test/config.yml</span><br><span class="line"># aggregate</span><br><span class="line"># Attention: Please wait for all your Argot2.5 jobs to finish before running this step. You will get emails from Argot2.5 when your jobs are submitted and when they are finished. You can also check the status of all current jobs from all users here.</span><br><span class="line">./run-GOMAP-SINGLE.sh --step=aggregate --config=test/config.yml</span><br></pre></td></tr></table></figure>
<h3 id="附注用-swissprot-与-idmapping-来做-go"><a class="markdownIt-Anchor" href="#附注用-swissprot-与-idmapping-来做-go"></a> 附注：用 SwissProt 与 idmapping 来做 GO</h3>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">## SwissProt 文件是氨基酸序列，比较大</span><br><span class="line">wget ftp://ftp.ncbi.nih.gov/blast/db/FASTA/swissprot.gz</span><br><span class="line">## idmapping.tb.gz 文件可能下载链接有变化</span><br><span class="line">wget ftp://ftp.pir.georgetown.edu/databases/idmapping/idmapping.tb.gz</span><br><span class="line">## swissprot index 建立</span><br><span class="line">diamond makedb --in swissprot -d swissprot</span><br><span class="line">## 序列比对</span><br><span class="line">diamond blastp -d /PATH/TO/index/swissprot -q input.proteins.fa -k 1 -e 0.00001 -o swissprot_blastp.out</span><br><span class="line">## idmapping 文件整理，下文有摘抄文件具体内容</span><br><span class="line">awk -F &quot;\t&quot;  &#x27;&#123;print $1&quot;\t&quot;$8&#125;&#x27; idmapping.tb &gt; uniprotID-GOnumber.tab</span><br><span class="line">## 将“基因-Uniprot-GO”的关系建立起来</span><br><span class="line">perl UniProt2GO_annotate.pl uniprotID-GOnumber.tab swiss_dia_matches.m8 swiss_GO_matches.tab</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">$ head idmapping.tb </span><br><span class="line">Q6GZX4  001R_FRG3G      2947773 YP_031579.1     81941549; 49237298              PF04947 GO:0006355; GO:0046782; GO:0006351                      UniRef100_Q6GZX4        UniRef90_Q6GZX4 UniRef50_Q6GZX4 UPI00003B0FD4           65492415165820 AY548484        AAT09660.1</span><br><span class="line">Q6GZX3  002L_FRG3G      2947774 YP_031580.1     49237299; 81941548; 47060117            PF03003 GO:0033644; GO:0016021                  UniRef100_Q6GZX3        UniRef90_Q6GZX3 UniRef50_Q6GZX3 UPI00003B0FD5           654924        15165820 AY548484        AAT09661.1</span><br><span class="line">Q197F8  002R_IIV3       4156251 YP_654574.1     109287880; 123808694; 106073503                                         UniRef100_Q197F8        UniRef90_Q197F8 UniRef50_Q197F8 UPI0000D83464           345201                        16912294 DQ643392        ABF82032.1</span><br><span class="line">Q197F7  003L_IIV3       4156252 YP_654575.1     106073504; 109287881; 123808693                                         UniRef100_Q197F7        UniRef90_Q197F7 UniRef50_Q197F7 UPI0000D83465           345201                        16912294 DQ643392        ABF82033.1</span><br><span class="line">Q6GZX2  003R_FRG3G      2947775 YP_031581.1     81941547; 49237300                                              UniRef100_Q6GZX2        UniRef90_Q6GZX2 UniRef50_Q6GZX2 UPI00003B0FD6           654924                          15165820       AY548484        AAT09662.1</span><br><span class="line">Q6GZX1  004R_FRG3G      2947776 YP_031582.1     49237301; 81941546                      GO:0033644; GO:0016021                  UniRef100_Q6GZX1        UniRef90_Q6GZX1 UniRef50_Q6GZX1 UPI00003B0FD7           654924                15165820 AY548484        AAT09663.1</span><br><span class="line">Q197F5  005L_IIV3       4156254 YP_654577.1     123808691; 109287883; 106073506                                         UniRef100_Q197F5        UniRef90_Q197F5 UniRef50_Q197F5 UPI0000D83467           345201                        16912294 DQ643392        ABF82035.1</span><br><span class="line">Q6GZX0  005R_FRG3G      2947777 YP_031583.1     47060120; 49237302; 81941545            PF02393                         UniRef100_Q6GZX0        UniRef90_Q6GZX0 UniRef50_Q6GZX0 UPI00003B0FD8           654924                        15165820 AY548484        AAT09664.1</span><br><span class="line">Q91G88  006L_IIV6       1733056 NP_149469.1     82012333; 15078718; 15042163            PF04383; PF12299                                UniRef100_Q91G88        UniRef90_Q91G88 UniRef50_Q91G88 UPI00000F3D32           176652        2820141; 3959991; 7698884; 8492091; 17239238; 8021587; 10456793; 8121799; 9926400; 16789247; 11448171; 1475907; 3201750; 9482589; 1549908; 8073636       AF303741        AAK81943.1</span><br><span class="line">Q6GZW9  006R_FRG3G      2947778 YP_031584.1     81941544; 49237303                                              UniRef100_Q6GZW9        UniRef90_Q6GZW9 UniRef50_Q6GZW9 UPI00003B0FD9           654924                          15165820       AY548484        AAT09665.1</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">$ head swiss_GO_matches.tab</span><br><span class="line">Q6GZX4  GO:0006355; GO:0046782; GO:0006351</span><br><span class="line">Q6GZX3  GO:0033644; GO:0016021</span><br><span class="line">Q197F8</span><br><span class="line">Q197F7</span><br><span class="line">Q6GZX2</span><br><span class="line">Q6GZX1  GO:0033644; GO:0016021</span><br><span class="line">Q197F5</span><br><span class="line">Q6GZX0</span><br><span class="line">Q91G88</span><br><span class="line">Q6GZW9</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ head swiss_GO_matches.tab</span><br><span class="line">gene1 Q9M9M9  GO:0050897; GO:0009055; GO:0008137; GO:0009735; GO:0006979; GO:0005747; GO:0005739</span><br><span class="line">gene2 Q9LP77  GO:0005524; GO:0004672; GO:0016021; GO:0005886; GO:0009506; GO:0005774</span><br><span class="line">gene3 Q9CAL2  GO:0005524; GO:0004674; GO:0016021; GO:0005886</span><br><span class="line">gene4 A4FLF6</span><br><span class="line">gene5 Q8RY67  GO:0005524; GO:0004674; GO:0007166; GO:0016021; GO:0005886</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">$ cat UniProt2GO_annotate.pl</span><br><span class="line">#!/usr/bin/perl</span><br><span class="line">use warnings;</span><br><span class="line">use strict;</span><br><span class="line"></span><br><span class="line">open IDMAPPING, $ARGV[0] or die $!;</span><br><span class="line">open BLASTOUT, $ARGV[1] or die $!;</span><br><span class="line">open OUT, &quot;&gt;$ARGV[2]&quot; or die $!;</span><br><span class="line">select OUT;</span><br><span class="line"></span><br><span class="line">my %id2go;</span><br><span class="line"></span><br><span class="line">while(&lt;IDMAPPING&gt;)&#123;</span><br><span class="line">        chomp $_;</span><br><span class="line">        my @array1=split(/\t/);</span><br><span class="line">        $id2go&#123;$array1[0]&#125;=$array1[1];</span><br><span class="line">#       print &quot;$array1[1]\n&quot;; exit;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">while(&lt;BLASTOUT&gt;)&#123;</span><br><span class="line">        chomp $_;</span><br><span class="line">        my @array2=split(/\t/);</span><br><span class="line">        my $geneid=$array2[0];</span><br><span class="line">        my $UniprotID=$array2[1];</span><br><span class="line">#       print &quot;$UniprotID\n&quot;;</span><br><span class="line">        $UniprotID =~ s/\.[0-9]$//;</span><br><span class="line">#       print &quot;$geneid\t$&#123;UniprotID&#125;test\n&quot;; exit;</span><br><span class="line">        if(exists $id2go&#123;$UniprotID&#125;)&#123; print &quot;$geneid\t$UniprotID\t$id2go&#123;$UniprotID&#125;\n&quot;;&#125;</span><br><span class="line">        else&#123;print &quot;$geneid\t$UniprotID\n&quot;;&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">close IDMAPPING;</span><br><span class="line">close BLASTOUT;</span><br><span class="line">close OUT;</span><br></pre></td></tr></table></figure>
<p>经过一系列的转换，得到下面格式的文件，就可以在R程序里面用于GO数据库的构建。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">$ zcat GMA_GO_TERM.txt.gz | head</span><br><span class="line">GID     GO      ONTOLOGY        EVIDENCE</span><br><span class="line">Glyma.01G000100 GO:0006412      P       IEA</span><br><span class="line">Glyma.01G000100 GO:0009063      P       IEA</span><br><span class="line">Glyma.01G000100 GO:0009234      P       IEA</span><br><span class="line">Glyma.01G000100 GO:0016021      C       IEA</span><br><span class="line">Glyma.01G000100 GO:0031969      C       IEA</span><br><span class="line">Glyma.01G000100 GO:0016835      F       IEA</span><br><span class="line">Glyma.01G000100 GO:0030976      F       IEA</span><br><span class="line">Glyma.01G000100 GO:0070204      F       IEA</span><br><span class="line">Glyma.01G000137 GO:0016043      P       IEA</span><br></pre></td></tr></table></figure>
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  


  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/3/"><i class="fa fa-angle-left" aria-label="Previous page"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/3/">3</a><span class="page-number current">4</span><a class="page-number" href="/page/5/">5</a><span class="space">&hellip;</span><a class="page-number" href="/page/20/">20</a><a class="extend next" rel="next" href="/page/5/"><i class="fa fa-angle-right" aria-label="Next page"></i></a>
  </nav>



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="FENG Lei"
      src="/images/fl-photo-202109.jpg">
  <p class="site-author-name" itemprop="name">FENG Lei</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">193</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">11</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">1</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="mailto:lfeng0703@hotmail.com" title="E-Mail → mailto:lfeng0703@hotmail.com" rel="noopener" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
  </div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2023</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">FENG Lei</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://pisces.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Pisces</a>
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  




  
<script src="/js/local-search.js"></script>













  

  

</body>
</html>
